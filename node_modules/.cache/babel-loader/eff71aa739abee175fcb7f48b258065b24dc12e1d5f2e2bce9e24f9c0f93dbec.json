{"ast":null,"code":"import TIR from '@/views/components/Chart/TIR';\nimport AGP from '@/views/components/Chart/AGPchart';\nimport DayChart from '@/views/components/Chart/DayChart';\nimport { getAgpData } from '@/api/dataApi';\nimport { formatDate, formatTime } from '@/utils/formatTime';\nimport { GlucoseUtils } from \"@/utils/algorithm/Glucose\";\nexport default {\n  data() {\n    return {\n      bgInfo: ''\n    };\n  },\n  components: {\n    TIR,\n    AGP,\n    DayChart\n  },\n  mounted() {\n    const end = new Date('2024-06-03 23:59:00');\n    const start = new Date('2024-05-20 00:00:00');\n    this.agpDate = [formatDate(start, \"YYYY-mm-dd\"), formatDate(end, \"YYYY-mm-dd\")];\n    if (_.indexOf(this.$store.state.report.chooseDateList, this.agpDate.join('/')) == -1) {\n      this.getData();\n    } else {\n      this.$bus.$emit('getVuexTag', this.agpDate.join('/'));\n    }\n  },\n  methods: {\n    // 从云拉取数据\n    getData() {\n      let s = new Date(this.agpDate[0]);\n      let e = new Date(this.agpDate[1]);\n      let start_ts = s.setHours(0, 0, 0) / 1000;\n      let end_ts = e.setHours(23, 59, 59) / 1000;\n      this.loading = true;\n      getAgpData({\n        start_ts: start_ts,\n        end_ts: end_ts\n      }).then(response => {\n        if (response.code == 1000) {\n          let arrayData = response.data;\n          this.loading = false;\n          if (arrayData.length > 0) {\n            console.log(formatTime(new Date()), '得到数据');\n            this.empty = false;\n            this.list = arrayData;\n            this.bgInfo = GlucoseUtils.calculateMeanCvGmi(_.map(arrayData, 'Value'));\n            console.log(this.bgInfo);\n            handel(arrayData);\n            this.$bus.$emit('getDatas', [this.agpDate.join('/'), arrayData]);\n            this.$store.dispatch('setChooseDateList', this.agpDate.join('/'));\n          } else {\n            this.empty = true;\n          }\n        } else {\n          this.loading = false;\n          this.$message({\n            type: 'error',\n            message: response.msg\n          });\n        }\n      }).catch(res => {\n        console.log(res);\n      });\n    },\n    // cgm有效时间占比\n    handel(dataArray) {\n      let filteredArray = dataArray.filter(val => val >= 40 && val <= 400);\n      console.log(filteredArray / dataArray, _.round(filteredArray / dataArray * 100, 1));\n      this.bgInfo.effective = _.round(filteredArray / dataArray * 100, 1);\n    }\n  }\n};","map":{"version":3,"names":["TIR","AGP","DayChart","getAgpData","formatDate","formatTime","GlucoseUtils","data","bgInfo","components","mounted","end","Date","start","agpDate","_","indexOf","$store","state","report","chooseDateList","join","getData","$bus","$emit","methods","s","e","start_ts","setHours","end_ts","loading","then","response","code","arrayData","length","console","log","empty","list","calculateMeanCvGmi","map","handel","dispatch","$message","type","message","msg","catch","res","dataArray","filteredArray","filter","val","round","effective"],"sources":["src/views/pdfReport/report.vue"],"sourcesContent":["<template>\n    <div id='report' >\n            <div class='report-main-title-info' >\n                <img src=\"~@/assets/image/report-logo.png\" alt=\"\" class='report-logo' >\n                <div class='report-main-title' >动态葡萄糖监测报告</div>\n                <div class='report-main-date' >\n                    2024年3月1日<div class='repart-main-dirver-box'><span class='repart-main-dirver' ></span></div>2024年3月14日</div>\n            </div>\n            <!-- 基本信息 -->\n            <div class='report-main-base-info report-main' ref='test'>\n                <div class='report-module-title'  >\n                    <div class='report-module-title-border' ></div>\n                    <div class='report-module-title-text' >基本信息</div>\n                </div>\n                <div class='report-base-user' >\n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>姓名：</div>\n                        <div class='report-base-user-value'>卡布达</div>\n                    </div>  \n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>年龄：</div>\n                        <div class='report-base-user-value'>65</div>\n                    </div>  \n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>糖尿病类型：</div>\n                        <div class='report-base-user-value'>一型糖尿病</div>\n                    </div>  \n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>病程：</div>\n                        <div class='report-base-user-value'>5年</div>\n                    </div>  \n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>葡萄糖目标范围：</div>\n                        <div class='report-base-user-value'>3.9-10.0mmol/L</div>\n                    </div>  \n                </div>\n                <div class='report-data-source'>\n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>传感器序列号：</div>\n                        <div class='report-base-user-value'>CGM1234567</div>\n                    </div>  \n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>数据来源：</div>\n                        <div class='report-base-user-value'>iPhone XS Max</div>\n                    </div>  \n                    <div class='report-base-user-item' >\n                        <div class='report-base-user-label'>生成时间：</div>\n                        <div class='report-base-user-value'>2024年3月14日</div>\n                    </div>  \n                </div>\n            </div>\n            <!-- 血糖数据、TIR -->\n            <div class='report-main-data-tir-box' >\n                <div class='report-main-data-tir report-main' >\n                    <div class='report-module-title' >\n                        <div class='report-module-title-border' ></div>\n                        <div class='report-module-title-text' >血糖数据</div>\n                    </div>\n                    <div class='report-main-data-list'>\n                        <div class='report-main-data-label'>\n                            <div class='report-main-data-label-text' >CGM佩戴天数：</div>\n                        </div>\n                        <div class='report-main-data-val'>14天</div>\n                    </div>\n                    <div class='report-main-data-list'>\n                        <div class='report-main-data-label'>\n                            <div class='report-main-data-label-text' >CGM有效记录的时间占比：</div>\n                            <div class='report-main-data-label-tip' >目标值>70%才可得到有效数据分析</div>\n                        </div>\n                        <div class='report-main-data-val'>{{bgInfo.effective}}%</div>\n                    </div>\n                    <div class='report-main-data-list'>\n                        <div class='report-main-data-label'>\n                            <div class='report-main-data-label-text' >MG 平均葡萄糖值：</div>\n                            <div class='report-main-data-label-tip' >目标值＜6.6mmol/L</div>\n                        </div>\n                        <div class='report-main-data-val'>{{bgInfo.mean}}mmol/L</div>\n                    </div>\n                    <div class='report-main-data-list'>\n                        <div class='report-main-data-label'>\n                            <div class='report-main-data-label-text' >GMI 葡萄糖管理指标:</div>\n                            <div class='report-main-data-label-tip' >目标值＜7%</div>\n                        </div>\n                        <div class='report-main-data-val'>{{bgInfo.GMI}}%</div>\n                    </div>\n                    <div class='report-main-data-list'>\n                        <div class='report-main-data-label'>\n                            <div class='report-main-data-label-text' >CV 变异系数：</div>\n                            <div class='report-main-data-label-tip' >目标值＜33%</div>\n                        </div>\n                        <div class='report-main-data-val'>{{bgInfo.CV}}%</div>\n                    </div>\n                </div>\n                <div class='report-main-data-tir report-main' >\n                    <div class='report-module-title' >\n                        <div class='report-module-title-border' ></div>\n                        <div class='report-module-title-text' >葡萄糖目标范围内时间</div>\n                    </div>\n                    <div class='report-module-tips report-module-tips-only' >\n                        葡萄糖目标范围内占比越高，代表血糖控制的越好。\n                    </div>\n                    <div class='tir-box' >\n                        <TIR/>\n                    </div>\n                    \n                </div>\n            </div>\n            <!-- AGP图谱 -->\n            <div class='report-main-agp report-main' >\n                <div class='report-module-title' >\n                    <div class='report-module-title-border' ></div>\n                    <div class='report-module-title-text' >AGP图谱</div>\n                </div>\n                <div class='report-module-tips' >\n                     <div class='report-module-tips' >\n                       中位数葡萄糖曲位于目标范围内，且越平坦，表示血糖稳定性越好。25%-75%区间（图中深蓝色区域）与5%-95%区间（图中浅蓝色区域）均显示日间血糖波动情况，区间越宽提示相应时间段血糖波动越大。其中影响 25%-75%区间的因素主要是是生理状态(如胰岛素抵抗等)和药物治疗等。影响5%-95%区间的因素主要是饮食，运动等。\n                    </div>\n                </div>\n                <div class='agp-box' >\n                    <AGP/>\n                </div>\n            </div>\n            <!-- 每日血糖 -->\n            <div class='report-main-day report-main' >\n                <div class='report-module-title' >\n                    <div class='report-module-title-border' ></div>\n                    <div class='report-module-title-text' >每日血糖简图</div>\n                </div>\n                <div class='report-module-tips' >\n                     <div class='report-module-tips' >\n                       每日血糖展示了14天中每天的血糖变化情况。\n                    </div>\n                </div>\n                <div class='day-chart-box'>\n                    <DayChart/>\n                </div>\n            </div>\n            <!-- 参数解释 -->\n            <div class='report-main-params' >\n                <div class='report-main-params-title' >参数解释</div>\n                <div class='report-main-params-item' >\n                    1.平均葡萄糖值（MG）：CGM 监测期间所有葡萄糖值的平均值，用于评价整体血糖水平。<br/>\n                    2.葡萄糖管理指标（GMI）：预估糖化血红蛋白(eHbA1c)，根据 CGM 葡萄糖读数估算 HbA1c，用于评价整体血糖水平<br/>\n                    3.变异系数(CV)：葡萄糖标准差与平均葡萄糖比值所得百分数，用于评价血糖波动。<br/>\n                    4.葡萄糖目标范围内百分比(TIR)：指葡萄糖在目标范围内的时间或其所占的百分比，<br/>\n                    5.葡萄糖高于目标范围百分比(TAR)：指葡萄糖高于目标范围的时间或其所占的百分比<br/>\n                    6.葡萄糖低于目标范围百分比(TBR):指葡萄糖低于目标范围的时间或其所占的百分比。<br/>\n                </div>\n                <div class='report-main-params-title' >参考文献</div>\n                <div class='report-main-params-item' >\n                    动态葡萄糖图谱报告临床应用专家共识（2023版）\n                </div>\n            </div>\n            <img src=\"~@/assets/image/test.jpg\" alt=\"\" class='test' >\n    </div>\n</template>\n<script>\nimport TIR from '@/views/components/Chart/TIR'\nimport AGP from '@/views/components/Chart/AGPchart'\nimport DayChart from '@/views/components/Chart/DayChart'\nimport {getAgpData} from '@/api/dataApi'\nimport {formatDate,formatTime} from '@/utils/formatTime'\nimport { GlucoseUtils } from \"@/utils/algorithm/Glucose\";\nexport default {\n    data(){\n        return{\n            bgInfo:''\n        }\n    },\n     components: {\n        TIR,AGP,DayChart\n    },\n    mounted(){\n        const end = new Date('2024-06-03 23:59:00');\n        const start = new Date('2024-05-20 00:00:00');\n        this.agpDate = [formatDate(start,\"YYYY-mm-dd\"), formatDate(end,\"YYYY-mm-dd\")] \n        if( _.indexOf(this.$store.state.report.chooseDateList,this.agpDate.join('/'))==-1){\n            this.getData()\n        }else{\n            this.$bus.$emit('getVuexTag',this.agpDate.join('/'))\n        }\n    },\n    methods:{\n       // 从云拉取数据\n        getData(){\n            let s = new Date(this.agpDate[0])\n            let e = new Date(this.agpDate[1])\n            let start_ts = s.setHours(0,0,0)/1000\n            let end_ts = e.setHours(23,59,59)/1000\n            this.loading = true\n            getAgpData({start_ts:start_ts,end_ts:end_ts}).then(response => {\n\t\t\t\t\t\t\tif(response.code == 1000){\n                                let arrayData = response.data\n                                this.loading = false\n                                if(arrayData.length>0){\n                                    console.log(formatTime(new Date()),'得到数据')   \n                                    this.empty = false\n                                    this.list = arrayData\n                                    this.bgInfo = GlucoseUtils.calculateMeanCvGmi(_.map(arrayData,'Value'))\n                                    console.log(this.bgInfo)\n                                    handel(arrayData)\n                                    this.$bus.$emit('getDatas',[this.agpDate.join('/'),arrayData])\n                                    this.$store.dispatch('setChooseDateList',this.agpDate.join('/'))\n                                    \n                                }else{\n                                    this.empty = true\n                                }\n\t\t\t\t\t\t\t}else{\n                                this.loading = false\n\t\t\t\t\t\t\t\tthis.$message({\n                                    type: 'error',\n                                    message: response.msg\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n            }).catch((res) => {\n                console.log(res)\n            })\n        },\n        // cgm有效时间占比\n        handel(dataArray){\n            let filteredArray = dataArray.filter(val => val >= 40 && val <= 400);\n            console.log(filteredArray/dataArray,_.round((filteredArray/dataArray)*100,1))\n            this.bgInfo.effective = _.round((filteredArray/dataArray)*100,1)\n        }\n    }\n}\n</script>\n<style scoped>\n.test{\n    margin:0 auto;\n    display: block;\n    position: absolute;\n    opacity: 0;\n    left:0;\n    top:0;\n}\n @media print {\n        #report {\n            /* transform: scale(0.35);\n            transform-origin: top center; */\n            -webkit-print-color-adjuset:exact;\n            color-adjust: exact;\n        }\n    }\n/* 内容框设置 */\n    #report{\n        width:1680px;\n        height:2375px;\n        background:#fff;\n        margin:0 auto;\n        overflow: hidden;\n        box-sizing: border-box;\n        padding:75px 80px 0 80px;\n        position: relative;\n       \n    }\n    .report-main{\n        box-sizing: border-box;\n        padding:24px 20px 0 20px;\n    }\n/* 头部信息 */\n    .report-main-title-info{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom:20px;\n        position: relative;\n    }\n    .report-logo{\n        width:60px;\n        height:60px;\n        display: block;\n    }\n    .report-main-title{\n        font-size:50px;\n        color:var(--color-primary);\n        /* font-family:MiLan-Medium; */\n        font-weight: 440;\n        text-align: center;\n        position: absolute;\n        left:0;\n        top:0;\n        width:100%;\n    }\n    .report-main-date{\n        font-size:20px;\n        color:var(--color-black-100);\n        display: flex;\n        align-items: center;\n    }\n    .repart-main-dirver-box{\n        width:20px;\n        height:20px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin:0 2px;\n    }\n    .repart-main-dirver{\n        width:16px;\n        height:1px;\n        background:var(--color-black-100);\n    }\n/* 模块标题 */\n    .report-module-title{\n        width:100%;\n        height:50px;\n        border-radius:4px;\n        background:rgba(50,186,192,0.1);\n        display: flex;\n        align-items: center;\n        box-shadow: 0px 2px 20px 0px rgba(0, 0, 0, 0.05);\n    }\n    .report-module-title-border{\n        width:3px;\n        height:24px;\n        background:var(--color-primary);\n        margin-left:10px;\n    }\n    .report-module-title-text{\n        font-size:20px;\n        color:var(--color-black-100);\n        /* font-family:MiLan-Medium; */\n        margin-left:4px;\n        font-weight: 700;\n    }\n    .report-module-tips{\n        font-size:16px;\n        color:var(--color-black-60);\n        padding:5px 0 0 10px;\n    }\n    .report-module-tips-only{\n        padding:10px 0 0 10px;\n    }\n/* 基本信息 */\n    .report-main-base-info{\n        width:100%;\n        height:209px;\n    }\n    .report-base-user{\n        width:100%;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin:20px 0;\n        height:35px;\n        box-sizing: border-box;\n        padding:0px 20px 0px 10px;\n    }\n    .report-base-user-item{\n        display: flex;\n        align-items: center;\n        font-size:20px;\n    }\n    .report-base-user-label{\n        color:var(--color-black-60);\n    }\n    .report-base-user-value{\n        color:var(--color-black-100);\n    }\n    .report-data-source{\n        width:100%;\n        height:52px;\n        padding-left:20px;\n        padding-right:60px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        background:#f7f7f7;\n    }\n/* 血糖数据、TIR */\n    .report-main-data-tir-box{\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .report-main-data-tir{\n        width:750px;\n        height:446px;\n    }\n    .report-main-data-list{\n        width:690px;\n        height:75px;\n        box-sizing: border-box;\n        margin:0 auto;\n        border-bottom:1px solid rgba(0, 0, 0, 0.3);\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .report-main-data-label-text{\n        font-size:20px;\n        color:var(--color-black-100);\n        height:27px;\n        line-height: 27px;\n    }\n    .report-main-data-label-tip{\n        font-size:16px;\n        color:var(--color-black-60);\n        height:18px;\n        line-height: 18px;\n    }\n    .report-main-data-val{\n        font-size:24px;\n        color:var(--color-black-100);\n        font-weight: 440;\n        font-family:MiLan-Medium;\n    }\n    .tir-box{\n        padding:20px 0 0 20px;\n    }\n/* agp图谱 */\n    .report-main-agp{\n        width:100%;\n        height:567px;\n    }\n    .agp-box{\n        margin-top:20px;\n    }\n/* 每日血糖曲线 */\n    .report-main-day{\n        width:100%;\n        height:691px;\n    }\n    .day-chart-box{\n        margin-top:16px;\n    }\n/* 参数解释 */\n    .report-main-params{\n        width:1480px;\n        height:239px;\n        background:#f7f7f7;\n        border-radius:10px;\n        padding:26px 20px 20px 20px;\n        margin:0 auto;\n    }\n    .report-main-params-title{\n        font-size:16px;\n        color:var(--color-black-100);\n        line-height: 21px;\n    }\n     .report-main-params-item{\n        font-size:16px;\n        color:var(--color-black-60);\n        line-height: 21px;\n        margin-bottom:8px;\n     }\n</style>"],"mappings":"AA6JA,OAAAA,GAAA;AACA,OAAAC,GAAA;AACA,OAAAC,QAAA;AACA,SAAAC,UAAA;AACA,SAAAC,UAAA,EAAAC,UAAA;AACA,SAAAC,YAAA;AACA;EACAC,KAAA;IACA;MACAC,MAAA;IACA;EACA;EACAC,UAAA;IACAT,GAAA;IAAAC,GAAA;IAAAC;EACA;EACAQ,QAAA;IACA,MAAAC,GAAA,OAAAC,IAAA;IACA,MAAAC,KAAA,OAAAD,IAAA;IACA,KAAAE,OAAA,IAAAV,UAAA,CAAAS,KAAA,iBAAAT,UAAA,CAAAO,GAAA;IACA,IAAAI,CAAA,CAAAC,OAAA,MAAAC,MAAA,CAAAC,KAAA,CAAAC,MAAA,CAAAC,cAAA,OAAAN,OAAA,CAAAO,IAAA;MACA,KAAAC,OAAA;IACA;MACA,KAAAC,IAAA,CAAAC,KAAA,oBAAAV,OAAA,CAAAO,IAAA;IACA;EACA;EACAI,OAAA;IACA;IACAH,QAAA;MACA,IAAAI,CAAA,OAAAd,IAAA,MAAAE,OAAA;MACA,IAAAa,CAAA,OAAAf,IAAA,MAAAE,OAAA;MACA,IAAAc,QAAA,GAAAF,CAAA,CAAAG,QAAA;MACA,IAAAC,MAAA,GAAAH,CAAA,CAAAE,QAAA;MACA,KAAAE,OAAA;MACA5B,UAAA;QAAAyB,QAAA,EAAAA,QAAA;QAAAE,MAAA,EAAAA;MAAA,GAAAE,IAAA,CAAAC,QAAA;QACA,IAAAA,QAAA,CAAAC,IAAA;UACA,IAAAC,SAAA,GAAAF,QAAA,CAAA1B,IAAA;UACA,KAAAwB,OAAA;UACA,IAAAI,SAAA,CAAAC,MAAA;YACAC,OAAA,CAAAC,GAAA,CAAAjC,UAAA,KAAAO,IAAA;YACA,KAAA2B,KAAA;YACA,KAAAC,IAAA,GAAAL,SAAA;YACA,KAAA3B,MAAA,GAAAF,YAAA,CAAAmC,kBAAA,CAAA1B,CAAA,CAAA2B,GAAA,CAAAP,SAAA;YACAE,OAAA,CAAAC,GAAA,MAAA9B,MAAA;YACAmC,MAAA,CAAAR,SAAA;YACA,KAAAZ,IAAA,CAAAC,KAAA,mBAAAV,OAAA,CAAAO,IAAA,OAAAc,SAAA;YACA,KAAAlB,MAAA,CAAA2B,QAAA,2BAAA9B,OAAA,CAAAO,IAAA;UAEA;YACA,KAAAkB,KAAA;UACA;QACA;UACA,KAAAR,OAAA;UACA,KAAAc,QAAA;YACAC,IAAA;YACAC,OAAA,EAAAd,QAAA,CAAAe;UACA;QACA;MACA,GAAAC,KAAA,CAAAC,GAAA;QACAb,OAAA,CAAAC,GAAA,CAAAY,GAAA;MACA;IACA;IACA;IACAP,OAAAQ,SAAA;MACA,IAAAC,aAAA,GAAAD,SAAA,CAAAE,MAAA,CAAAC,GAAA,IAAAA,GAAA,UAAAA,GAAA;MACAjB,OAAA,CAAAC,GAAA,CAAAc,aAAA,GAAAD,SAAA,EAAApC,CAAA,CAAAwC,KAAA,CAAAH,aAAA,GAAAD,SAAA;MACA,KAAA3C,MAAA,CAAAgD,SAAA,GAAAzC,CAAA,CAAAwC,KAAA,CAAAH,aAAA,GAAAD,SAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}