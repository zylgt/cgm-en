{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ipToBuffer = exports.int32ToIpv4 = exports.ipv4ToInt32 = exports.validateSocksClientChainOptions = exports.validateSocksClientOptions = void 0;\nconst util_1 = require(\"./util\");\nconst constants_1 = require(\"./constants\");\nconst stream = require(\"stream\");\nconst ip_address_1 = require(\"ip-address\");\nconst net = require(\"net\");\n/**\n * Validates the provided SocksClientOptions\n * @param options { SocksClientOptions }\n * @param acceptedCommands { string[] } A list of accepted SocksProxy commands.\n */\nfunction validateSocksClientOptions(options, acceptedCommands = ['connect', 'bind', 'associate']) {\n  // Check SOCKs command option.\n  if (!constants_1.SocksCommand[options.command]) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommand, options);\n  }\n  // Check SocksCommand for acceptable command.\n  if (acceptedCommands.indexOf(options.command) === -1) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommandForOperation, options);\n  }\n  // Check destination\n  if (!isValidSocksRemoteHost(options.destination)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsDestination, options);\n  }\n  // Check SOCKS proxy to use\n  if (!isValidSocksProxy(options.proxy)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxy, options);\n  }\n  // Validate custom auth (if set)\n  validateCustomProxyAuth(options.proxy, options);\n  // Check timeout\n  if (options.timeout && !isValidTimeoutValue(options.timeout)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsTimeout, options);\n  }\n  // Check existing_socket (if provided)\n  if (options.existing_socket && !(options.existing_socket instanceof stream.Duplex)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsExistingSocket, options);\n  }\n}\nexports.validateSocksClientOptions = validateSocksClientOptions;\n/**\n * Validates the SocksClientChainOptions\n * @param options { SocksClientChainOptions }\n */\nfunction validateSocksClientChainOptions(options) {\n  // Only connect is supported when chaining.\n  if (options.command !== 'connect') {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksCommandChain, options);\n  }\n  // Check destination\n  if (!isValidSocksRemoteHost(options.destination)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsDestination, options);\n  }\n  // Validate proxies (length)\n  if (!(options.proxies && Array.isArray(options.proxies) && options.proxies.length >= 2)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxiesLength, options);\n  }\n  // Validate proxies\n  options.proxies.forEach(proxy => {\n    if (!isValidSocksProxy(proxy)) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsProxy, options);\n    }\n    // Validate custom auth (if set)\n    validateCustomProxyAuth(proxy, options);\n  });\n  // Check timeout\n  if (options.timeout && !isValidTimeoutValue(options.timeout)) {\n    throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsTimeout, options);\n  }\n}\nexports.validateSocksClientChainOptions = validateSocksClientChainOptions;\nfunction validateCustomProxyAuth(proxy, options) {\n  if (proxy.custom_auth_method !== undefined) {\n    // Invalid auth method range\n    if (proxy.custom_auth_method < constants_1.SOCKS5_CUSTOM_AUTH_START || proxy.custom_auth_method > constants_1.SOCKS5_CUSTOM_AUTH_END) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthRange, options);\n    }\n    // Missing custom_auth_request_handler\n    if (proxy.custom_auth_request_handler === undefined || typeof proxy.custom_auth_request_handler !== 'function') {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n    // Missing custom_auth_response_size\n    if (proxy.custom_auth_response_size === undefined) {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n    // Missing/invalid custom_auth_response_handler\n    if (proxy.custom_auth_response_handler === undefined || typeof proxy.custom_auth_response_handler !== 'function') {\n      throw new util_1.SocksClientError(constants_1.ERRORS.InvalidSocksClientOptionsCustomAuthOptions, options);\n    }\n  }\n}\n/**\n * Validates a SocksRemoteHost\n * @param remoteHost { SocksRemoteHost }\n */\nfunction isValidSocksRemoteHost(remoteHost) {\n  return remoteHost && typeof remoteHost.host === 'string' && typeof remoteHost.port === 'number' && remoteHost.port >= 0 && remoteHost.port <= 65535;\n}\n/**\n * Validates a SocksProxy\n * @param proxy { SocksProxy }\n */\nfunction isValidSocksProxy(proxy) {\n  return proxy && (typeof proxy.host === 'string' || typeof proxy.ipaddress === 'string') && typeof proxy.port === 'number' && proxy.port >= 0 && proxy.port <= 65535 && (proxy.type === 4 || proxy.type === 5);\n}\n/**\n * Validates a timeout value.\n * @param value { Number }\n */\nfunction isValidTimeoutValue(value) {\n  return typeof value === 'number' && value > 0;\n}\nfunction ipv4ToInt32(ip) {\n  const address = new ip_address_1.Address4(ip);\n  // Convert the IPv4 address parts to an integer\n  return address.toArray().reduce((acc, part) => (acc << 8) + part, 0);\n}\nexports.ipv4ToInt32 = ipv4ToInt32;\nfunction int32ToIpv4(int32) {\n  // Extract each byte (octet) from the 32-bit integer\n  const octet1 = int32 >>> 24 & 0xff;\n  const octet2 = int32 >>> 16 & 0xff;\n  const octet3 = int32 >>> 8 & 0xff;\n  const octet4 = int32 & 0xff;\n  // Combine the octets into a string in IPv4 format\n  return [octet1, octet2, octet3, octet4].join('.');\n}\nexports.int32ToIpv4 = int32ToIpv4;\nfunction ipToBuffer(ip) {\n  if (net.isIPv4(ip)) {\n    // Handle IPv4 addresses\n    const address = new ip_address_1.Address4(ip);\n    return Buffer.from(address.toArray());\n  } else if (net.isIPv6(ip)) {\n    // Handle IPv6 addresses\n    const address = new ip_address_1.Address6(ip);\n    return Buffer.from(address.canonicalForm().split(':').map(segment => segment.padStart(4, '0')).join(''), 'hex');\n  } else {\n    throw new Error('Invalid IP address format');\n  }\n}\nexports.ipToBuffer = ipToBuffer;","map":{"version":3,"names":["util_1","require","constants_1","stream","ip_address_1","net","validateSocksClientOptions","options","acceptedCommands","SocksCommand","command","SocksClientError","ERRORS","InvalidSocksCommand","indexOf","InvalidSocksCommandForOperation","isValidSocksRemoteHost","destination","InvalidSocksClientOptionsDestination","isValidSocksProxy","proxy","InvalidSocksClientOptionsProxy","validateCustomProxyAuth","timeout","isValidTimeoutValue","InvalidSocksClientOptionsTimeout","existing_socket","Duplex","InvalidSocksClientOptionsExistingSocket","exports","validateSocksClientChainOptions","InvalidSocksCommandChain","proxies","Array","isArray","length","InvalidSocksClientOptionsProxiesLength","forEach","custom_auth_method","undefined","SOCKS5_CUSTOM_AUTH_START","SOCKS5_CUSTOM_AUTH_END","InvalidSocksClientOptionsCustomAuthRange","custom_auth_request_handler","InvalidSocksClientOptionsCustomAuthOptions","custom_auth_response_size","custom_auth_response_handler","remoteHost","host","port","ipaddress","type","value","ipv4ToInt32","ip","address","Address4","toArray","reduce","acc","part","int32ToIpv4","int32","octet1","octet2","octet3","octet4","join","ipToBuffer","isIPv4","Buffer","from","isIPv6","Address6","canonicalForm","split","map","segment","padStart","Error"],"sources":["../../src/common/helpers.ts"],"sourcesContent":[null],"mappings":";;;;;;AAKA,MAAAA,MAAA,GAAAC,OAAA;AACA,MAAAC,WAAA,GAAAD,OAAA;AAOA,MAAAE,MAAA,GAAAF,OAAA;AACA,MAAAG,YAAA,GAAAH,OAAA;AACA,MAAAI,GAAA,GAAAJ,OAAA;AAEA;;;;;AAKA,SAASK,0BAA0BA,CACjCC,OAA2B,EAC3BC,gBAAgB,GAAG,CAAC,SAAS,EAAE,MAAM,EAAE,WAAW,CAAC;EAEnD;EACA,IAAI,CAACN,WAAA,CAAAO,YAAY,CAACF,OAAO,CAACG,OAAO,CAAC,EAAE;IAClC,MAAM,IAAIV,MAAA,CAAAW,gBAAgB,CAACT,WAAA,CAAAU,MAAM,CAACC,mBAAmB,EAAEN,OAAO,CAAC;EACjE;EAEA;EACA,IAAIC,gBAAgB,CAACM,OAAO,CAACP,OAAO,CAACG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE;IACpD,MAAM,IAAIV,MAAA,CAAAW,gBAAgB,CAACT,WAAA,CAAAU,MAAM,CAACG,+BAA+B,EAAER,OAAO,CAAC;EAC7E;EAEA;EACA,IAAI,CAACS,sBAAsB,CAACT,OAAO,CAACU,WAAW,CAAC,EAAE;IAChD,MAAM,IAAIjB,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACM,oCAAoC,EAC3CX,OAAO,CACR;EACH;EAEA;EACA,IAAI,CAACY,iBAAiB,CAACZ,OAAO,CAACa,KAAK,CAAC,EAAE;IACrC,MAAM,IAAIpB,MAAA,CAAAW,gBAAgB,CAACT,WAAA,CAAAU,MAAM,CAACS,8BAA8B,EAAEd,OAAO,CAAC;EAC5E;EAEA;EACAe,uBAAuB,CAACf,OAAO,CAACa,KAAK,EAAEb,OAAO,CAAC;EAE/C;EACA,IAAIA,OAAO,CAACgB,OAAO,IAAI,CAACC,mBAAmB,CAACjB,OAAO,CAACgB,OAAO,CAAC,EAAE;IAC5D,MAAM,IAAIvB,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACa,gCAAgC,EACvClB,OAAO,CACR;EACH;EAEA;EACA,IACEA,OAAO,CAACmB,eAAe,IACvB,EAAEnB,OAAO,CAACmB,eAAe,YAAYvB,MAAM,CAACwB,MAAM,CAAC,EACnD;IACA,MAAM,IAAI3B,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACgB,uCAAuC,EAC9CrB,OAAO,CACR;EACH;AACF;AA6IQsB,OAAA,CAAAvB,0BAAA,GAAAA,0BAAA;AA3IR;;;;AAIA,SAASwB,+BAA+BA,CAACvB,OAAgC;EACvE;EACA,IAAIA,OAAO,CAACG,OAAO,KAAK,SAAS,EAAE;IACjC,MAAM,IAAIV,MAAA,CAAAW,gBAAgB,CAACT,WAAA,CAAAU,MAAM,CAACmB,wBAAwB,EAAExB,OAAO,CAAC;EACtE;EAEA;EACA,IAAI,CAACS,sBAAsB,CAACT,OAAO,CAACU,WAAW,CAAC,EAAE;IAChD,MAAM,IAAIjB,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACM,oCAAoC,EAC3CX,OAAO,CACR;EACH;EAEA;EACA,IACE,EACEA,OAAO,CAACyB,OAAO,IACfC,KAAK,CAACC,OAAO,CAAC3B,OAAO,CAACyB,OAAO,CAAC,IAC9BzB,OAAO,CAACyB,OAAO,CAACG,MAAM,IAAI,CAAC,CAC5B,EACD;IACA,MAAM,IAAInC,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACwB,sCAAsC,EAC7C7B,OAAO,CACR;EACH;EAEA;EACAA,OAAO,CAACyB,OAAO,CAACK,OAAO,CAAEjB,KAAiB,IAAI;IAC5C,IAAI,CAACD,iBAAiB,CAACC,KAAK,CAAC,EAAE;MAC7B,MAAM,IAAIpB,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACS,8BAA8B,EACrCd,OAAO,CACR;IACH;IAEA;IACAe,uBAAuB,CAACF,KAAK,EAAEb,OAAO,CAAC;EACzC,CAAC,CAAC;EAEF;EACA,IAAIA,OAAO,CAACgB,OAAO,IAAI,CAACC,mBAAmB,CAACjB,OAAO,CAACgB,OAAO,CAAC,EAAE;IAC5D,MAAM,IAAIvB,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACa,gCAAgC,EACvClB,OAAO,CACR;EACH;AACF;AAuFoCsB,OAAA,CAAAC,+BAAA,GAAAA,+BAAA;AArFpC,SAASR,uBAAuBA,CAC9BF,KAAiB,EACjBb,OAAqD;EAErD,IAAIa,KAAK,CAACkB,kBAAkB,KAAKC,SAAS,EAAE;IAC1C;IACA,IACEnB,KAAK,CAACkB,kBAAkB,GAAGpC,WAAA,CAAAsC,wBAAwB,IACnDpB,KAAK,CAACkB,kBAAkB,GAAGpC,WAAA,CAAAuC,sBAAsB,EACjD;MACA,MAAM,IAAIzC,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAAC8B,wCAAwC,EAC/CnC,OAAO,CACR;IACH;IAEA;IACA,IACEa,KAAK,CAACuB,2BAA2B,KAAKJ,SAAS,IAC/C,OAAOnB,KAAK,CAACuB,2BAA2B,KAAK,UAAU,EACvD;MACA,MAAM,IAAI3C,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACgC,0CAA0C,EACjDrC,OAAO,CACR;IACH;IAEA;IACA,IAAIa,KAAK,CAACyB,yBAAyB,KAAKN,SAAS,EAAE;MACjD,MAAM,IAAIvC,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACgC,0CAA0C,EACjDrC,OAAO,CACR;IACH;IAEA;IACA,IACEa,KAAK,CAAC0B,4BAA4B,KAAKP,SAAS,IAChD,OAAOnB,KAAK,CAAC0B,4BAA4B,KAAK,UAAU,EACxD;MACA,MAAM,IAAI9C,MAAA,CAAAW,gBAAgB,CACxBT,WAAA,CAAAU,MAAM,CAACgC,0CAA0C,EACjDrC,OAAO,CACR;IACH;EACF;AACF;AAEA;;;;AAIA,SAASS,sBAAsBA,CAAC+B,UAA2B;EACzD,OACEA,UAAU,IACV,OAAOA,UAAU,CAACC,IAAI,KAAK,QAAQ,IACnC,OAAOD,UAAU,CAACE,IAAI,KAAK,QAAQ,IACnCF,UAAU,CAACE,IAAI,IAAI,CAAC,IACpBF,UAAU,CAACE,IAAI,IAAI,KAAK;AAE5B;AAEA;;;;AAIA,SAAS9B,iBAAiBA,CAACC,KAAiB;EAC1C,OACEA,KAAK,KACJ,OAAOA,KAAK,CAAC4B,IAAI,KAAK,QAAQ,IAAI,OAAO5B,KAAK,CAAC8B,SAAS,KAAK,QAAQ,CAAC,IACvE,OAAO9B,KAAK,CAAC6B,IAAI,KAAK,QAAQ,IAC9B7B,KAAK,CAAC6B,IAAI,IAAI,CAAC,IACf7B,KAAK,CAAC6B,IAAI,IAAI,KAAK,KAClB7B,KAAK,CAAC+B,IAAI,KAAK,CAAC,IAAI/B,KAAK,CAAC+B,IAAI,KAAK,CAAC,CAAC;AAE1C;AAEA;;;;AAIA,SAAS3B,mBAAmBA,CAAC4B,KAAa;EACxC,OAAO,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,GAAG,CAAC;AAC/C;AAIA,SAAgBC,WAAWA,CAACC,EAAU;EACpC,MAAMC,OAAO,GAAG,IAAInD,YAAA,CAAAoD,QAAQ,CAACF,EAAE,CAAC;EAChC;EACA,OAAOC,OAAO,CAACE,OAAO,EAAE,CAACC,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAK,CAACD,GAAG,IAAI,CAAC,IAAIC,IAAI,EAAE,CAAC,CAAC;AACtE;AAJA/B,OAAA,CAAAwB,WAAA,GAAAA,WAAA;AAMA,SAAgBQ,WAAWA,CAACC,KAAa;EACvC;EACA,MAAMC,MAAM,GAAID,KAAK,KAAK,EAAE,GAAI,IAAI;EACpC,MAAME,MAAM,GAAIF,KAAK,KAAK,EAAE,GAAI,IAAI;EACpC,MAAMG,MAAM,GAAIH,KAAK,KAAK,CAAC,GAAI,IAAI;EACnC,MAAMI,MAAM,GAAGJ,KAAK,GAAG,IAAI;EAE3B;EACA,OAAO,CAACC,MAAM,EAAEC,MAAM,EAAEC,MAAM,EAAEC,MAAM,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;AACnD;AATAtC,OAAA,CAAAgC,WAAA,GAAAA,WAAA;AAWA,SAAgBO,UAAUA,CAACd,EAAU;EACnC,IAAIjD,GAAG,CAACgE,MAAM,CAACf,EAAE,CAAC,EAAE;IAClB;IACA,MAAMC,OAAO,GAAG,IAAInD,YAAA,CAAAoD,QAAQ,CAACF,EAAE,CAAC;IAChC,OAAOgB,MAAM,CAACC,IAAI,CAAChB,OAAO,CAACE,OAAO,EAAE,CAAC;EACvC,CAAC,MAAM,IAAIpD,GAAG,CAACmE,MAAM,CAAClB,EAAE,CAAC,EAAE;IACzB;IACA,MAAMC,OAAO,GAAG,IAAInD,YAAA,CAAAqE,QAAQ,CAACnB,EAAE,CAAC;IAChC,OAAOgB,MAAM,CAACC,IAAI,CAChBhB,OAAO,CACJmB,aAAa,EAAE,CACfC,KAAK,CAAC,GAAG,CAAC,CACVC,GAAG,CAAEC,OAAO,IAAKA,OAAO,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAC1CX,IAAI,CAAC,EAAE,CAAC,EACX,KAAK,CACN;EACH,CAAC,MAAM;IACL,MAAM,IAAIY,KAAK,CAAC,2BAA2B,CAAC;EAC9C;AACF;AAnBAlD,OAAA,CAAAuC,UAAA,GAAAA,UAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}