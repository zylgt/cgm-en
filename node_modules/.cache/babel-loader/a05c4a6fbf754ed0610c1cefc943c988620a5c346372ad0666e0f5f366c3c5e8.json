{"ast":null,"code":"/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { firstValueFrom, from, merge, raceWith } from '../../third_party/rxjs/rxjs.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { debugError, fromEmitterEvent, filterAsync, timeout } from '../common/util.js';\nimport { asyncDisposeSymbol, disposeSymbol } from '../util/disposable.js';\n/**\n * @internal\n */\nexport const WEB_PERMISSION_TO_PROTOCOL_PERMISSION = new Map([['geolocation', 'geolocation'], ['midi', 'midi'], ['notifications', 'notifications'],\n// TODO: push isn't a valid type?\n// ['push', 'push'],\n['camera', 'videoCapture'], ['microphone', 'audioCapture'], ['background-sync', 'backgroundSync'], ['ambient-light-sensor', 'sensors'], ['accelerometer', 'sensors'], ['gyroscope', 'sensors'], ['magnetometer', 'sensors'], ['accessibility-events', 'accessibilityEvents'], ['clipboard-read', 'clipboardReadWrite'], ['clipboard-write', 'clipboardReadWrite'], ['clipboard-sanitized-write', 'clipboardSanitizedWrite'], ['payment-handler', 'paymentHandler'], ['persistent-storage', 'durableStorage'], ['idle-detection', 'idleDetection'],\n// chrome-specific permissions we have.\n['midi-sysex', 'midiSysex']]);\n/**\n * {@link Browser} represents a browser instance that is either:\n *\n * - connected to via {@link Puppeteer.connect} or\n * - launched by {@link PuppeteerNode.launch}.\n *\n * {@link Browser} {@link EventEmitter.emit | emits} various events which are\n * documented in the {@link BrowserEvent} enum.\n *\n * @example Using a {@link Browser} to create a {@link Page}:\n *\n * ```ts\n * import puppeteer from 'puppeteer';\n *\n * const browser = await puppeteer.launch();\n * const page = await browser.newPage();\n * await page.goto('https://example.com');\n * await browser.close();\n * ```\n *\n * @example Disconnecting from and reconnecting to a {@link Browser}:\n *\n * ```ts\n * import puppeteer from 'puppeteer';\n *\n * const browser = await puppeteer.launch();\n * // Store the endpoint to be able to reconnect to the browser.\n * const browserWSEndpoint = browser.wsEndpoint();\n * // Disconnect puppeteer from the browser.\n * await browser.disconnect();\n *\n * // Use the endpoint to reestablish a connection\n * const browser2 = await puppeteer.connect({browserWSEndpoint});\n * // Close the browser.\n * await browser2.close();\n * ```\n *\n * @public\n */\nexport class Browser extends EventEmitter {\n  /**\n   * @internal\n   */\n  constructor() {\n    super();\n  }\n  /**\n   * Waits until a {@link Target | target} matching the given `predicate`\n   * appears and returns it.\n   *\n   * This will look all open {@link BrowserContext | browser contexts}.\n   *\n   * @example Finding a target for a page opened via `window.open`:\n   *\n   * ```ts\n   * await page.evaluate(() => window.open('https://www.example.com/'));\n   * const newWindowTarget = await browser.waitForTarget(\n   *   target => target.url() === 'https://www.example.com/'\n   * );\n   * ```\n   */\n  async waitForTarget(predicate, options = {}) {\n    const {\n      timeout: ms = 30000\n    } = options;\n    return await firstValueFrom(merge(fromEmitterEvent(this, \"targetcreated\" /* BrowserEvent.TargetCreated */), fromEmitterEvent(this, \"targetchanged\" /* BrowserEvent.TargetChanged */), from(this.targets())).pipe(filterAsync(predicate), raceWith(timeout(ms))));\n  }\n  /**\n   * Gets a list of all open {@link Page | pages} inside this {@link Browser}.\n   *\n   * If there ar multiple {@link BrowserContext | browser contexts}, this\n   * returns all {@link Page | pages} in all\n   * {@link BrowserContext | browser contexts}.\n   *\n   * @remarks Non-visible {@link Page | pages}, such as `\"background_page\"`,\n   * will not be listed here. You can find them using {@link Target.page}.\n   */\n  async pages() {\n    const contextPages = await Promise.all(this.browserContexts().map(context => {\n      return context.pages();\n    }));\n    // Flatten array.\n    return contextPages.reduce((acc, x) => {\n      return acc.concat(x);\n    }, []);\n  }\n  /**\n   * Whether Puppeteer is connected to this {@link Browser | browser}.\n   *\n   * @deprecated Use {@link Browser | Browser.connected}.\n   */\n  isConnected() {\n    return this.connected;\n  }\n  /** @internal */\n  [disposeSymbol]() {\n    if (this.process()) {\n      return void this.close().catch(debugError);\n    }\n    return void this.disconnect().catch(debugError);\n  }\n  /** @internal */\n  [asyncDisposeSymbol]() {\n    if (this.process()) {\n      return this.close();\n    }\n    return this.disconnect();\n  }\n}","map":{"version":3,"names":["firstValueFrom","from","merge","raceWith","EventEmitter","debugError","fromEmitterEvent","filterAsync","timeout","asyncDisposeSymbol","disposeSymbol","WEB_PERMISSION_TO_PROTOCOL_PERMISSION","Map","Browser","constructor","waitForTarget","predicate","options","ms","targets","pipe","pages","contextPages","Promise","all","browserContexts","map","context","reduce","acc","x","concat","isConnected","connected","process","close","catch","disconnect"],"sources":["../../../../src/api/Browser.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}