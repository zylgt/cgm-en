{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2023 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nrequire(\"core-js/modules/web.url-search-params.delete.js\");\nrequire(\"core-js/modules/web.url-search-params.has.js\");\nrequire(\"core-js/modules/web.url-search-params.size.js\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._connectToBrowser = void 0;\nconst BrowserConnector_js_1 = require(\"../bidi/BrowserConnector.js\");\nconst BrowserConnector_js_2 = require(\"../cdp/BrowserConnector.js\");\nconst environment_js_1 = require(\"../environment.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst ErrorLike_js_1 = require(\"../util/ErrorLike.js\");\nconst getWebSocketTransportClass = async () => {\n  return environment_js_1.isNode ? (await Promise.resolve().then(() => __importStar(require('../node/NodeWebSocketTransport.js')))).NodeWebSocketTransport : (await Promise.resolve().then(() => __importStar(require('../common/BrowserWebSocketTransport.js')))).BrowserWebSocketTransport;\n};\n/**\n * Users should never call this directly; it's called when calling\n * `puppeteer.connect`. This method attaches Puppeteer to an existing browser instance.\n *\n * @internal\n */\nasync function _connectToBrowser(options) {\n  const {\n    connectionTransport,\n    endpointUrl\n  } = await getConnectionTransport(options);\n  if (options.protocol === 'webDriverBiDi') {\n    const bidiBrowser = await (0, BrowserConnector_js_1._connectToBiDiBrowser)(connectionTransport, endpointUrl, options);\n    return bidiBrowser;\n  } else {\n    const cdpBrowser = await (0, BrowserConnector_js_2._connectToCdpBrowser)(connectionTransport, endpointUrl, options);\n    return cdpBrowser;\n  }\n}\nexports._connectToBrowser = _connectToBrowser;\n/**\n * Establishes a websocket connection by given options and returns both transport and\n * endpoint url the transport is connected to.\n */\nasync function getConnectionTransport(options) {\n  const {\n    browserWSEndpoint,\n    browserURL,\n    transport,\n    headers = {}\n  } = options;\n  (0, assert_js_1.assert)(Number(!!browserWSEndpoint) + Number(!!browserURL) + Number(!!transport) === 1, 'Exactly one of browserWSEndpoint, browserURL or transport must be passed to puppeteer.connect');\n  if (transport) {\n    return {\n      connectionTransport: transport,\n      endpointUrl: ''\n    };\n  } else if (browserWSEndpoint) {\n    const WebSocketClass = await getWebSocketTransportClass();\n    const connectionTransport = await WebSocketClass.create(browserWSEndpoint, headers);\n    return {\n      connectionTransport: connectionTransport,\n      endpointUrl: browserWSEndpoint\n    };\n  } else if (browserURL) {\n    const connectionURL = await getWSEndpoint(browserURL);\n    const WebSocketClass = await getWebSocketTransportClass();\n    const connectionTransport = await WebSocketClass.create(connectionURL);\n    return {\n      connectionTransport: connectionTransport,\n      endpointUrl: connectionURL\n    };\n  }\n  throw new Error('Invalid connection options');\n}\nasync function getWSEndpoint(browserURL) {\n  const endpointURL = new URL('/json/version', browserURL);\n  try {\n    const result = await globalThis.fetch(endpointURL.toString(), {\n      method: 'GET'\n    });\n    if (!result.ok) {\n      throw new Error(`HTTP ${result.statusText}`);\n    }\n    const data = await result.json();\n    return data.webSocketDebuggerUrl;\n  } catch (error) {\n    if ((0, ErrorLike_js_1.isErrorLike)(error)) {\n      error.message = `Failed to fetch browser webSocket URL from ${endpointURL}: ` + error.message;\n    }\n    throw error;\n  }\n}","map":{"version":3,"names":["require","BrowserConnector_js_1","BrowserConnector_js_2","environment_js_1","assert_js_1","ErrorLike_js_1","getWebSocketTransportClass","isNode","Promise","resolve","then","__importStar","NodeWebSocketTransport","BrowserWebSocketTransport","_connectToBrowser","options","connectionTransport","endpointUrl","getConnectionTransport","protocol","bidiBrowser","_connectToBiDiBrowser","cdpBrowser","_connectToCdpBrowser","exports","browserWSEndpoint","browserURL","transport","headers","assert","Number","WebSocketClass","create","connectionURL","getWSEndpoint","Error","endpointURL","URL","result","globalThis","fetch","toString","method","ok","statusText","data","json","webSocketDebuggerUrl","error","isErrorLike","message"],"sources":["../../../../src/common/BrowserConnector.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}