{"ast":null,"code":"\"use strict\";\n\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nrequire(\"core-js/modules/es.array.push.js\");\nvar __addDisposableResource = this && this.__addDisposableResource || function (env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n      if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n      dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n      if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n      dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({\n      value: value,\n      dispose: dispose,\n      async: async\n    });\n  } else if (async) {\n    env.stack.push({\n      async: true\n    });\n  }\n  return value;\n};\nvar __disposeResources = this && this.__disposeResources || function (SuppressedError) {\n  return function (env) {\n    function fail(e) {\n      env.error = env.hasError ? new SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n      env.hasError = true;\n    }\n    function next() {\n      while (env.stack.length) {\n        var rec = env.stack.pop();\n        try {\n          var result = rec.dispose && rec.dispose.call(rec.value);\n          if (rec.async) return Promise.resolve(result).then(next, function (e) {\n            fail(e);\n            return next();\n          });\n        } catch (e) {\n          fail(e);\n        }\n      }\n      if (env.hasError) throw env.error;\n    }\n    return next();\n  };\n}(typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n});\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Binding = void 0;\n/**\n * @license\n * Copyright 2024 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nconst JSHandle_js_1 = require(\"../api/JSHandle.js\");\nconst util_js_1 = require(\"../common/util.js\");\nconst disposable_js_1 = require(\"../util/disposable.js\");\nconst ErrorLike_js_1 = require(\"../util/ErrorLike.js\");\n/**\n * @internal\n */\nvar _name = /*#__PURE__*/new WeakMap();\nvar _fn = /*#__PURE__*/new WeakMap();\nclass Binding {\n  constructor(name, fn) {\n    _classPrivateFieldInitSpec(this, _name, void 0);\n    _classPrivateFieldInitSpec(this, _fn, void 0);\n    _classPrivateFieldSet(_name, this, name);\n    _classPrivateFieldSet(_fn, this, fn);\n  }\n  get name() {\n    return _classPrivateFieldGet(_name, this);\n  }\n  /**\n   * @param context - Context to run the binding in; the context should have\n   * the binding added to it beforehand.\n   * @param id - ID of the call. This should come from the CDP\n   * `onBindingCalled` response.\n   * @param args - Plain arguments from CDP.\n   */\n  async run(context, id, args, isTrivial) {\n    const stack = new disposable_js_1.DisposableStack();\n    try {\n      if (!isTrivial) {\n        const env_1 = {\n          stack: [],\n          error: void 0,\n          hasError: false\n        };\n        try {\n          // Getting non-trivial arguments.\n          const handles = __addDisposableResource(env_1, await context.evaluateHandle((name, seq) => {\n            // @ts-expect-error Code is evaluated in a different context.\n            return globalThis[name].args.get(seq);\n          }, _classPrivateFieldGet(_name, this), id), false);\n          const properties = await handles.getProperties();\n          for (const [index, handle] of properties) {\n            // This is not straight-forward since some arguments can stringify, but\n            // aren't plain objects so add subtypes when the use-case arises.\n            if (index in args) {\n              switch (handle.remoteObject().subtype) {\n                case 'node':\n                  args[+index] = handle;\n                  break;\n                default:\n                  stack.use(handle);\n              }\n            } else {\n              stack.use(handle);\n            }\n          }\n        } catch (e_1) {\n          env_1.error = e_1;\n          env_1.hasError = true;\n        } finally {\n          __disposeResources(env_1);\n        }\n      }\n      await context.evaluate((name, seq, result) => {\n        // @ts-expect-error Code is evaluated in a different context.\n        const callbacks = globalThis[name].callbacks;\n        callbacks.get(seq).resolve(result);\n        callbacks.delete(seq);\n      }, _classPrivateFieldGet(_name, this), id, await _classPrivateFieldGet(_fn, this).call(this, ...args));\n      for (const arg of args) {\n        if (arg instanceof JSHandle_js_1.JSHandle) {\n          stack.use(arg);\n        }\n      }\n    } catch (error) {\n      if ((0, ErrorLike_js_1.isErrorLike)(error)) {\n        await context.evaluate((name, seq, message, stack) => {\n          const error = new Error(message);\n          error.stack = stack;\n          // @ts-expect-error Code is evaluated in a different context.\n          const callbacks = globalThis[name].callbacks;\n          callbacks.get(seq).reject(error);\n          callbacks.delete(seq);\n        }, _classPrivateFieldGet(_name, this), id, error.message, error.stack).catch(util_js_1.debugError);\n      } else {\n        await context.evaluate((name, seq, error) => {\n          // @ts-expect-error Code is evaluated in a different context.\n          const callbacks = globalThis[name].callbacks;\n          callbacks.get(seq).reject(error);\n          callbacks.delete(seq);\n        }, _classPrivateFieldGet(_name, this), id, error).catch(util_js_1.debugError);\n      }\n    }\n  }\n}\nexports.Binding = Binding;","map":{"version":3,"names":["JSHandle_js_1","require","util_js_1","disposable_js_1","ErrorLike_js_1","_name","WeakMap","_fn","Binding","constructor","name","fn","_classPrivateFieldInitSpec","_classPrivateFieldSet","_classPrivateFieldGet","run","context","id","args","isTrivial","stack","DisposableStack","handles","__addDisposableResource","env_1","evaluateHandle","seq","globalThis","get","properties","getProperties","index","handle","remoteObject","subtype","use","evaluate","result","callbacks","resolve","delete","call","arg","JSHandle","error","isErrorLike","message","Error","reject","catch","debugError","exports"],"sources":["../../../../src/cdp/Binding.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}