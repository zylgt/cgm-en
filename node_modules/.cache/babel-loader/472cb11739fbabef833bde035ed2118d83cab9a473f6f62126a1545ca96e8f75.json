{"ast":null,"code":"import TChart from '@/views/components/TChart';\nimport { hasEventListener } from \"@/utils/utils\";\nimport { formatDate, formatTime } from '@/utils/formatTime';\nimport { TIRUtils } from \"@/utils/algorithm/TIR\";\nimport Worker from \"worker-loader!@/workers/day_worker\";\nexport default {\n  data() {\n    return {\n      initOptions: {\n        renderer: 'svg'\n      },\n      option: {\n        grid: [{\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0,\n          height: 120\n        }],\n        xAxis: [{\n          type: 'category',\n          show: true,\n          splitLine: {\n            show: true,\n            lineStyle: {\n              type: 'dashed',\n              color: 'var(--color-black-10)'\n            },\n            interval: 4\n          }\n        }],\n        yAxis: {\n          type: 'value',\n          show: false,\n          min: 0,\n          max: 16\n        },\n        series: [{\n          type: 'line',\n          data: [],\n          itemStyle: {\n            color: 'var(--color-primary)'\n          },\n          showSymbol: false,\n          lineStyle: {\n            width: 2\n          },\n          markArea: {\n            data: [[{\n              yAxis: 3.9\n            }, {\n              yAxis: 10\n            }]],\n            label: {\n              show: true,\n              color: 'var(--color-black-60)',\n              fontSize: 16,\n              distance: 10,\n              position: 'left'\n            },\n            itemStyle: {\n              color: 'rgba(50, 186, 192, 0.08)'\n            }\n          }\n        }]\n      },\n      dayList: '',\n      worker: null\n    };\n  },\n  components: {\n    TChart\n  },\n  created() {\n    this.$bus.$on('getData', data => {\n      console.log(formatTime(new Date()), '发送数据');\n      this.worker.postMessage(data);\n    });\n    // 创建worker线程\n    this.worker = new Worker();\n    // // 监听worker线程的消息\n    this.worker.onmessage = e => {\n      console.log(formatTime(new Date()), '得到数据');\n      this.dayList = e.data;\n      this.$nextTick(() => {\n        console.log(formatTime(new Date()), '渲染完成');\n      });\n    };\n  },\n  mounted() {\n    // this.$bus.$on('getData',(data)=>{\n    //       this.manageData(data)  \n    // })\n    // this.manageData()\n  },\n  methods: {\n    // 管理数据\n    // manageData(data){\n    //     console.log(formatTime(new Date()))\n    //     let array = data\n    //     // 将数组按天分割\n    //     let dayMap = new Map()\n    //      array.forEach(item=>{\n    //         item.day = formatDate(item.DataTs*1000,'mm.dd')\n    //         item.week = formatDate(item.DataTs*1000,'WW')\n    //         item.moment = Number(formatDate(item.DataTs*1000,'HH'))*60+Number(formatDate(item.DataTs*1000,'MM'))\n    //         item.dayArray = new Array(24*60)\n    //         item.dayArray[item.moment] = item.Value\n    //         dayMap.has(item.day) ? dayMap.get(item.day).value[item.moment]=item.Value: dayMap.set(item.day, {value:item.dayArray,week:item.week,tir:TIRUtils.getTIRResult(item.dayArray).normalRate});\n    //     })\n    //     // x轴数据\n    //     this.dayList = dayMap\n    //     this.$nextTick(()=>{\n    //         console.log(formatTime(new Date()))\n    //     })\n    // },\n    getOptions(data) {\n      const config = {\n        grid: [{\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0,\n          height: 120\n        }],\n        xAxis: [{\n          type: 'category',\n          show: false\n        }],\n        yAxis: {\n          type: 'value',\n          show: false,\n          min: 0,\n          max: 16\n        },\n        series: [{\n          type: 'line',\n          data: data,\n          itemStyle: {\n            color: 'var(--color-primary)'\n          },\n          showSymbol: false,\n          lineStyle: {\n            width: 2\n          },\n          markLine: {\n            symbol: 'none',\n            animation: false,\n            data: [{\n              xAxis: 720,\n              lineStyle: {\n                color: 'var(--color-black-10)',\n                width: 1,\n                type: 'dashed'\n              },\n              label: {\n                show: false\n              }\n            }]\n          },\n          markArea: {\n            data: [[{\n              yAxis: 3.9\n            }, {\n              yAxis: 10\n            }]],\n            label: {\n              show: true,\n              color: 'var(--color-black-60)',\n              fontSize: 16,\n              distance: 10,\n              position: 'left'\n            },\n            itemStyle: {\n              color: 'rgba(50, 186, 192, 0.08)'\n            }\n          }\n        }]\n      };\n      return config;\n    }\n  },\n  beforeDestroy() {\n    this.$bus.$off('getData');\n    this.worker.terminate();\n  }\n};","map":{"version":3,"names":["TChart","hasEventListener","formatDate","formatTime","TIRUtils","Worker","data","initOptions","renderer","option","grid","left","right","top","bottom","height","xAxis","type","show","splitLine","lineStyle","color","interval","yAxis","min","max","series","itemStyle","showSymbol","width","markArea","label","fontSize","distance","position","dayList","worker","components","created","$bus","$on","console","log","Date","postMessage","onmessage","e","$nextTick","mounted","methods","getOptions","config","markLine","symbol","animation","beforeDestroy","$off","terminate"],"sources":["src/views/components/Chart/DayChart.vue"],"sourcesContent":["<template>\n    <div>\n        <div class='day-box' >\n            <div class='day-item' v-for='(item,index) in dayList' :key='index'>\n                <div class='day-week' >{{item[1].week}}</div>\n                <div class='day-main' >\n                    <div class='day-target' v-if='index==0' >\n                        <div class='day-target-max' >10</div>\n                        <div class='day-target-min' >3.9</div>\n                    </div>\n                    <div class='day-date-tir' >\n                        <div class='day-date' >{{item[0]}}</div>\n                        <div class='day-tir' >TIR:{{item[1].tir}}%</div>\n                    </div>\n                    <div class='chart-box' >\n                        <t-chart\n                            style=\"width: 100%;height:120px;\"\n                            :option=\"getOptions(item[1].value)\"\n                            :init-options=\"initOptions\"\n                            theme=\"tduck-echarts-theme\"\n                        />\n                    </div>\n                </div>\n                <div class='chart-x-end' v-if='index==dayList.size-1'>\n                    <div>00:00</div>\n                    <div>12:00</div>\n                    <div>00:00</div>\n                </div>\n                <div class='chart-x' v-else>\n                    <div>00:00</div>\n                    <div>12:00</div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport TChart from '@/views/components/TChart'\nimport { hasEventListener } from \"@/utils/utils\";\nimport {formatDate,formatTime} from '@/utils/formatTime'\nimport { TIRUtils } from \"@/utils/algorithm/TIR\";\nimport Worker from \"worker-loader!@/workers/day_worker\"\nexport default {\n    data(){\n        return{\n            initOptions: {\n                renderer: 'svg'\n            },\n            option: {\n                grid:[\n                    {   \n                        left:0,\n                        right:0,\n                        top:0,\n                        bottom:0,\n                        height:120,\n                    }\n                ],\n                xAxis: [\n                    {\n                        type: 'category',\n                        show:true,\n                        splitLine:{\n                            show:true,\n                            lineStyle:{\n                                type:'dashed',\n                                color:'var(--color-black-10)'\n                            },\n                            interval:4\n                        }\n                    }\n                ],\n                yAxis: {\n                        type: 'value',\n                        show:false,\n                        min:0,\n                        max:16\n                    },\n                series: [\n                    {\n                        type: 'line',\n                        data:[] ,\n                        itemStyle: {\n                        color:'var(--color-primary)',\n                        },\n                        showSymbol: false,\n                        lineStyle: {\n                        width: 2,\n                        },\n                        markArea:{\n                            data:[\n                                [{\n                                    yAxis: 3.9\n                                },\n                                {\n                                    yAxis: 10\n                                }]\n                            ],\n                            label: {\n                                show:true,\n                                color: 'var(--color-black-60)',\n                                fontSize: 16,\n                                distance: 10,\n                                position:'left'\n                            },\n                            itemStyle:{\n                                color:'rgba(50, 186, 192, 0.08)'\n                            }\n                        }\n                    },\n                ],\n              \n            },\n            dayList:'',\n            worker: null,\n        }\n    },\n    components: {\n        TChart\n    },\n    created(){\n         this.$bus.$on('getData',(data)=>{\n            console.log(formatTime(new Date()),'发送数据')\n            this.worker.postMessage(data)\n        })\n        // 创建worker线程\n        this.worker = new Worker()\n        // // 监听worker线程的消息\n        this.worker.onmessage = (e) => {\n            console.log(formatTime(new Date()),'得到数据')\n            this.dayList = e.data\n            this.$nextTick(()=>{\n                console.log(formatTime(new Date()),'渲染完成')\n            })\n\n        }\n    },\n    mounted(){\n        // this.$bus.$on('getData',(data)=>{\n        //       this.manageData(data)  \n        // })\n        // this.manageData()\n    },\n    methods:{\n        // 管理数据\n        // manageData(data){\n        //     console.log(formatTime(new Date()))\n        //     let array = data\n        //     // 将数组按天分割\n        //     let dayMap = new Map()\n        //      array.forEach(item=>{\n        //         item.day = formatDate(item.DataTs*1000,'mm.dd')\n        //         item.week = formatDate(item.DataTs*1000,'WW')\n        //         item.moment = Number(formatDate(item.DataTs*1000,'HH'))*60+Number(formatDate(item.DataTs*1000,'MM'))\n        //         item.dayArray = new Array(24*60)\n        //         item.dayArray[item.moment] = item.Value\n        //         dayMap.has(item.day) ? dayMap.get(item.day).value[item.moment]=item.Value: dayMap.set(item.day, {value:item.dayArray,week:item.week,tir:TIRUtils.getTIRResult(item.dayArray).normalRate});\n        //     })\n        //     // x轴数据\n        //     this.dayList = dayMap\n        //     this.$nextTick(()=>{\n        //         console.log(formatTime(new Date()))\n        //     })\n        // },\n        getOptions(data){\n            const config = {\n                grid:[\n                        {   \n                            left:0,\n                            right:0,\n                            top:0,\n                            bottom:0,\n                            height:120,\n                        }\n                ],\n                xAxis: [\n                    {\n                        type: 'category',\n                        show:false,\n                    }\n                ],\n                yAxis: {\n                        type: 'value',\n                        show:false,\n                        min:0,\n                        max:16\n                },\n                series: [\n                        {\n                            type: 'line',\n                            data:data,\n                            itemStyle: {\n                            color:'var(--color-primary)',\n                            },\n                            showSymbol: false,\n                            lineStyle: {\n                            width: 2,\n                            },\n                            markLine:{\n                                symbol: 'none',\n                                animation:false,\n                                data:[\n                                    {\n                                        xAxis:720,\n                                        lineStyle: {\n                                            color: 'var(--color-black-10)',\n                                            width: 1,\n                                            type:'dashed'\n                                        },\n                                        label:{\n                                            show:false\n                                        }\n                                    }\n                                ]\n                            },\n                            markArea:{\n                                data:[\n                                    [{\n                                        yAxis: 3.9\n                                    },\n                                    {\n                                        yAxis: 10\n                                    }]\n                                ],\n                                label: {\n                                    show:true,\n                                    color: 'var(--color-black-60)',\n                                    fontSize: 16,\n                                    distance: 10,\n                                    position:'left'\n                                },\n                                itemStyle:{\n                                    color:'rgba(50, 186, 192, 0.08)'\n                                }\n                            }\n                        },\n                ],\n            }\n            return config\n        },\n    },\n    \n    beforeDestroy(){\n        this.$bus.$off('getData')\n        this.worker.terminate()\n    }\n}\n</script>\n<style scoped>\n    .day-box{\n        display: flex;\n        align-items: center;\n        flex-wrap: wrap;\n        padding:0 50px;\n    }\n    .day-item{\n        width:180px;\n        height:180px;\n        position: relative;\n        margin:0 5px;\n        margin-bottom:20px;\n    }\n    .day-week{\n        width:100%;\n        text-align: center;\n        font-size:var(--fontSize-big);\n        color:var(--color-black-60);\n        margin-bottom:10px;\n    }\n    .day-main{\n        width:180px;\n        height:120px;\n        position: relative;\n    }\n    .day-date-tir{\n        width:100%;\n        padding:2px 6px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        position: absolute;\n        left:0;\n        top:0;\n        color:var(--color-black-60);\n        font-size: var(--fontSize-big);\n    }\n    .day-target{\n        height: 66px;\n        display: flex;\n        flex-direction: column;\n        align-items:center ;\n        justify-content: space-between;\n        position: absolute;\n        top:35px;\n        left:-30px;\n        font-size:var(--fontSize-big);\n        color:var(--color-black-60);\n    }\n    .chart-box{\n        width:180px;\n        height:120px;\n        border:1px solid var(--color-black-10);\n        border-radius:10px;\n    }\n    .chart-x{\n        width:130px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        position: absolute;\n        bottom:0;\n        left:-20px;\n        font-size:var(--fontSize-big);\n        color:var(--color-black-40);\n    }\n    .chart-x-end{\n        width:220px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        position: absolute;\n        bottom:0;\n        left:-20px;\n        font-size:var(--fontSize-big);\n        color:var(--color-black-40);\n    }\n</style>"],"mappings":"AAqCA,OAAAA,MAAA;AACA,SAAAC,gBAAA;AACA,SAAAC,UAAA,EAAAC,UAAA;AACA,SAAAC,QAAA;AACA,OAAAC,MAAA;AACA;EACAC,KAAA;IACA;MACAC,WAAA;QACAC,QAAA;MACA;MACAC,MAAA;QACAC,IAAA,GACA;UACAC,IAAA;UACAC,KAAA;UACAC,GAAA;UACAC,MAAA;UACAC,MAAA;QACA,EACA;QACAC,KAAA,GACA;UACAC,IAAA;UACAC,IAAA;UACAC,SAAA;YACAD,IAAA;YACAE,SAAA;cACAH,IAAA;cACAI,KAAA;YACA;YACAC,QAAA;UACA;QACA,EACA;QACAC,KAAA;UACAN,IAAA;UACAC,IAAA;UACAM,GAAA;UACAC,GAAA;QACA;QACAC,MAAA,GACA;UACAT,IAAA;UACAX,IAAA;UACAqB,SAAA;YACAN,KAAA;UACA;UACAO,UAAA;UACAR,SAAA;YACAS,KAAA;UACA;UACAC,QAAA;YACAxB,IAAA,GACA;cACAiB,KAAA;YACA,GACA;cACAA,KAAA;YACA,GACA;YACAQ,KAAA;cACAb,IAAA;cACAG,KAAA;cACAW,QAAA;cACAC,QAAA;cACAC,QAAA;YACA;YACAP,SAAA;cACAN,KAAA;YACA;UACA;QACA;MAGA;MACAc,OAAA;MACAC,MAAA;IACA;EACA;EACAC,UAAA;IACArC;EACA;EACAsC,QAAA;IACA,KAAAC,IAAA,CAAAC,GAAA,YAAAlC,IAAA;MACAmC,OAAA,CAAAC,GAAA,CAAAvC,UAAA,KAAAwC,IAAA;MACA,KAAAP,MAAA,CAAAQ,WAAA,CAAAtC,IAAA;IACA;IACA;IACA,KAAA8B,MAAA,OAAA/B,MAAA;IACA;IACA,KAAA+B,MAAA,CAAAS,SAAA,GAAAC,CAAA;MACAL,OAAA,CAAAC,GAAA,CAAAvC,UAAA,KAAAwC,IAAA;MACA,KAAAR,OAAA,GAAAW,CAAA,CAAAxC,IAAA;MACA,KAAAyC,SAAA;QACAN,OAAA,CAAAC,GAAA,CAAAvC,UAAA,KAAAwC,IAAA;MACA;IAEA;EACA;EACAK,QAAA;IACA;IACA;IACA;IACA;EAAA,CACA;EACAC,OAAA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAC,WAAA5C,IAAA;MACA,MAAA6C,MAAA;QACAzC,IAAA,GACA;UACAC,IAAA;UACAC,KAAA;UACAC,GAAA;UACAC,MAAA;UACAC,MAAA;QACA,EACA;QACAC,KAAA,GACA;UACAC,IAAA;UACAC,IAAA;QACA,EACA;QACAK,KAAA;UACAN,IAAA;UACAC,IAAA;UACAM,GAAA;UACAC,GAAA;QACA;QACAC,MAAA,GACA;UACAT,IAAA;UACAX,IAAA,EAAAA,IAAA;UACAqB,SAAA;YACAN,KAAA;UACA;UACAO,UAAA;UACAR,SAAA;YACAS,KAAA;UACA;UACAuB,QAAA;YACAC,MAAA;YACAC,SAAA;YACAhD,IAAA,GACA;cACAU,KAAA;cACAI,SAAA;gBACAC,KAAA;gBACAQ,KAAA;gBACAZ,IAAA;cACA;cACAc,KAAA;gBACAb,IAAA;cACA;YACA;UAEA;UACAY,QAAA;YACAxB,IAAA,GACA;cACAiB,KAAA;YACA,GACA;cACAA,KAAA;YACA,GACA;YACAQ,KAAA;cACAb,IAAA;cACAG,KAAA;cACAW,QAAA;cACAC,QAAA;cACAC,QAAA;YACA;YACAP,SAAA;cACAN,KAAA;YACA;UACA;QACA;MAEA;MACA,OAAA8B,MAAA;IACA;EACA;EAEAI,cAAA;IACA,KAAAhB,IAAA,CAAAiB,IAAA;IACA,KAAApB,MAAA,CAAAqB,SAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}