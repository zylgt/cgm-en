{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Empty from '@/views/components/Empty/empty';\nimport WeekAnalysis from '@/views/report/components/weekAnalysis';\nimport { formatDate, formatTime } from '@/utils/formatTime';\nimport { TIRUtils } from \"@/utils/algorithm/TIR\";\nimport { GlucoseUtils } from \"@/utils/algorithm/Glucose\";\nimport mixin from \"./mixin\";\nexport default {\n  data() {\n    return {\n      list: []\n    };\n  },\n  mixins: [mixin],\n  components: {\n    WeekAnalysis,\n    Empty\n  },\n  mounted() {},\n  methods: {\n    // 分割成7天血糖\n    handelTemplateDay(data) {\n      let datArray = _.reverse(_.cloneDeep(data));\n      let splitNum = this.dayDate < 7 ? this.dayDate * 24 * 60 : 7 * 24 * 60;\n      let weekData = _.chunk(datArray, splitNum);\n      let max = _.maxBy(datArray, 'Value').Value > 400 ? 400 : _.maxBy(datArray, 'Value').Value;\n      let tirTarget = this.unit == 'mmol/L' ? [_.round(GlucoseUtils.mmolToMgdl(this.targetScope[0]), 1), _.round(GlucoseUtils.mmolToMgdl(this.targetScope[1]), 1)] : this.targetScope;\n      let weekList = new Array();\n      function handelDay(n) {\n        return formatDate(n.DataTs * 1000, 'mm月dd日');\n      }\n      weekData.forEach(item => {\n        let value = _.map(item, 'Value');\n        let values = _.flatten(value);\n        let handelValue = _.compact(values);\n        let DataTs = _.map(item, handelDay);\n        console.log(GlucoseUtils.calculateMeanCvGmi(handelValue));\n        weekList.push({\n          day: _.uniq(DataTs),\n          week: formatDate(item[0].DataTs * 1000, 'WW'),\n          value: _.chunk(value, 60 * 24),\n          max: max,\n          tir: TIRUtils.getTIRResult(handelValue, tirTarget[1], tirTarget[0]) ? (Number(TIRUtils.getTIRResult(handelValue, tirTarget[1], tirTarget[0]).normalRate) * 100).toFixed(1) : '',\n          info: GlucoseUtils.calculateMeanCvGmi(handelValue)\n        });\n      });\n      this.list = weekList;\n    },\n    // 合并7天血糖\n    addWeek(data) {\n      let list = _.reverse(_.clone(data));\n      let newList = _.chunk(list, 7);\n      let newArr = [];\n      function handelDay(n) {\n        return formatDate(n.day, 'mm月dd日');\n      }\n      newList.forEach(item => {\n        let value = _.map(item, 'value');\n        let values = _.flatten(value);\n        let handelValue = _.compact(values);\n        let max = _.max(handelValue) > 400 ? 400 : _.max(handelValue);\n        newArr.push({\n          day: _.map(item, handelDay),\n          value: value,\n          max: max,\n          tir: TIRUtils.getTIRResult(handelValue) ? (Number(TIRUtils.getTIRResult(handelValue).normalRate) * 100).toFixed(1) : '',\n          info: GlucoseUtils.calculateMeanCvGmi(handelValue)\n        });\n      });\n      console.log(newArr, 'newarr');\n      // this.list = newArr\n    }\n  }\n};","map":{"version":3,"names":["Empty","WeekAnalysis","formatDate","formatTime","TIRUtils","GlucoseUtils","mixin","data","list","mixins","components","mounted","methods","handelTemplateDay","datArray","_","reverse","cloneDeep","splitNum","dayDate","weekData","chunk","max","maxBy","Value","tirTarget","unit","round","mmolToMgdl","targetScope","weekList","Array","handelDay","n","DataTs","forEach","item","value","map","values","flatten","handelValue","compact","console","log","calculateMeanCvGmi","push","day","uniq","week","tir","getTIRResult","Number","normalRate","toFixed","info","addWeek","clone","newList","newArr"],"sources":["src/views/report/weekReport.vue"],"sourcesContent":["<template>\n    <div>\n         <div class='agp-top' >\n            <div class='agp-top-fl' >\n                <div class='report-title'> {{$t('message.route.'+$route.meta.title)}}</div>\n                \n            </div>\n            <div class='agp-fr' >\n                <img src=\"~@/assets/image/printer.png\" alt=\"\" class='agp-icon' @click='print' >\n                <img src=\"~@/assets/image/down-icon.png\" alt=\"\" class='agp-icon' @click='handleExport' >\n                <img src=\"~@/assets/image/share.png\" alt=\"\" class='agp-icon agp-fr-icon'>\n                <el-button type=\"primary\" @click=\"upload\">\n                    <img src=\"~@/assets/image/btn-upload.png\" alt=\"\" class='btn-upload' >\n                    上传数据\n                </el-button>\n            </div>\n        </div>\n        <div class='report-agp-date' >\n                <img src=\"~@/assets/image/date-calendar.png\" alt=\"\" class='agp-icon' >\n                <div class='agp-date' >{{agpDate[0]}} — {{agpDate[1]}}（{{dayDate}}天）</div>\n                    <img src=\"~@/assets/image/select-icon.png\" alt=\"\" class='select-icon' >\n                <el-date-picker\n                    class='agp-picker'\n                    v-model=\"agpDate\"\n                    type=\"daterange\"\n                    align=\"right\"\n                    unlink-panels\n                    range-separator=\"至\"\n                    start-placeholder=\"开始日期\"\n                    end-placeholder=\"结束日期\"\n                    value-format=\"yyyy-MM-dd\"\n                    format=\"yyyy-MM-dd\"\n                    @change=\"changeDate\"\n                    :picker-options=\"pickerOptions\">\n                </el-date-picker>\n        </div>\n        <!-- 图表 -->\n        <Empty v-show='empty' style='height:600px;' />\n        <div class='week-bg-main'  v-show=\"!empty\" v-for='(item,index) in list' :key='index'>\n            <div  class='week-bg-title' >\n                <div class='week-bg-date' >{{item.day[0]}} - {{item.day[item.day.length-1]}}</div>\n                 <img src=\"~@/assets/image/reason-icon.png\" alt=\"\" class='reason-icon'>\n            </div>\n            <Empty v-show='!item.max' />\n            <WeekAnalysis :dataList='item' v-show='item.max' />\n        </div>\n         <!-- 下载打印弹窗 -->\n        <el-dialog  :visible.sync=\"dialogVisible\"  :show-close=\"false\" :title='dialogType==\"print\"?\"打印报告\":\"下载报告\"'\n         width=\"1060\" >\n            <div class='slot-popover'  id='popover'>\n                <div class='slot-popover-cont slot-popover-conts'>\n                    <div class='report-agp-date report-agp-dates' >\n                            <img src=\"~@/assets/image/date-calendar.png\" alt=\"\" class='agp-icon' >\n                            <div class='agp-date' >{{agpDate[0]}} — {{agpDate[1]}}（4天）</div>\n                            <img src=\"~@/assets/image/select-icon.png\" alt=\"\" class='select-icon' >\n                            <el-date-picker\n                                class='agp-picker'\n                                v-model=\"agpDate\"\n                                type=\"daterange\"\n                                align=\"right\"\n                                unlink-panels\n                                range-separator=\"至\"\n                                start-placeholder=\"开始日期\"\n                                end-placeholder=\"结束日期\"\n                                value-format=\"yyyy-MM-dd\"\n                                format=\"yyyy-MM-dd\"\n                                @change=\"changeDate\"\n                                :picker-options=\"pickerOptions\">\n                            </el-date-picker>\n                    </div>\n                    <div class='popover-cont-label' >\n                        <div class='popover-cont-label-label' v-if='dialogType==\"print\"'>请选择您想要打印的报告内容：</div>\n                        <div class='popover-cont-label-label' v-else>请选择您想要下载的报告内容：</div>\n                        <el-checkbox :indeterminate=\"isIndeterminate\" v-model=\"checkAll\" @change=\"handleCheckAllChange\">全选</el-checkbox>\n                    </div>\n                    <el-checkbox-group v-model=\"checkedDowns\" @change=\"handleCheckedCitiesChange\">\n                        <el-checkbox v-for=\"item in downloadList\" :label=\"item\" :key=\"item\">{{item}}</el-checkbox>\n                    </el-checkbox-group>\n                </div>\n                <div class='slot-popover-btn'>\n                    <el-button type=\"primary\" v-if='dialogType==\"print\"'>打印报告</el-button>\n                    <el-button type=\"primary\" v-else>下载报告</el-button>\n                </div>\n            </div>\n            <img src=\"~@/assets/image/close-icon.png\" alt=\"\" class='dialog-close' @click='dialogVisible=false' >\n        </el-dialog>\n    </div>\n</template>\n<script>\nimport Empty from '@/views/components/Empty/empty'\nimport WeekAnalysis from '@/views/report/components/weekAnalysis'\nimport {formatDate,formatTime} from '@/utils/formatTime'\nimport { TIRUtils } from \"@/utils/algorithm/TIR\";\nimport { GlucoseUtils } from \"@/utils/algorithm/Glucose\";\nimport mixin from \"./mixin\"\nexport default {\n    data(){\n        return{\n            list:[]\n        }\n    },\n    mixins: [mixin],\n    components: {\n        WeekAnalysis,Empty\n    },\n    mounted(){\n    },\n    methods:{\n        // 分割成7天血糖\n        handelTemplateDay(data){\n            let datArray = _.reverse(_.cloneDeep(data))\n            let splitNum = this.dayDate<7?this.dayDate*24*60:7*24*60\n            let weekData =  _.chunk(datArray,splitNum) ;\n            let max = _.maxBy(datArray,'Value').Value>400?400:_.maxBy(datArray,'Value').Value\n            let tirTarget =  this.unit=='mmol/L'?[_.round(GlucoseUtils.mmolToMgdl(this.targetScope[0]),1),_.round(GlucoseUtils.mmolToMgdl(this.targetScope[1]),1)]:this.targetScope\n            let weekList = new Array()\n            function handelDay(n){\n                return formatDate(n.DataTs*1000,'mm月dd日')\n            }\n            \n            weekData.forEach(item=>{\n                let value = _.map(item, 'Value');\n                let values = _.flatten(value)\n                let handelValue = _.compact(values)\n                let DataTs= _.map(item, handelDay);\n                console.log(GlucoseUtils.calculateMeanCvGmi(handelValue))\n                weekList.push({\n                    day: _.uniq(DataTs),\n                    week: formatDate(item[0].DataTs*1000,'WW'),\n                    value: _.chunk(value,60*24),\n                    max:max,\n                    tir:TIRUtils.getTIRResult(handelValue,tirTarget[1],tirTarget[0])?(Number(TIRUtils.getTIRResult(handelValue,tirTarget[1],tirTarget[0]).normalRate)*100).toFixed(1):'',\n                    info:GlucoseUtils.calculateMeanCvGmi(handelValue)\n                })\n            })\n            this.list  = weekList\n        },\n        // 合并7天血糖\n        addWeek(data){\n            let list = _.reverse(_.clone(data))\n            let newList = _.chunk(list,7)\n            let newArr = []\n            function handelDay(n){\n                return formatDate(n.day,'mm月dd日')\n            }\n            newList.forEach(item=>{\n                let value = _.map(item,'value')\n                let values = _.flatten(value)\n                let handelValue = _.compact(values)\n                let max = _.max(handelValue)>400?400:_.max(handelValue)\n                newArr.push({\n                    day:_.map(item,handelDay),\n                    value:value,\n                    max:max,\n                    tir:TIRUtils.getTIRResult(handelValue)?(Number(TIRUtils.getTIRResult(handelValue).normalRate)*100).toFixed(1):'',\n                    info:GlucoseUtils.calculateMeanCvGmi(handelValue)\n                })\n            })\n            console.log(newArr,'newarr')\n            // this.list = newArr\n        }\n    }\n}\n</script>\n<style scoped>\n.week-bg-main{\n    width:100%;\n    height:605px;\n    background:#fff;\n    margin-bottom:20px;\n    border-radius:10px;\n    padding:20px;\n    box-sizing: border-box;\n}\n.week-bg-title{\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom:20px;\n}\n.week-bg-date{\n    font-size:var(--fontSize-max);\n    color:var(--color-black-100);\n    font-weight: 700;\n}\n.reason-icon{\n    width:24px;\n    height:24px;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}