{"ast":null,"code":"import _classPrivateFieldInitSpec from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js\";\nimport _classPrivateFieldGet from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js\";\nimport _classPrivateFieldSet from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js\";\nimport { CDPSessionEvent } from '../api/CDPSession.js';\nimport { TargetType } from '../api/Target.js';\nimport { WebWorker } from '../api/WebWorker.js';\nimport { TimeoutSettings } from '../common/TimeoutSettings.js';\nimport { debugError } from '../common/util.js';\nimport { ExecutionContext } from './ExecutionContext.js';\nimport { IsolatedWorld } from './IsolatedWorld.js';\nimport { CdpJSHandle } from './JSHandle.js';\n/**\n * @internal\n */\nvar _world = /*#__PURE__*/new WeakMap();\nvar _client = /*#__PURE__*/new WeakMap();\nvar _id = /*#__PURE__*/new WeakMap();\nvar _targetType = /*#__PURE__*/new WeakMap();\nexport class CdpWebWorker extends WebWorker {\n  constructor(client, url, targetId, targetType, consoleAPICalled, exceptionThrown) {\n    super(url);\n    _classPrivateFieldInitSpec(this, _world, void 0);\n    _classPrivateFieldInitSpec(this, _client, void 0);\n    _classPrivateFieldInitSpec(this, _id, void 0);\n    _classPrivateFieldInitSpec(this, _targetType, void 0);\n    _classPrivateFieldSet(_id, this, targetId);\n    _classPrivateFieldSet(_client, this, client);\n    _classPrivateFieldSet(_targetType, this, targetType);\n    _classPrivateFieldSet(_world, this, new IsolatedWorld(this, new TimeoutSettings()));\n    _classPrivateFieldGet(_client, this).once('Runtime.executionContextCreated', async event => {\n      _classPrivateFieldGet(_world, this).setContext(new ExecutionContext(client, event.context, _classPrivateFieldGet(_world, this)));\n    });\n    _classPrivateFieldGet(_world, this).emitter.on('consoleapicalled', async event => {\n      try {\n        return consoleAPICalled(event.type, event.args.map(object => {\n          return new CdpJSHandle(_classPrivateFieldGet(_world, this), object);\n        }), event.stackTrace);\n      } catch (err) {\n        debugError(err);\n      }\n    });\n    _classPrivateFieldGet(_client, this).on('Runtime.exceptionThrown', exceptionThrown);\n    _classPrivateFieldGet(_client, this).once(CDPSessionEvent.Disconnected, () => {\n      _classPrivateFieldGet(_world, this).dispose();\n    });\n    // This might fail if the target is closed before we receive all execution contexts.\n    _classPrivateFieldGet(_client, this).send('Runtime.enable').catch(debugError);\n  }\n  mainRealm() {\n    return _classPrivateFieldGet(_world, this);\n  }\n  get client() {\n    return _classPrivateFieldGet(_client, this);\n  }\n  async close() {\n    switch (_classPrivateFieldGet(_targetType, this)) {\n      case TargetType.SERVICE_WORKER:\n      case TargetType.SHARED_WORKER:\n        {\n          // For service and shared workers we need to close the target and detach to allow\n          // the worker to stop.\n          await this.client.connection()?.send('Target.closeTarget', {\n            targetId: _classPrivateFieldGet(_id, this)\n          });\n          await this.client.connection()?.send('Target.detachFromTarget', {\n            sessionId: this.client.id()\n          });\n          break;\n        }\n      default:\n        await this.evaluate(() => {\n          self.close();\n        });\n    }\n  }\n}","map":{"version":3,"names":["CDPSessionEvent","TargetType","WebWorker","TimeoutSettings","debugError","ExecutionContext","IsolatedWorld","CdpJSHandle","_world","WeakMap","_client","_id","_targetType","CdpWebWorker","constructor","client","url","targetId","targetType","consoleAPICalled","exceptionThrown","_classPrivateFieldInitSpec","_classPrivateFieldSet","_classPrivateFieldGet","once","event","setContext","context","emitter","on","type","args","map","object","stackTrace","err","Disconnected","dispose","send","catch","mainRealm","close","SERVICE_WORKER","SHARED_WORKER","connection","sessionId","id","evaluate","self"],"sources":["../../../../src/cdp/WebWorker.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}