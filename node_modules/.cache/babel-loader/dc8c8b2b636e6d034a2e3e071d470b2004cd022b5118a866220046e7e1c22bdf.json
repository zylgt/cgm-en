{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Browser = exports.WEB_PERMISSION_TO_PROTOCOL_PERMISSION = void 0;\nconst rxjs_js_1 = require(\"../../third_party/rxjs/rxjs.js\");\nconst EventEmitter_js_1 = require(\"../common/EventEmitter.js\");\nconst util_js_1 = require(\"../common/util.js\");\nconst disposable_js_1 = require(\"../util/disposable.js\");\n/**\n * @internal\n */\nexports.WEB_PERMISSION_TO_PROTOCOL_PERMISSION = new Map([['geolocation', 'geolocation'], ['midi', 'midi'], ['notifications', 'notifications'],\n// TODO: push isn't a valid type?\n// ['push', 'push'],\n['camera', 'videoCapture'], ['microphone', 'audioCapture'], ['background-sync', 'backgroundSync'], ['ambient-light-sensor', 'sensors'], ['accelerometer', 'sensors'], ['gyroscope', 'sensors'], ['magnetometer', 'sensors'], ['accessibility-events', 'accessibilityEvents'], ['clipboard-read', 'clipboardReadWrite'], ['clipboard-write', 'clipboardReadWrite'], ['clipboard-sanitized-write', 'clipboardSanitizedWrite'], ['payment-handler', 'paymentHandler'], ['persistent-storage', 'durableStorage'], ['idle-detection', 'idleDetection'],\n// chrome-specific permissions we have.\n['midi-sysex', 'midiSysex']]);\n/**\n * {@link Browser} represents a browser instance that is either:\n *\n * - connected to via {@link Puppeteer.connect} or\n * - launched by {@link PuppeteerNode.launch}.\n *\n * {@link Browser} {@link EventEmitter.emit | emits} various events which are\n * documented in the {@link BrowserEvent} enum.\n *\n * @example Using a {@link Browser} to create a {@link Page}:\n *\n * ```ts\n * import puppeteer from 'puppeteer';\n *\n * const browser = await puppeteer.launch();\n * const page = await browser.newPage();\n * await page.goto('https://example.com');\n * await browser.close();\n * ```\n *\n * @example Disconnecting from and reconnecting to a {@link Browser}:\n *\n * ```ts\n * import puppeteer from 'puppeteer';\n *\n * const browser = await puppeteer.launch();\n * // Store the endpoint to be able to reconnect to the browser.\n * const browserWSEndpoint = browser.wsEndpoint();\n * // Disconnect puppeteer from the browser.\n * await browser.disconnect();\n *\n * // Use the endpoint to reestablish a connection\n * const browser2 = await puppeteer.connect({browserWSEndpoint});\n * // Close the browser.\n * await browser2.close();\n * ```\n *\n * @public\n */\nclass Browser extends EventEmitter_js_1.EventEmitter {\n  /**\n   * @internal\n   */\n  constructor() {\n    super();\n  }\n  /**\n   * Waits until a {@link Target | target} matching the given `predicate`\n   * appears and returns it.\n   *\n   * This will look all open {@link BrowserContext | browser contexts}.\n   *\n   * @example Finding a target for a page opened via `window.open`:\n   *\n   * ```ts\n   * await page.evaluate(() => window.open('https://www.example.com/'));\n   * const newWindowTarget = await browser.waitForTarget(\n   *   target => target.url() === 'https://www.example.com/'\n   * );\n   * ```\n   */\n  async waitForTarget(predicate, options = {}) {\n    const {\n      timeout: ms = 30000\n    } = options;\n    return await (0, rxjs_js_1.firstValueFrom)((0, rxjs_js_1.merge)((0, util_js_1.fromEmitterEvent)(this, \"targetcreated\" /* BrowserEvent.TargetCreated */), (0, util_js_1.fromEmitterEvent)(this, \"targetchanged\" /* BrowserEvent.TargetChanged */), (0, rxjs_js_1.from)(this.targets())).pipe((0, util_js_1.filterAsync)(predicate), (0, rxjs_js_1.raceWith)((0, util_js_1.timeout)(ms))));\n  }\n  /**\n   * Gets a list of all open {@link Page | pages} inside this {@link Browser}.\n   *\n   * If there ar multiple {@link BrowserContext | browser contexts}, this\n   * returns all {@link Page | pages} in all\n   * {@link BrowserContext | browser contexts}.\n   *\n   * @remarks Non-visible {@link Page | pages}, such as `\"background_page\"`,\n   * will not be listed here. You can find them using {@link Target.page}.\n   */\n  async pages() {\n    const contextPages = await Promise.all(this.browserContexts().map(context => {\n      return context.pages();\n    }));\n    // Flatten array.\n    return contextPages.reduce((acc, x) => {\n      return acc.concat(x);\n    }, []);\n  }\n  /**\n   * Whether Puppeteer is connected to this {@link Browser | browser}.\n   *\n   * @deprecated Use {@link Browser | Browser.connected}.\n   */\n  isConnected() {\n    return this.connected;\n  }\n  /** @internal */\n  [disposable_js_1.disposeSymbol]() {\n    if (this.process()) {\n      return void this.close().catch(util_js_1.debugError);\n    }\n    return void this.disconnect().catch(util_js_1.debugError);\n  }\n  /** @internal */\n  [disposable_js_1.asyncDisposeSymbol]() {\n    if (this.process()) {\n      return this.close();\n    }\n    return this.disconnect();\n  }\n}\nexports.Browser = Browser;","map":{"version":3,"names":["rxjs_js_1","require","EventEmitter_js_1","util_js_1","disposable_js_1","exports","WEB_PERMISSION_TO_PROTOCOL_PERMISSION","Map","Browser","EventEmitter","constructor","waitForTarget","predicate","options","timeout","ms","firstValueFrom","merge","fromEmitterEvent","from","targets","pipe","filterAsync","raceWith","pages","contextPages","Promise","all","browserContexts","map","context","reduce","acc","x","concat","isConnected","connected","disposeSymbol","process","close","catch","debugError","disconnect","asyncDisposeSymbol"],"sources":["../../../../src/api/Browser.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}