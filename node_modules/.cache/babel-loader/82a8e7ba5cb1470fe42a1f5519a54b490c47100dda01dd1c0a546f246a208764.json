{"ast":null,"code":"/**\n * @license\n * Copyright 2023 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { homedir } from 'os';\nimport { join } from 'path';\nimport { cosmiconfigSync } from 'cosmiconfig';\nfunction getBooleanEnvVar(name) {\n  const env = process.env[name];\n  if (env === undefined) {\n    return;\n  }\n  switch (env.toLowerCase()) {\n    case '':\n    case '0':\n    case 'false':\n    case 'off':\n      return false;\n    default:\n      return true;\n  }\n}\n/**\n * @internal\n */\nfunction isSupportedProduct(product) {\n  switch (product) {\n    case 'chrome':\n    case 'firefox':\n      return true;\n    default:\n      return false;\n  }\n}\n/**\n * @internal\n */\nexport const getConfiguration = () => {\n  const result = cosmiconfigSync('puppeteer', {\n    searchStrategy: 'global'\n  }).search();\n  const configuration = result ? result.config : {};\n  configuration.logLevel = process.env['PUPPETEER_LOGLEVEL'] ?? process.env['npm_config_LOGLEVEL'] ?? process.env['npm_package_config_LOGLEVEL'] ?? configuration.logLevel ?? 'warn';\n  // Merging environment variables.\n  configuration.defaultProduct = process.env['PUPPETEER_PRODUCT'] ?? process.env['npm_config_puppeteer_product'] ?? process.env['npm_package_config_puppeteer_product'] ?? configuration.defaultProduct ?? 'chrome';\n  configuration.executablePath = process.env['PUPPETEER_EXECUTABLE_PATH'] ?? process.env['npm_config_puppeteer_executable_path'] ?? process.env['npm_package_config_puppeteer_executable_path'] ?? configuration.executablePath;\n  // Default to skipDownload if executablePath is set\n  if (configuration.executablePath) {\n    configuration.skipDownload = true;\n  }\n  // Set skipDownload explicitly or from default\n  configuration.skipDownload = Boolean(getBooleanEnvVar('PUPPETEER_SKIP_DOWNLOAD') ?? getBooleanEnvVar('npm_config_puppeteer_skip_download') ?? getBooleanEnvVar('npm_package_config_puppeteer_skip_download') ?? configuration.skipDownload);\n  // Set skipChromeDownload explicitly or from default\n  configuration.skipChromeDownload = Boolean(getBooleanEnvVar('PUPPETEER_SKIP_CHROME_DOWNLOAD') ?? getBooleanEnvVar('npm_config_puppeteer_skip_chrome_download') ?? getBooleanEnvVar('npm_package_config_puppeteer_skip_chrome_download') ?? configuration.skipChromeDownload);\n  // Set skipChromeDownload explicitly or from default\n  configuration.skipChromeHeadlessShellDownload = Boolean(getBooleanEnvVar('PUPPETEER_SKIP_CHROME_HEADLESS_SHELL_DOWNLOAD') ?? getBooleanEnvVar('npm_config_puppeteer_skip_chrome_headless_shell_download') ?? getBooleanEnvVar('npm_package_config_puppeteer_skip_chrome_headless_shell_download') ?? configuration.skipChromeHeadlessShellDownload);\n  // Prepare variables used in browser downloading\n  if (!configuration.skipDownload) {\n    configuration.browserRevision = process.env['PUPPETEER_BROWSER_REVISION'] ?? process.env['npm_config_puppeteer_browser_revision'] ?? process.env['npm_package_config_puppeteer_browser_revision'] ?? configuration.browserRevision;\n    const downloadHost = process.env['PUPPETEER_DOWNLOAD_HOST'] ?? process.env['npm_config_puppeteer_download_host'] ?? process.env['npm_package_config_puppeteer_download_host'];\n    if (downloadHost && configuration.logLevel === 'warn') {\n      console.warn(`PUPPETEER_DOWNLOAD_HOST is deprecated. Use PUPPETEER_DOWNLOAD_BASE_URL instead.`);\n    }\n    configuration.downloadBaseUrl = process.env['PUPPETEER_DOWNLOAD_BASE_URL'] ?? process.env['npm_config_puppeteer_download_base_url'] ?? process.env['npm_package_config_puppeteer_download_base_url'] ?? configuration.downloadBaseUrl ?? downloadHost;\n  }\n  if (Object.keys(process.env).some(key => {\n    return key.startsWith('npm_package_config_puppeteer_');\n  }) && configuration.logLevel === 'warn') {\n    console.warn(`Configuring Puppeteer via npm/package.json is deprecated. Use https://pptr.dev/guides/configuration instead.`);\n  }\n  configuration.cacheDirectory = process.env['PUPPETEER_CACHE_DIR'] ?? process.env['npm_config_puppeteer_cache_dir'] ?? process.env['npm_package_config_puppeteer_cache_dir'] ?? configuration.cacheDirectory ?? join(homedir(), '.cache', 'puppeteer');\n  configuration.temporaryDirectory = process.env['PUPPETEER_TMP_DIR'] ?? process.env['npm_config_puppeteer_tmp_dir'] ?? process.env['npm_package_config_puppeteer_tmp_dir'] ?? configuration.temporaryDirectory;\n  configuration.experiments ??= {};\n  // Validate configuration.\n  if (!isSupportedProduct(configuration.defaultProduct)) {\n    throw new Error(`Unsupported product ${configuration.defaultProduct}`);\n  }\n  return configuration;\n};","map":{"version":3,"names":["homedir","join","cosmiconfigSync","getBooleanEnvVar","name","env","process","undefined","toLowerCase","isSupportedProduct","product","getConfiguration","result","searchStrategy","search","configuration","config","logLevel","defaultProduct","executablePath","skipDownload","Boolean","skipChromeDownload","skipChromeHeadlessShellDownload","browserRevision","downloadHost","console","warn","downloadBaseUrl","Object","keys","some","key","startsWith","cacheDirectory","temporaryDirectory","experiments","Error"],"sources":["../../../src/getConfiguration.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}