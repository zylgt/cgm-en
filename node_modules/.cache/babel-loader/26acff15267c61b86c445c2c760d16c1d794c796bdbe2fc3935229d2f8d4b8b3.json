{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2023 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.unpackArchive = void 0;\nconst child_process_1 = require(\"child_process\");\nconst fs_1 = require(\"fs\");\nconst promises_1 = require(\"fs/promises\");\nconst path = __importStar(require(\"path\"));\nconst util_1 = require(\"util\");\nconst extract_zip_1 = __importDefault(require(\"extract-zip\"));\nconst tar_fs_1 = __importDefault(require(\"tar-fs\"));\nconst unbzip2_stream_1 = __importDefault(require(\"unbzip2-stream\"));\nconst exec = (0, util_1.promisify)(child_process_1.exec);\n/**\n * @internal\n */\nasync function unpackArchive(archivePath, folderPath) {\n  if (archivePath.endsWith('.zip')) {\n    await (0, extract_zip_1.default)(archivePath, {\n      dir: folderPath\n    });\n  } else if (archivePath.endsWith('.tar.bz2')) {\n    await extractTar(archivePath, folderPath);\n  } else if (archivePath.endsWith('.dmg')) {\n    await (0, promises_1.mkdir)(folderPath);\n    await installDMG(archivePath, folderPath);\n  } else if (archivePath.endsWith('.exe')) {\n    // Firefox on Windows.\n    const result = (0, child_process_1.spawnSync)(archivePath, [`/ExtractDir=${folderPath}`], {\n      env: {\n        __compat_layer: 'RunAsInvoker'\n      }\n    });\n    if (result.status !== 0) {\n      throw new Error(`Failed to extract ${archivePath} to ${folderPath}: ${result.output}`);\n    }\n  } else {\n    throw new Error(`Unsupported archive format: ${archivePath}`);\n  }\n}\nexports.unpackArchive = unpackArchive;\n/**\n * @internal\n */\nfunction extractTar(tarPath, folderPath) {\n  return new Promise((fulfill, reject) => {\n    const tarStream = tar_fs_1.default.extract(folderPath);\n    tarStream.on('error', reject);\n    tarStream.on('finish', fulfill);\n    const readStream = (0, fs_1.createReadStream)(tarPath);\n    readStream.pipe((0, unbzip2_stream_1.default)()).pipe(tarStream);\n  });\n}\n/**\n * @internal\n */\nasync function installDMG(dmgPath, folderPath) {\n  const {\n    stdout\n  } = await exec(`hdiutil attach -nobrowse -noautoopen \"${dmgPath}\"`);\n  const volumes = stdout.match(/\\/Volumes\\/(.*)/m);\n  if (!volumes) {\n    throw new Error(`Could not find volume path in ${stdout}`);\n  }\n  const mountPath = volumes[0];\n  try {\n    const fileNames = await (0, promises_1.readdir)(mountPath);\n    const appName = fileNames.find(item => {\n      return typeof item === 'string' && item.endsWith('.app');\n    });\n    if (!appName) {\n      throw new Error(`Cannot find app in ${mountPath}`);\n    }\n    const mountedPath = path.join(mountPath, appName);\n    await exec(`cp -R \"${mountedPath}\" \"${folderPath}\"`);\n  } finally {\n    await exec(`hdiutil detach \"${mountPath}\" -quiet`);\n  }\n}","map":{"version":3,"names":["child_process_1","require","fs_1","promises_1","path","__importStar","util_1","extract_zip_1","__importDefault","tar_fs_1","unbzip2_stream_1","exec","promisify","unpackArchive","archivePath","folderPath","endsWith","default","dir","extractTar","mkdir","installDMG","result","spawnSync","env","__compat_layer","status","Error","output","exports","tarPath","Promise","fulfill","reject","tarStream","extract","on","readStream","createReadStream","pipe","dmgPath","stdout","volumes","match","mountPath","fileNames","readdir","appName","find","item","mountedPath","join"],"sources":["../../src/fileUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}