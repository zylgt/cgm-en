{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CdpCDPSession = void 0;\nconst CDPSession_js_1 = require(\"../api/CDPSession.js\");\nconst CallbackRegistry_js_1 = require(\"../common/CallbackRegistry.js\");\nconst Errors_js_1 = require(\"../common/Errors.js\");\nconst assert_js_1 = require(\"../util/assert.js\");\nconst ErrorLike_js_1 = require(\"../util/ErrorLike.js\");\n/**\n * @internal\n */\nvar _sessionId = /*#__PURE__*/new WeakMap();\nvar _targetType = /*#__PURE__*/new WeakMap();\nvar _callbacks = /*#__PURE__*/new WeakMap();\nvar _connection = /*#__PURE__*/new WeakMap();\nvar _parentSessionId = /*#__PURE__*/new WeakMap();\nvar _target = /*#__PURE__*/new WeakMap();\nclass CdpCDPSession extends CDPSession_js_1.CDPSession {\n  /**\n   * @internal\n   */\n  constructor(connection, targetType, sessionId, parentSessionId) {\n    super();\n    _classPrivateFieldInitSpec(this, _sessionId, void 0);\n    _classPrivateFieldInitSpec(this, _targetType, void 0);\n    _classPrivateFieldInitSpec(this, _callbacks, new CallbackRegistry_js_1.CallbackRegistry());\n    _classPrivateFieldInitSpec(this, _connection, void 0);\n    _classPrivateFieldInitSpec(this, _parentSessionId, void 0);\n    _classPrivateFieldInitSpec(this, _target, void 0);\n    _classPrivateFieldSet(_connection, this, connection);\n    _classPrivateFieldSet(_targetType, this, targetType);\n    _classPrivateFieldSet(_sessionId, this, sessionId);\n    _classPrivateFieldSet(_parentSessionId, this, parentSessionId);\n  }\n  /**\n   * Sets the {@link CdpTarget} associated with the session instance.\n   *\n   * @internal\n   */\n  _setTarget(target) {\n    _classPrivateFieldSet(_target, this, target);\n  }\n  /**\n   * Gets the {@link CdpTarget} associated with the session instance.\n   *\n   * @internal\n   */\n  _target() {\n    (0, assert_js_1.assert)(_classPrivateFieldGet(_target, this), 'Target must exist');\n    return _classPrivateFieldGet(_target, this);\n  }\n  connection() {\n    return _classPrivateFieldGet(_connection, this);\n  }\n  parentSession() {\n    if (!_classPrivateFieldGet(_parentSessionId, this)) {\n      // To make it work in Firefox that does not have parent (tab) sessions.\n      return this;\n    }\n    const parent = _classPrivateFieldGet(_connection, this)?.session(_classPrivateFieldGet(_parentSessionId, this));\n    return parent ?? undefined;\n  }\n  send(method, params, options) {\n    if (!_classPrivateFieldGet(_connection, this)) {\n      return Promise.reject(new Errors_js_1.TargetCloseError(`Protocol error (${method}): Session closed. Most likely the ${_classPrivateFieldGet(_targetType, this)} has been closed.`));\n    }\n    return _classPrivateFieldGet(_connection, this)._rawSend(_classPrivateFieldGet(_callbacks, this), method, params, _classPrivateFieldGet(_sessionId, this), options);\n  }\n  /**\n   * @internal\n   */\n  _onMessage(object) {\n    if (object.id) {\n      if (object.error) {\n        _classPrivateFieldGet(_callbacks, this).reject(object.id, (0, ErrorLike_js_1.createProtocolErrorMessage)(object), object.error.message);\n      } else {\n        _classPrivateFieldGet(_callbacks, this).resolve(object.id, object.result);\n      }\n    } else {\n      (0, assert_js_1.assert)(!object.id);\n      this.emit(object.method, object.params);\n    }\n  }\n  /**\n   * Detaches the cdpSession from the target. Once detached, the cdpSession object\n   * won't emit any events and can't be used to send messages.\n   */\n  async detach() {\n    if (!_classPrivateFieldGet(_connection, this)) {\n      throw new Error(`Session already detached. Most likely the ${_classPrivateFieldGet(_targetType, this)} has been closed.`);\n    }\n    await _classPrivateFieldGet(_connection, this).send('Target.detachFromTarget', {\n      sessionId: _classPrivateFieldGet(_sessionId, this)\n    });\n  }\n  /**\n   * @internal\n   */\n  _onClosed() {\n    _classPrivateFieldGet(_callbacks, this).clear();\n    _classPrivateFieldSet(_connection, this, undefined);\n    this.emit(CDPSession_js_1.CDPSessionEvent.Disconnected, undefined);\n  }\n  /**\n   * Returns the session's id.\n   */\n  id() {\n    return _classPrivateFieldGet(_sessionId, this);\n  }\n  /**\n   * @internal\n   */\n  getPendingProtocolErrors() {\n    return _classPrivateFieldGet(_callbacks, this).getPendingProtocolErrors();\n  }\n}\nexports.CdpCDPSession = CdpCDPSession;","map":{"version":3,"names":["_classPrivateFieldInitSpec","require","default","_classPrivateFieldGet","_classPrivateFieldSet","CDPSession_js_1","CallbackRegistry_js_1","Errors_js_1","assert_js_1","ErrorLike_js_1","_sessionId","WeakMap","_targetType","_callbacks","_connection","_parentSessionId","_target","CdpCDPSession","CDPSession","constructor","connection","targetType","sessionId","parentSessionId","CallbackRegistry","_setTarget","target","assert","parentSession","parent","session","undefined","send","method","params","options","Promise","reject","TargetCloseError","_rawSend","_onMessage","object","id","error","createProtocolErrorMessage","message","resolve","result","emit","detach","Error","_onClosed","clear","CDPSessionEvent","Disconnected","getPendingProtocolErrors","exports"],"sources":["../../../../src/cdp/CDPSession.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}