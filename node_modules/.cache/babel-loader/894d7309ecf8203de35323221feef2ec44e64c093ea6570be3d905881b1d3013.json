{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport TChart from '@/views/components/TChart';\nimport { hasEventListener } from \"@/utils/utils\";\nimport { formatDate } from '@/utils/formatTime';\nexport default {\n  data() {\n    return {\n      initOptions: {\n        renderer: 'svg'\n      },\n      option: {\n        tooltip: {\n          trigger: 'axis',\n          axisPointer: {\n            type: 'cross',\n            crossStyle: {\n              color: '#999'\n            }\n          }\n        },\n        grid: {\n          left: 120,\n          right: 120,\n          bottom: 60,\n          top: 60\n        },\n        xAxis: [{\n          type: 'category',\n          boundaryGap: false,\n          axisTick: false,\n          axisLine: {\n            show: true,\n            lineStyle: {\n              color: '#e5e5e5',\n              width: 1\n            }\n          },\n          axisLabel: {\n            color: '#666',\n            fontSize: 16,\n            margin: 14\n          }\n        }],\n        yAxis: [{\n          type: 'value',\n          min: 0,\n          max: 15,\n          splitLine: {\n            lineStyle: {\n              type: 'dashed',\n              color: '#e5e5e5'\n            }\n          },\n          axisLabel: {\n            formatter: '{value}',\n            color: '#666',\n            fontSize: 16,\n            margin: 14\n          }\n        }],\n        series: [{\n          name: '第50百分位',\n          type: 'line',\n          symbol: 'none',\n          lineStyle: {\n            color: '#32BAC0',\n            width: 2\n          },\n          connectNulls: false,\n          missing: 'gap',\n          data: [[new Date('2024-05-10T10:00:00').getTime(), 1], [new Date('2024-05-10T10:01:00').getTime(), 5],\n          // 注意，数据点可以是不连续的\n          [new Date('2024-05-10T10:02:00').getTime(), 3], [new Date('2024-05-10T10:03:00').getTime(), 8], [new Date('2024-05-10T10:05:00').getTime(), 10], [new Date('2024-05-10T10:06:00').getTime(), 6]]\n        }]\n      }\n    };\n  },\n  components: {\n    TChart\n  },\n  mounted() {\n    // if(!hasEventListener(this.$bus,'getData')){\n    //     this.$bus.$on('getData',(data)=>{\n    //       this.manageData(data)  \n    //     })\n    // }\n    this.manageData();\n  },\n  methods: {\n    // 管理数据\n    manageData(data) {\n      // let array = [{\n      //     DataIndex:0,\n      //     DataTs:1715129400,\n      //     DeviceMac:\"hb1234567890\",\n      //     Timezone:8,\n      //     Value:360,\n\n      // }]\n      // array = array.concat(data)\n      // let current = ''\n      let array = [{\n        DataTs: 1715129400,\n        Value: 171\n      }, {\n        DataTs: 1715043000,\n        Value: 239\n      }, {\n        DataTs: 1714956600,\n        Value: 164\n      }, {\n        DataTs: 1714956660,\n        Value: 388\n      }, {\n        DataTs: 1715043060,\n        Value: 218\n      }, {\n        DataTs: 1715129460,\n        Value: 230\n      }, {\n        DataTs: 1715129520,\n        Value: 158\n      }, {\n        DataTs: 1715043120,\n        Value: 267\n      }, {\n        DataTs: 1714956720,\n        Value: 180\n      }, {\n        DataTs: 1714870320,\n        Value: 192\n      }, {\n        DataTs: 1714783920,\n        Value: 255\n      }, {\n        DataTs: 1714697520,\n        Value: 236\n      }, {\n        DataTs: 1714697460,\n        Value: 360\n      }, {\n        DataTs: 1714783860,\n        Value: 397\n      }, {\n        DataTs: 1714870260,\n        Value: 356\n      }, {\n        DataTs: 1714870200,\n        Value: 230\n      }, {\n        DataTs: 1714783800,\n        Value: 387\n      }, {\n        DataTs: 1714697400,\n        Value: 199\n      }];\n      // 将数组分割为时刻数组\n      var map = new Map();\n      array.forEach(item => {\n        item.moment = formatDate(item.DataTs * 1000, 'HH:MM');\n        map.has(item.moment) ? map.get(item.moment).push(item.Value) : map.set(item.moment, [item]);\n      });\n      console.log(map);\n\n      // newArr = [...map.values()];\n      // console.log(newArr)\n    },\n    // 补齐数据\n    makeArrayContinuous(arr, idKey) {\n      let maxId = 0;\n      let minId = Infinity;\n      const existingIds = new Set();\n\n      // 查找最大和最小ID以及已存在的ID\n      arr.forEach(item => {\n        const id = item[idKey];\n        if (id === undefined || existingIds.has(id)) return;\n        existingIds.add(id);\n        maxId = Math.max(maxId, id);\n        minId = Math.min(minId, id);\n      });\n      // 如果数组是连续的，则不需要任何操作\n      if ((maxId - minId) / 60 === arr.length - 1) return arr;\n\n      // 构建一个新数组，补齐缺失的对象\n      const newArr = [];\n      for (let i = minId; i <= maxId; i += 60) {\n        const existingItem = arr.find(item => item[idKey] === i);\n        newArr.push(existingItem || {\n          [idKey]: i,\n          Value: null\n        }); // 如果缺失，则补上一个空对象\n      }\n      return newArr;\n    }\n    // 分割数据\n  },\n  beforeDestroy() {\n    this.$bus.$off('getData');\n  }\n};","map":{"version":3,"names":["TChart","hasEventListener","formatDate","data","initOptions","renderer","option","tooltip","trigger","axisPointer","type","crossStyle","color","grid","left","right","bottom","top","xAxis","boundaryGap","axisTick","axisLine","show","lineStyle","width","axisLabel","fontSize","margin","yAxis","min","max","splitLine","formatter","series","name","symbol","connectNulls","missing","Date","getTime","components","mounted","manageData","methods","array","DataTs","Value","map","Map","forEach","item","moment","has","get","push","set","console","log","makeArrayContinuous","arr","idKey","maxId","minId","Infinity","existingIds","Set","id","undefined","add","Math","length","newArr","i","existingItem","find","beforeDestroy","$bus","$off"],"sources":["src/views/components/Chart/AGPchart.vue"],"sourcesContent":["<template>\n    <div>\n        <t-chart\n                style=\"width: 100%;height:450px;\"\n                :option=\"option\"\n                :init-options=\"initOptions\"\n                theme=\"tduck-echarts-theme\"\n        />\n    </div>\n</template>\n<script>\nimport TChart from '@/views/components/TChart'\nimport { hasEventListener } from \"@/utils/utils\";\nimport {formatDate} from '@/utils/formatTime'\nexport default {\n    data(){\n        return{\n            initOptions: {\n                renderer: 'svg'\n            },\n             option: {\n                tooltip: {\n                    trigger: 'axis',\n                    axisPointer: {\n                    type: 'cross',\n                    crossStyle: {\n                        color: '#999'\n                    }\n                    }\n                },\n                grid:{\n                    left:120,\n                    right:120,\n                    bottom:60,\n                    top:60\n                },\n                xAxis: [\n                    {\n                        type: 'category',\n                        boundaryGap:false,\n                        axisTick: false,\n                        axisLine: {\n                            show: true,\n                            lineStyle: {\n                                color: '#e5e5e5',\n                                width:1,\n                            },\n                        },\n                        axisLabel:{\n                            color: '#666',\n                            fontSize: 16, \n                            margin:14\n                        },\n                    }\n                ],\n                yAxis: [\n                    {\n                    type: 'value',\n                    min: 0,\n                    max: 15,\n                    splitLine:{\n                        lineStyle:{\n                            type:'dashed',\n                            color:'#e5e5e5'\n                        }\n                    },\n                    axisLabel: {\n                        formatter: '{value}',\n                        color: '#666',\n                        fontSize: 16,\n                        margin:14\n                    }\n                    }\n                ],\n                series: [\n                     {\n                        name: '第50百分位',\n                        type: 'line',\n                        symbol:'none',\n                        lineStyle:{\n                            color:'#32BAC0',\n                            width:2\n                        },\n                        connectNulls: false,\n                        missing:'gap',\n                        data: [\n                            [new Date('2024-05-10T10:00:00').getTime(), 1],\n                            [new Date('2024-05-10T10:01:00').getTime(), 5],\n                            // 注意，数据点可以是不连续的\n                            [new Date('2024-05-10T10:02:00').getTime(), 3],\n                            [new Date('2024-05-10T10:03:00').getTime(), 8],\n                            [new Date('2024-05-10T10:05:00').getTime(), 10],\n                            [new Date('2024-05-10T10:06:00').getTime(), 6],\n                        ]\n                    },\n                   \n                   \n                  \n                    \n                ]\n            },\n        }\n    },\n    components: {\n        TChart\n    },\n    mounted(){\n        // if(!hasEventListener(this.$bus,'getData')){\n        //     this.$bus.$on('getData',(data)=>{\n        //       this.manageData(data)  \n        //     })\n        // }\n        this.manageData()\n    },\n    methods:{\n        // 管理数据\n        manageData(data){\n            // let array = [{\n            //     DataIndex:0,\n            //     DataTs:1715129400,\n            //     DeviceMac:\"hb1234567890\",\n            //     Timezone:8,\n            //     Value:360,\n\n            // }]\n            // array = array.concat(data)\n            // let current = ''\n            let array = [{DataTs:1715129400,Value:171},\n            {DataTs:1715043000,Value:239},\n            {DataTs:1714956600,Value:164},\n            {DataTs:1714956660,Value:388},\n            {DataTs:1715043060,Value:218},\n            {DataTs:1715129460,Value:230},\n            {DataTs:1715129520,Value:158},\n            {DataTs:1715043120,Value:267},\n            {DataTs:1714956720,Value:180},\n            {DataTs:1714870320,Value:192},\n            {DataTs:1714783920,Value:255},\n            {DataTs:1714697520,Value:236},\n            {DataTs:1714697460,Value:360},\n            {DataTs:1714783860,Value:397},\n            {DataTs:1714870260,Value:356},\n            {DataTs:1714870200,Value:230},\n            {DataTs:1714783800,Value:387},\n            {DataTs:1714697400,Value:199},\n            ]\n            // 将数组分割为时刻数组\n            var map = new Map();\n            array.forEach(item=>{\n                item.moment = formatDate(item.DataTs*1000,'HH:MM')\n                map.has(item.moment) ? map.get(item.moment).push(item.Value) : map.set(item.moment, [item]);\n            })\n            console.log(map)\n\n            // newArr = [...map.values()];\n            // console.log(newArr)\n        },\n        // 补齐数据\n        makeArrayContinuous(arr, idKey) {\n            let maxId = 0;\n            let minId = Infinity;\n            const existingIds = new Set();\n            \n            // 查找最大和最小ID以及已存在的ID\n            arr.forEach(item => {\n                const id = item[idKey];\n                if (id === undefined || existingIds.has(id)) return;\n                existingIds.add(id);\n                maxId = Math.max(maxId, id);\n                minId = Math.min(minId, id);\n            });\n            // 如果数组是连续的，则不需要任何操作\n            if ((maxId - minId)/60 === arr.length - 1) return arr; \n            \n            // 构建一个新数组，补齐缺失的对象\n            const newArr = [];\n            for (let i = minId; i <= maxId; i+=60) {\n                const existingItem = arr.find(item => item[idKey] === i);\n                newArr.push(existingItem || { [idKey]: i ,Value:null}); // 如果缺失，则补上一个空对象\n            }\n        \n            return newArr;\n        },\n        // 分割数据\n\n    },\n    beforeDestroy(){\n        this.$bus.$off('getData')\n    }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}