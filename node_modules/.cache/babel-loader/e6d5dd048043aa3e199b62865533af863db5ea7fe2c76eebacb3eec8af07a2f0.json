{"ast":null,"code":"\"use strict\";\n\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _defineProperty = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BidiCdpSession = void 0;\nconst CDPSession_js_1 = require(\"../api/CDPSession.js\");\nconst Errors_js_1 = require(\"../common/Errors.js\");\nconst Deferred_js_1 = require(\"../util/Deferred.js\");\n/**\n * @internal\n */\nvar _detached = /*#__PURE__*/new WeakMap();\nvar _connection = /*#__PURE__*/new WeakMap();\nvar _sessionId = /*#__PURE__*/new WeakMap();\nclass BidiCdpSession extends CDPSession_js_1.CDPSession {\n  constructor(frame, sessionId) {\n    super();\n    _classPrivateFieldInitSpec(this, _detached, false);\n    _classPrivateFieldInitSpec(this, _connection, void 0);\n    _classPrivateFieldInitSpec(this, _sessionId, Deferred_js_1.Deferred.create());\n    _defineProperty(this, \"frame\", void 0);\n    /**\n     * @internal\n     */\n    _defineProperty(this, \"onClose\", () => {\n      BidiCdpSession.sessions.delete(this.id());\n      _classPrivateFieldSet(_detached, this, true);\n    });\n    this.frame = frame;\n    if (!this.frame.page().browser().cdpSupported) {\n      return;\n    }\n    const connection = this.frame.page().browser().connection;\n    _classPrivateFieldSet(_connection, this, connection);\n    if (sessionId) {\n      _classPrivateFieldGet(_sessionId, this).resolve(sessionId);\n      BidiCdpSession.sessions.set(sessionId, this);\n    } else {\n      (async () => {\n        try {\n          const {\n            result\n          } = await connection.send('cdp.getSession', {\n            context: frame._id\n          });\n          _classPrivateFieldGet(_sessionId, this).resolve(result.session);\n          BidiCdpSession.sessions.set(result.session, this);\n        } catch (error) {\n          _classPrivateFieldGet(_sessionId, this).reject(error);\n        }\n      })();\n    }\n    // SAFETY: We never throw #sessionId.\n    BidiCdpSession.sessions.set(_classPrivateFieldGet(_sessionId, this).value(), this);\n  }\n  connection() {\n    return undefined;\n  }\n  async send(method, params, options) {\n    if (_classPrivateFieldGet(_connection, this) === undefined) {\n      throw new Errors_js_1.UnsupportedOperation('CDP support is required for this feature. The current browser does not support CDP.');\n    }\n    if (_classPrivateFieldGet(_detached, this)) {\n      throw new Errors_js_1.TargetCloseError(`Protocol error (${method}): Session closed. Most likely the page has been closed.`);\n    }\n    const session = await _classPrivateFieldGet(_sessionId, this).valueOrThrow();\n    const {\n      result\n    } = await _classPrivateFieldGet(_connection, this).send('cdp.sendCommand', {\n      method: method,\n      params: params,\n      session\n    }, options?.timeout);\n    return result.result;\n  }\n  async detach() {\n    if (_classPrivateFieldGet(_connection, this) === undefined || _classPrivateFieldGet(_connection, this).closed || _classPrivateFieldGet(_detached, this)) {\n      return;\n    }\n    try {\n      await this.frame.client.send('Target.detachFromTarget', {\n        sessionId: this.id()\n      });\n    } finally {\n      this.onClose();\n    }\n  }\n  id() {\n    const value = _classPrivateFieldGet(_sessionId, this).value();\n    return typeof value === 'string' ? value : '';\n  }\n}\n_defineProperty(BidiCdpSession, \"sessions\", new Map());\nexports.BidiCdpSession = BidiCdpSession;","map":{"version":3,"names":["CDPSession_js_1","require","Errors_js_1","Deferred_js_1","_detached","WeakMap","_connection","_sessionId","BidiCdpSession","CDPSession","constructor","frame","sessionId","_classPrivateFieldInitSpec","Deferred","create","_defineProperty","sessions","delete","id","_classPrivateFieldSet","page","browser","cdpSupported","connection","_classPrivateFieldGet","resolve","set","result","send","context","_id","session","error","reject","value","undefined","method","params","options","UnsupportedOperation","TargetCloseError","valueOrThrow","timeout","detach","closed","client","onClose","Map","exports"],"sources":["../../../../src/bidi/CDPSession.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}