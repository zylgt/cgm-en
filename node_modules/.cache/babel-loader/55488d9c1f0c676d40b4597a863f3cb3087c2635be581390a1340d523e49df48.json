{"ast":null,"code":"\"use strict\";\n\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CdpWebWorker = void 0;\nconst CDPSession_js_1 = require(\"../api/CDPSession.js\");\nconst Target_js_1 = require(\"../api/Target.js\");\nconst WebWorker_js_1 = require(\"../api/WebWorker.js\");\nconst TimeoutSettings_js_1 = require(\"../common/TimeoutSettings.js\");\nconst util_js_1 = require(\"../common/util.js\");\nconst ExecutionContext_js_1 = require(\"./ExecutionContext.js\");\nconst IsolatedWorld_js_1 = require(\"./IsolatedWorld.js\");\nconst JSHandle_js_1 = require(\"./JSHandle.js\");\n/**\n * @internal\n */\nvar _world = /*#__PURE__*/new WeakMap();\nvar _client = /*#__PURE__*/new WeakMap();\nvar _id = /*#__PURE__*/new WeakMap();\nvar _targetType = /*#__PURE__*/new WeakMap();\nclass CdpWebWorker extends WebWorker_js_1.WebWorker {\n  constructor(client, url, targetId, targetType, consoleAPICalled, exceptionThrown) {\n    super(url);\n    _classPrivateFieldInitSpec(this, _world, void 0);\n    _classPrivateFieldInitSpec(this, _client, void 0);\n    _classPrivateFieldInitSpec(this, _id, void 0);\n    _classPrivateFieldInitSpec(this, _targetType, void 0);\n    _classPrivateFieldSet(_id, this, targetId);\n    _classPrivateFieldSet(_client, this, client);\n    _classPrivateFieldSet(_targetType, this, targetType);\n    _classPrivateFieldSet(_world, this, new IsolatedWorld_js_1.IsolatedWorld(this, new TimeoutSettings_js_1.TimeoutSettings()));\n    _classPrivateFieldGet(_client, this).once('Runtime.executionContextCreated', async event => {\n      _classPrivateFieldGet(_world, this).setContext(new ExecutionContext_js_1.ExecutionContext(client, event.context, _classPrivateFieldGet(_world, this)));\n    });\n    _classPrivateFieldGet(_world, this).emitter.on('consoleapicalled', async event => {\n      try {\n        return consoleAPICalled(event.type, event.args.map(object => {\n          return new JSHandle_js_1.CdpJSHandle(_classPrivateFieldGet(_world, this), object);\n        }), event.stackTrace);\n      } catch (err) {\n        (0, util_js_1.debugError)(err);\n      }\n    });\n    _classPrivateFieldGet(_client, this).on('Runtime.exceptionThrown', exceptionThrown);\n    _classPrivateFieldGet(_client, this).once(CDPSession_js_1.CDPSessionEvent.Disconnected, () => {\n      _classPrivateFieldGet(_world, this).dispose();\n    });\n    // This might fail if the target is closed before we receive all execution contexts.\n    _classPrivateFieldGet(_client, this).send('Runtime.enable').catch(util_js_1.debugError);\n  }\n  mainRealm() {\n    return _classPrivateFieldGet(_world, this);\n  }\n  get client() {\n    return _classPrivateFieldGet(_client, this);\n  }\n  async close() {\n    switch (_classPrivateFieldGet(_targetType, this)) {\n      case Target_js_1.TargetType.SERVICE_WORKER:\n      case Target_js_1.TargetType.SHARED_WORKER:\n        {\n          // For service and shared workers we need to close the target and detach to allow\n          // the worker to stop.\n          await this.client.connection()?.send('Target.closeTarget', {\n            targetId: _classPrivateFieldGet(_id, this)\n          });\n          await this.client.connection()?.send('Target.detachFromTarget', {\n            sessionId: this.client.id()\n          });\n          break;\n        }\n      default:\n        await this.evaluate(() => {\n          self.close();\n        });\n    }\n  }\n}\nexports.CdpWebWorker = CdpWebWorker;","map":{"version":3,"names":["CDPSession_js_1","require","Target_js_1","WebWorker_js_1","TimeoutSettings_js_1","util_js_1","ExecutionContext_js_1","IsolatedWorld_js_1","JSHandle_js_1","_world","WeakMap","_client","_id","_targetType","CdpWebWorker","WebWorker","constructor","client","url","targetId","targetType","consoleAPICalled","exceptionThrown","_classPrivateFieldInitSpec","_classPrivateFieldSet","IsolatedWorld","TimeoutSettings","_classPrivateFieldGet","once","event","setContext","ExecutionContext","context","emitter","on","type","args","map","object","CdpJSHandle","stackTrace","err","debugError","CDPSessionEvent","Disconnected","dispose","send","catch","mainRealm","close","TargetType","SERVICE_WORKER","SHARED_WORKER","connection","sessionId","id","evaluate","self","exports"],"sources":["../../../../src/cdp/WebWorker.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}