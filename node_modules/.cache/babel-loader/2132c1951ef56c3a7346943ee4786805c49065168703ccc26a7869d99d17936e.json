{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.data = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst stream_1 = require(\"stream\");\nconst crypto_1 = require(\"crypto\");\nconst data_uri_to_buffer_1 = require(\"data-uri-to-buffer\");\nconst notmodified_1 = __importDefault(require(\"./notmodified\"));\nconst debug = (0, debug_1.default)('get-uri:data');\nclass DataReadable extends stream_1.Readable {\n  constructor(hash, buf) {\n    super();\n    this.push(buf);\n    this.push(null);\n    this.hash = hash;\n  }\n}\n/**\n * Returns a Readable stream from a \"data:\" URI.\n */\nconst data = async ({\n  href: uri\n}, {\n  cache\n} = {}) => {\n  // need to create a SHA1 hash of the URI string, for cacheability checks\n  // in future `getUri()` calls with the same data URI passed in.\n  const shasum = (0, crypto_1.createHash)('sha1');\n  shasum.update(uri);\n  const hash = shasum.digest('hex');\n  debug('generated SHA1 hash for \"data:\" URI: %o', hash);\n  // check if the cache is the same \"data:\" URI that was previously passed in.\n  if (cache?.hash === hash) {\n    debug('got matching cache SHA1 hash: %o', hash);\n    throw new notmodified_1.default();\n  } else {\n    debug('creating Readable stream from \"data:\" URI buffer');\n    const {\n      buffer\n    } = (0, data_uri_to_buffer_1.dataUriToBuffer)(uri);\n    return new DataReadable(hash, Buffer.from(buffer));\n  }\n};\nexports.data = data;","map":{"version":3,"names":["debug_1","__importDefault","require","stream_1","crypto_1","data_uri_to_buffer_1","notmodified_1","debug","default","DataReadable","Readable","constructor","hash","buf","push","data","href","uri","cache","shasum","createHash","update","digest","buffer","dataUriToBuffer","Buffer","from","exports"],"sources":["../src/data.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;AAAA,MAAAA,OAAA,GAAAC,eAAA,CAAAC,OAAA;AACA,MAAAC,QAAA,GAAAD,OAAA;AACA,MAAAE,QAAA,GAAAF,OAAA;AACA,MAAAG,oBAAA,GAAAH,OAAA;AAEA,MAAAI,aAAA,GAAAL,eAAA,CAAAC,OAAA;AAEA,MAAMK,KAAK,GAAG,IAAAP,OAAA,CAAAQ,OAAW,EAAC,cAAc,CAAC;AAEzC,MAAMC,YAAa,SAAQN,QAAA,CAAAO,QAAQ;EAGlCC,YAAYC,IAAY,EAAEC,GAAW;IACpC,KAAK,EAAE;IACP,IAAI,CAACC,IAAI,CAACD,GAAG,CAAC;IACd,IAAI,CAACC,IAAI,CAAC,IAAI,CAAC;IACf,IAAI,CAACF,IAAI,GAAGA,IAAI;EACjB;;AAOD;;;AAGO,MAAMG,IAAI,GAAgC,MAAAA,CAChD;EAAEC,IAAI,EAAEC;AAAG,CAAE,EACb;EAAEC;AAAK,CAAE,GAAG,EAAE,KACX;EACH;EACA;EACA,MAAMC,MAAM,GAAG,IAAAf,QAAA,CAAAgB,UAAU,EAAC,MAAM,CAAC;EACjCD,MAAM,CAACE,MAAM,CAACJ,GAAG,CAAC;EAClB,MAAML,IAAI,GAAGO,MAAM,CAACG,MAAM,CAAC,KAAK,CAAC;EACjCf,KAAK,CAAC,yCAAyC,EAAEK,IAAI,CAAC;EAEtD;EACA,IAAIM,KAAK,EAAEN,IAAI,KAAKA,IAAI,EAAE;IACzBL,KAAK,CAAC,kCAAkC,EAAEK,IAAI,CAAC;IAC/C,MAAM,IAAIN,aAAA,CAAAE,OAAgB,EAAE;GAC5B,MAAM;IACND,KAAK,CAAC,kDAAkD,CAAC;IACzD,MAAM;MAAEgB;IAAM,CAAE,GAAG,IAAAlB,oBAAA,CAAAmB,eAAe,EAACP,GAAG,CAAC;IACvC,OAAO,IAAIR,YAAY,CAACG,IAAI,EAAEa,MAAM,CAACC,IAAI,CAACH,MAAM,CAAC,CAAC;;AAEpD,CAAC;AApBYI,OAAA,CAAAZ,IAAI,GAAAA,IAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}