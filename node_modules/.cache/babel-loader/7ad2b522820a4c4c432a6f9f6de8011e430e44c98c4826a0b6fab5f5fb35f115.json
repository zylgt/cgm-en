{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2023 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _defineProperty = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InputState = void 0;\nconst protocol_js_1 = require(\"../../../protocol/protocol.js\");\nconst Mutex_js_1 = require(\"../../../utils/Mutex.js\");\nconst InputSource_js_1 = require(\"./InputSource.js\");\nvar _sources = /*#__PURE__*/new WeakMap();\nvar _mutex = /*#__PURE__*/new WeakMap();\nclass InputState {\n  constructor() {\n    _defineProperty(this, \"cancelList\", []);\n    _classPrivateFieldInitSpec(this, _sources, new Map());\n    _classPrivateFieldInitSpec(this, _mutex, new Mutex_js_1.Mutex());\n  }\n  getOrCreate(id, type, subtype) {\n    let source = _classPrivateFieldGet(_sources, this).get(id);\n    if (!source) {\n      switch (type) {\n        case \"none\" /* SourceType.None */:\n          source = new InputSource_js_1.NoneSource();\n          break;\n        case \"key\" /* SourceType.Key */:\n          source = new InputSource_js_1.KeySource();\n          break;\n        case \"pointer\" /* SourceType.Pointer */:\n          {\n            let pointerId = subtype === \"mouse\" /* Input.PointerType.Mouse */ ? 0 : 2;\n            const pointerIds = new Set();\n            for (const [, source] of _classPrivateFieldGet(_sources, this)) {\n              if (source.type === \"pointer\" /* SourceType.Pointer */) {\n                pointerIds.add(source.pointerId);\n              }\n            }\n            while (pointerIds.has(pointerId)) {\n              ++pointerId;\n            }\n            source = new InputSource_js_1.PointerSource(pointerId, subtype);\n            break;\n          }\n        case \"wheel\" /* SourceType.Wheel */:\n          source = new InputSource_js_1.WheelSource();\n          break;\n        default:\n          throw new protocol_js_1.InvalidArgumentException(`Expected \"${\"none\" /* SourceType.None */}\", \"${\"key\" /* SourceType.Key */}\", \"${\"pointer\" /* SourceType.Pointer */}\", or \"${\"wheel\" /* SourceType.Wheel */}\". Found unknown source type ${type}.`);\n      }\n      _classPrivateFieldGet(_sources, this).set(id, source);\n      return source;\n    }\n    if (source.type !== type) {\n      throw new protocol_js_1.InvalidArgumentException(`Input source type of ${id} is ${source.type}, but received ${type}.`);\n    }\n    return source;\n  }\n  get(id) {\n    const source = _classPrivateFieldGet(_sources, this).get(id);\n    if (!source) {\n      throw new protocol_js_1.UnknownErrorException(`Internal error.`);\n    }\n    return source;\n  }\n  getGlobalKeyState() {\n    const state = new InputSource_js_1.KeySource();\n    for (const [, source] of _classPrivateFieldGet(_sources, this)) {\n      if (source.type !== \"key\" /* SourceType.Key */) {\n        continue;\n      }\n      for (const pressed of source.pressed) {\n        state.pressed.add(pressed);\n      }\n      state.alt ||= source.alt;\n      state.ctrl ||= source.ctrl;\n      state.meta ||= source.meta;\n      state.shift ||= source.shift;\n    }\n    return state;\n  }\n  get queue() {\n    return _classPrivateFieldGet(_mutex, this);\n  }\n}\nexports.InputState = InputState;","map":{"version":3,"names":["_classPrivateFieldInitSpec","require","default","_defineProperty","_classPrivateFieldGet","protocol_js_1","Mutex_js_1","InputSource_js_1","_sources","WeakMap","_mutex","InputState","constructor","Map","Mutex","getOrCreate","id","type","subtype","source","get","NoneSource","KeySource","pointerId","pointerIds","Set","add","has","PointerSource","WheelSource","InvalidArgumentException","set","UnknownErrorException","getGlobalKeyState","state","pressed","alt","ctrl","meta","shift","queue","exports"],"sources":["../../../../../src/bidiMapper/modules/input/InputState.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}