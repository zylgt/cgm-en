{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2022 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar _classPrivateMethodInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateMethodInitSpec.js\").default;\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _defineProperty = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar _assertClassBrand = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/assertClassBrand.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nvar _ProcessingQueue;\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ProcessingQueue = void 0;\nconst log_js_1 = require(\"./log.js\");\nvar _logger = /*#__PURE__*/new WeakMap();\nvar _processor = /*#__PURE__*/new WeakMap();\nvar _queue = /*#__PURE__*/new WeakMap();\nvar _isProcessing = /*#__PURE__*/new WeakMap();\nvar _ProcessingQueue_brand = /*#__PURE__*/new WeakSet();\nclass ProcessingQueue {\n  constructor(processor, logger) {\n    _classPrivateMethodInitSpec(this, _ProcessingQueue_brand);\n    _classPrivateFieldInitSpec(this, _logger, void 0);\n    _classPrivateFieldInitSpec(this, _processor, void 0);\n    _classPrivateFieldInitSpec(this, _queue, []);\n    // Flag to keep only 1 active processor.\n    _classPrivateFieldInitSpec(this, _isProcessing, false);\n    _classPrivateFieldSet(_processor, this, processor);\n    _classPrivateFieldSet(_logger, this, logger);\n  }\n  add(entry, name) {\n    _classPrivateFieldGet(_queue, this).push([entry, name]);\n    // No need in waiting. Just initialize processor if needed.\n    void _assertClassBrand(_ProcessingQueue_brand, this, _processIfNeeded).call(this);\n  }\n}\n_ProcessingQueue = ProcessingQueue;\nasync function _processIfNeeded() {\n  if (_classPrivateFieldGet(_isProcessing, this)) {\n    return;\n  }\n  _classPrivateFieldSet(_isProcessing, this, true);\n  while (_classPrivateFieldGet(_queue, this).length > 0) {\n    const arrayEntry = _classPrivateFieldGet(_queue, this).shift();\n    if (!arrayEntry) {\n      continue;\n    }\n    const [entryPromise, name] = arrayEntry;\n    _classPrivateFieldGet(_logger, this)?.call(this, _ProcessingQueue.LOGGER_PREFIX, 'Processing event:', name);\n    await entryPromise.then(entry => {\n      if (entry.kind === 'error') {\n        _classPrivateFieldGet(_logger, this)?.call(this, log_js_1.LogType.debugError, 'Event threw before sending:', entry.error.message, entry.error.stack);\n        return;\n      }\n      return _classPrivateFieldGet(_processor, this).call(this, entry.value);\n    }).catch(error => {\n      _classPrivateFieldGet(_logger, this)?.call(this, log_js_1.LogType.debugError, 'Event was not processed:', error?.message);\n    });\n  }\n  _classPrivateFieldSet(_isProcessing, this, false);\n}\n_defineProperty(ProcessingQueue, \"LOGGER_PREFIX\", `${log_js_1.LogType.debug}:queue`);\nexports.ProcessingQueue = ProcessingQueue;","map":{"version":3,"names":["_classPrivateMethodInitSpec","require","default","_classPrivateFieldInitSpec","_defineProperty","_assertClassBrand","_classPrivateFieldGet","_classPrivateFieldSet","_ProcessingQueue","log_js_1","_logger","WeakMap","_processor","_queue","_isProcessing","_ProcessingQueue_brand","WeakSet","ProcessingQueue","constructor","processor","logger","add","entry","name","push","_processIfNeeded","call","length","arrayEntry","shift","entryPromise","LOGGER_PREFIX","then","kind","LogType","debugError","error","message","stack","value","catch","debug","exports"],"sources":["../../../src/utils/ProcessingQueue.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;AAAA,IAAAA,2BAAA,GAAAC,OAAA,+GAAAC,OAAA;AAAA,IAAAC,0BAAA,GAAAF,OAAA,8GAAAC,OAAA;AAAA,IAAAE,eAAA,GAAAH,OAAA,mGAAAC,OAAA;AAAA,IAAAG,iBAAA,GAAAJ,OAAA,qGAAAC,OAAA;AAAA,IAAAI,qBAAA,GAAAL,OAAA,0GAAAC,OAAA;AAAA,IAAAK,qBAAA,GAAAN,OAAA,0GAAAC,OAAA;AAAA,IAAAM,gBAAA;AAAAP,OAAA;;;;;AAiBA,MAAAQ,QAAA,GAAAR,OAAA;AAAgD,IAAAS,OAAA,oBAAAC,OAAA;AAAA,IAAAC,UAAA,oBAAAD,OAAA;AAAA,IAAAE,MAAA,oBAAAF,OAAA;AAAA,IAAAG,aAAA,oBAAAH,OAAA;AAAA,IAAAI,sBAAA,oBAAAC,OAAA;AAGhD,MAAaC,eAAe;EAU1BC,YAAYC,SAAoC,EAAEC,MAAiB;IAAApB,2BAAA,OAAAe,sBAAA;IAAAZ,0BAAA,OAAAO,OAAA;IAAAP,0BAAA,OAAAS,UAAA;IAAAT,0BAAA,OAAAU,MAAA,EALjB,EAAE;IAEpD;IAAAV,0BAAA,OAAAW,aAAA,EACgB,KAAK;IAGnBP,qBAAA,CAAAK,UAAA,MAAI,EAAcO,SAAS;IAC3BZ,qBAAA,CAAAG,OAAA,MAAI,EAAWU,MAAM;EACvB;EAEAC,GAAGA,CAACC,KAAyB,EAAEC,IAAY;IACzCjB,qBAAA,CAAAO,MAAA,MAAI,EAAQW,IAAI,CAAC,CAACF,KAAK,EAAEC,IAAI,CAAC,CAAC;IAC/B;IACA,KAAAlB,iBAAA,CAAAU,sBAAA,EAAK,IAAI,EAAAU,gBAAA,EAAAC,IAAA,CAAJ,IAAI,CAAmB;EAC9B;;mBAnBWT,eAAe;AAAA,eAAAQ,iBAAA,EAqBJ;EACpB,IAAAnB,qBAAA,CAAAQ,aAAA,EAAI,IAAI,GAAgB;IACtB;EACF;EACAP,qBAAA,CAAAO,aAAA,MAAI,EAAiB,IAAI;EACzB,OAAOR,qBAAA,CAAAO,MAAA,MAAI,EAAQc,MAAM,GAAG,CAAC,EAAE;IAC7B,MAAMC,UAAU,GAAGtB,qBAAA,CAAAO,MAAA,MAAI,EAAQgB,KAAK,EAAE;IACtC,IAAI,CAACD,UAAU,EAAE;MACf;IACF;IACA,MAAM,CAACE,YAAY,EAAEP,IAAI,CAAC,GAAGK,UAAU;IACvCtB,qBAAA,CAAAI,OAAA,MAAI,GAAAgB,IAAA,CAAJ,IAAI,EAAWT,gBAAe,CAACc,aAAa,EAAE,mBAAmB,EAAER,IAAI;IAEvE,MAAMO,YAAY,CACfE,IAAI,CAAEV,KAAK,IAAI;MACd,IAAIA,KAAK,CAACW,IAAI,KAAK,OAAO,EAAE;QAC1B3B,qBAAA,CAAAI,OAAA,MAAI,GAAAgB,IAAA,CAAJ,IAAI,EACFjB,QAAA,CAAAyB,OAAO,CAACC,UAAU,EAClB,6BAA6B,EAC7Bb,KAAK,CAACc,KAAK,CAACC,OAAO,EACnBf,KAAK,CAACc,KAAK,CAACE,KAAK;QAEnB;MACF;MACA,OAAAhC,qBAAA,CAAAM,UAAA,EAAO,IAAI,EAAAc,IAAA,CAAJ,IAAI,EAAYJ,KAAK,CAACiB,KAAK;IACpC,CAAC,CAAC,CACDC,KAAK,CAAEJ,KAAK,IAAI;MACf9B,qBAAA,CAAAI,OAAA,MAAI,GAAAgB,IAAA,CAAJ,IAAI,EACFjB,QAAA,CAAAyB,OAAO,CAACC,UAAU,EAClB,0BAA0B,EAC1BC,KAAK,EAAEC,OAAO;IAElB,CAAC,CAAC;EACN;EAEA9B,qBAAA,CAAAO,aAAA,MAAI,EAAiB,KAAK;AAC5B;AAACV,eAAA,CAzDUa,eAAe,mBACM,GAAGR,QAAA,CAAAyB,OAAO,CAACO,KAAK,QAAiB;AADnEC,OAAA,CAAAzB,eAAA,GAAAA,eAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}