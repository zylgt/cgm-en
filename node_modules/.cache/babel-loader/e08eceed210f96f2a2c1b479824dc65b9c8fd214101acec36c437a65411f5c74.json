{"ast":null,"code":"\"use strict\";\n\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _defineProperty = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _mutex;\nlet _disposable_js_1$disp;\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Mutex = void 0;\n/**\n * @license\n * Copyright 2024 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nconst Deferred_js_1 = require(\"./Deferred.js\");\nconst disposable_js_1 = require(\"./disposable.js\");\n/**\n * @internal\n */\nvar _locked = /*#__PURE__*/new WeakMap();\nvar _acquirers = /*#__PURE__*/new WeakMap();\nclass Mutex {\n  constructor() {\n    _classPrivateFieldInitSpec(this, _locked, false);\n    _classPrivateFieldInitSpec(this, _acquirers, []);\n  }\n  // This is FIFO.\n  async acquire() {\n    if (!_classPrivateFieldGet(_locked, this)) {\n      _classPrivateFieldSet(_locked, this, true);\n      return new Mutex.Guard(this);\n    }\n    const deferred = Deferred_js_1.Deferred.create();\n    _classPrivateFieldGet(_acquirers, this).push(deferred.resolve.bind(deferred));\n    await deferred.valueOrThrow();\n    return new Mutex.Guard(this);\n  }\n  release() {\n    const resolve = _classPrivateFieldGet(_acquirers, this).shift();\n    if (!resolve) {\n      _classPrivateFieldSet(_locked, this, false);\n      return;\n    }\n    resolve();\n  }\n}\n_defineProperty(Mutex, \"Guard\", (_mutex = /*#__PURE__*/new WeakMap(), _disposable_js_1$disp = disposable_js_1.disposeSymbol, class Guard {\n  constructor(mutex) {\n    _classPrivateFieldInitSpec(this, _mutex, void 0);\n    _classPrivateFieldSet(_mutex, this, mutex);\n  }\n  [_disposable_js_1$disp]() {\n    return _classPrivateFieldGet(_mutex, this).release();\n  }\n}));\nexports.Mutex = Mutex;","map":{"version":3,"names":["Deferred_js_1","require","disposable_js_1","_locked","WeakMap","_acquirers","Mutex","constructor","_classPrivateFieldInitSpec","acquire","_classPrivateFieldGet","_classPrivateFieldSet","Guard","deferred","Deferred","create","push","resolve","bind","valueOrThrow","release","shift","_mutex","_disposable_js_1$disp","disposeSymbol","mutex","exports"],"sources":["../../../../src/util/Mutex.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;AAAA;;;;;AAKA,MAAAA,aAAA,GAAAC,OAAA;AACA,MAAAC,eAAA,GAAAD,OAAA;AAEA;;;AAAA,IAAAE,OAAA,oBAAAC,OAAA;AAAA,IAAAC,UAAA,oBAAAD,OAAA;AAGA,MAAaE,KAAK;EAAAC,YAAA;IAAAC,0BAAA,OAAAL,OAAA,EAWN,KAAK;IAAAK,0BAAA,OAAAH,UAAA,EACiB,EAAE;EAAA;EAElC;EACA,MAAMI,OAAOA,CAAA;IACX,IAAI,CAAAC,qBAAA,CAAAP,OAAA,EAAC,IAAI,CAAQ,EAAE;MACjBQ,qBAAA,CAAAR,OAAA,MAAI,EAAW,IAAI;MACnB,OAAO,IAAIG,KAAK,CAACM,KAAK,CAAC,IAAI,CAAC;IAC9B;IACA,MAAMC,QAAQ,GAAGb,aAAA,CAAAc,QAAQ,CAACC,MAAM,EAAQ;IACxCL,qBAAA,CAAAL,UAAA,MAAI,EAAYW,IAAI,CAACH,QAAQ,CAACI,OAAO,CAACC,IAAI,CAACL,QAAQ,CAAC,CAAC;IACrD,MAAMA,QAAQ,CAACM,YAAY,EAAE;IAC7B,OAAO,IAAIb,KAAK,CAACM,KAAK,CAAC,IAAI,CAAC;EAC9B;EAEAQ,OAAOA,CAAA;IACL,MAAMH,OAAO,GAAGP,qBAAA,CAAAL,UAAA,MAAI,EAAYgB,KAAK,EAAE;IACvC,IAAI,CAACJ,OAAO,EAAE;MACZN,qBAAA,CAAAR,OAAA,MAAI,EAAW,KAAK;MACpB;IACF;IACAc,OAAO,EAAE;EACX;;gBAjCWX,KAAK,YAAAgB,MAAA,oBAAAlB,OAAA,IAAAmB,qBAAA,GAMbrB,eAAA,CAAAsB,aAAa,EALD,MAAMZ,KAAK;EAExBL,YAAYkB,KAAY;IAAAjB,0BAAA,OAAAc,MAAA;IACtBX,qBAAA,CAAAW,MAAA,MAAI,EAAUG,KAAK;EACrB;EACA,CAAAF,qBAAA,IAAe;IACb,OAAOb,qBAAA,CAAAY,MAAA,MAAI,EAAQF,OAAO,EAAE;EAC9B;CACD;AATHM,OAAA,CAAApB,KAAA,GAAAA,KAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}