{"ast":null,"code":"import _classPrivateFieldInitSpec from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js\";\nimport _defineProperty from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _classPrivateFieldSet from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js\";\nimport _classPrivateFieldGet from \"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js\";\nvar _mutex;\nimport \"core-js/modules/es.array.push.js\";\n/**\n * @license\n * Copyright 2024 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { Deferred } from './Deferred.js';\nimport { disposeSymbol } from './disposable.js';\n/**\n * @internal\n */\nvar _locked = /*#__PURE__*/new WeakMap();\nvar _acquirers = /*#__PURE__*/new WeakMap();\nexport class Mutex {\n  constructor() {\n    _classPrivateFieldInitSpec(this, _locked, false);\n    _classPrivateFieldInitSpec(this, _acquirers, []);\n  }\n  // This is FIFO.\n  async acquire() {\n    if (!_classPrivateFieldGet(_locked, this)) {\n      _classPrivateFieldSet(_locked, this, true);\n      return new Mutex.Guard(this);\n    }\n    const deferred = Deferred.create();\n    _classPrivateFieldGet(_acquirers, this).push(deferred.resolve.bind(deferred));\n    await deferred.valueOrThrow();\n    return new Mutex.Guard(this);\n  }\n  release() {\n    const resolve = _classPrivateFieldGet(_acquirers, this).shift();\n    if (!resolve) {\n      _classPrivateFieldSet(_locked, this, false);\n      return;\n    }\n    resolve();\n  }\n}\n_defineProperty(Mutex, \"Guard\", (_mutex = /*#__PURE__*/new WeakMap(), class Guard {\n  constructor(mutex) {\n    _classPrivateFieldInitSpec(this, _mutex, void 0);\n    _classPrivateFieldSet(_mutex, this, mutex);\n  }\n  [disposeSymbol]() {\n    return _classPrivateFieldGet(_mutex, this).release();\n  }\n}));","map":{"version":3,"names":["Deferred","disposeSymbol","_locked","WeakMap","_acquirers","Mutex","constructor","_classPrivateFieldInitSpec","acquire","_classPrivateFieldGet","_classPrivateFieldSet","Guard","deferred","create","push","resolve","bind","valueOrThrow","release","shift","_mutex","mutex"],"sources":["../../../../src/util/Mutex.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA;;;;;AAKA,SAAQA,QAAQ,QAAO,eAAe;AACtC,SAAQC,aAAa,QAAO,iBAAiB;AAE7C;;;AAAA,IAAAC,OAAA,oBAAAC,OAAA;AAAA,IAAAC,UAAA,oBAAAD,OAAA;AAGA,OAAM,MAAOE,KAAK;EAAAC,YAAA;IAAAC,0BAAA,OAAAL,OAAA,EAWN,KAAK;IAAAK,0BAAA,OAAAH,UAAA,EACiB,EAAE;EAAA;EAElC;EACA,MAAMI,OAAOA,CAAA;IACX,IAAI,CAAAC,qBAAA,CAAAP,OAAA,EAAC,IAAI,CAAQ,EAAE;MACjBQ,qBAAA,CAAAR,OAAA,MAAI,EAAW,IAAI;MACnB,OAAO,IAAIG,KAAK,CAACM,KAAK,CAAC,IAAI,CAAC;IAC9B;IACA,MAAMC,QAAQ,GAAGZ,QAAQ,CAACa,MAAM,EAAQ;IACxCJ,qBAAA,CAAAL,UAAA,MAAI,EAAYU,IAAI,CAACF,QAAQ,CAACG,OAAO,CAACC,IAAI,CAACJ,QAAQ,CAAC,CAAC;IACrD,MAAMA,QAAQ,CAACK,YAAY,EAAE;IAC7B,OAAO,IAAIZ,KAAK,CAACM,KAAK,CAAC,IAAI,CAAC;EAC9B;EAEAO,OAAOA,CAAA;IACL,MAAMH,OAAO,GAAGN,qBAAA,CAAAL,UAAA,MAAI,EAAYe,KAAK,EAAE;IACvC,IAAI,CAACJ,OAAO,EAAE;MACZL,qBAAA,CAAAR,OAAA,MAAI,EAAW,KAAK;MACpB;IACF;IACAa,OAAO,EAAE;EACX;;gBAjCWV,KAAK,YAAAe,MAAA,oBAAAjB,OAAA,IACD,MAAMQ,KAAK;EAExBL,YAAYe,KAAY;IAAAd,0BAAA,OAAAa,MAAA;IACtBV,qBAAA,CAAAU,MAAA,MAAI,EAAUC,KAAK;EACrB;EACA,CAACpB,aAAa,IAAC;IACb,OAAOQ,qBAAA,CAAAW,MAAA,MAAI,EAAQF,OAAO,EAAE;EAC9B;CACD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}