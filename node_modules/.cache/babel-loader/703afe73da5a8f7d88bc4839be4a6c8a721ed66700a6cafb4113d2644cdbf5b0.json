{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport TChart from '@/views/components/TChart';\nimport { formatDate, formatTime } from '@/utils/formatTime';\nimport { mapGetters } from \"vuex\";\nimport { TIRUtils } from \"@/utils/algorithm/TIR\";\nimport { GlucoseUtils } from \"@/utils/algorithm/Glucose\";\nimport img0 from '@/assets/image/event-icon0.png';\nimport img1 from '@/assets/image/event-icon1.png';\nimport img2 from '@/assets/image/event-icon2.png';\nimport img3 from '@/assets/image/event-icon3.png';\nimport img4 from '@/assets/image/event-icon4.png';\nimport img5 from '@/assets/image/event-icon5.png';\nimport img6 from '@/assets/image/event-icon6.png';\nexport default {\n  data() {\n    return {\n      eventChecked: false,\n      //事件记录开关\n      initOptions: {\n        renderer: 'svg'\n      },\n      option: {\n        grid: [{\n          left: 60,\n          right: 30,\n          top: 10,\n          bottom: 50\n        }],\n        xAxis: [{\n          type: 'category',\n          gridIndex: 0,\n          boundaryGap: false,\n          axisTick: false,\n          splitLine: {\n            show: false,\n            lineStyle: {\n              color: 'var(--color-black-60)'\n            },\n            interval: 59\n          },\n          axisLine: {\n            show: true,\n            lineStyle: {\n              color: 'var(--color-black-60)',\n              width: 1\n            }\n          },\n          data: [],\n          axisLabel: {\n            formatter: function (value, index) {\n              if (index % 360 === 0) {\n                let h = Math.floor(value / 60) < 10 ? '0' + Math.floor(value / 60) : Math.floor(value / 60);\n                let m = value % 60 < 10 ? '0' + value % 60 : value % 60;\n                let moment = h + ':' + m;\n                return moment;\n              }\n              if (index + 1 === 24 * 60) {\n                return '00:00';\n              }\n            },\n            interval: 0,\n            color: 'var(--color-black-60)',\n            fontSize: 20,\n            margin: 20\n          }\n        }],\n        yAxis: [{\n          type: 'value',\n          gridIndex: 0,\n          min: 0,\n          max: 15,\n          splitLine: {\n            lineStyle: {\n              color: 'var(--color-black-60)'\n            }\n          },\n          axisLabel: {\n            formatter: '{value}',\n            color: 'var(--color-black-60)',\n            fontSize: 20,\n            margin: 14\n          }\n        }],\n        series: [\n        //中位线\n        {\n          type: 'line',\n          data: [],\n          z: 9,\n          itemStyle: {\n            color: 'var(--color-primary)'\n          },\n          showSymbol: _.compact(this.dataList.value).length > 1 ? false : true,\n          symbolSize: 1,\n          symbol: 'circle',\n          emphasis: {\n            disabled: true\n          },\n          lineStyle: {\n            width: 2\n          },\n          animation: false,\n          markLine: {\n            silent: true,\n            // 不高亮辅助线\n            symbol: 'none',\n            animation: false,\n            data: [{\n              type: 'min',\n              yAxis: 3.9,\n              lineStyle: {\n                color: 'var(--color-error)',\n                width: 2,\n                type: 'solid'\n              },\n              label: {\n                color: 'var(--color-error)',\n                fontSize: 20,\n                distance: 14,\n                position: 'start'\n              }\n            }, {\n              type: 'max',\n              yAxis: 10,\n              lineStyle: {\n                color: 'var(--color-warning)',\n                width: 2,\n                type: 'solid'\n              },\n              label: {\n                color: 'var(--color-warning)',\n                fontSize: 20,\n                distance: 14,\n                position: 'start'\n              }\n            }]\n          },\n          markArea: {\n            data: [[{\n              yAxis: 3.9\n            }, {\n              yAxis: 10\n            }]],\n            itemStyle: {\n              color: 'rgba(72, 160, 220, 0.05)'\n            }\n          },\n          markPoint: {\n            data: []\n          }\n        }]\n      },\n      tableData: [{\n        time: '7:00',\n        event: '早饭',\n        info: '一个鸡蛋，一个红薯',\n        value: '最大波动幅度 5.0mmol/L'\n      }, {\n        time: '9:00',\n        event: '早饭',\n        info: '一个鸡蛋，一个红薯',\n        value: '最大波动幅度 5.0mmol/L'\n      }],\n      dayInfo: ''\n    };\n  },\n  props: {\n    dataList: {\n      type: Object\n    },\n    eventList: {\n      type: Array\n    }\n  },\n  components: {\n    TChart\n  },\n  computed: {\n    ...mapGetters(['unit'])\n  },\n  mounted() {\n    this.handelOption(this.dataList);\n    this.markEvent(this.eventList);\n    this.chartMouse();\n  },\n  methods: {\n    // 处理数据\n    handelOption(data) {\n      let dayInfo = _.cloneDeep(data);\n      let unit = this.unit;\n      let handelValue = _.compact(dayInfo.value);\n      let fluctate = _.max(dayInfo.value) - _.min(dayInfo.value); //最大波动\n      let avg = GlucoseUtils.calculateMeanCvGmi(handelValue).mean; //平均值\n      let lowTir = null,\n        hightTir = null;\n      if (TIRUtils.getTIRResult(handelValue)) {\n        lowTir = TIRUtils.getTIRResult(handelValue).lowRate + TIRUtils.getTIRResult(handelValue).veryLowRate;\n        hightTir = TIRUtils.getTIRResult(handelValue).highRate + TIRUtils.getTIRResult(handelValue).veryHighRate;\n      }\n      dayInfo.day = formatDate(dayInfo.day, 'mm月dd日');\n      dayInfo.fluctate = unit == 'mg/dL' ? fluctate : GlucoseUtils.mgdlToMmol(fluctate);\n      dayInfo.avg = unit == 'mg/dL' ? Math.round(avg) : GlucoseUtils.mgdlToMmol(avg);\n      dayInfo.lowTir = _.round(Number(lowTir) * 100, 1);\n      dayInfo.hightTir = _.round(Number(hightTir) * 100, 1);\n      this.dayInfo = dayInfo;\n\n      // 图表数据\n      let xData = Array.from({\n        length: 60 * 24\n      }, (item, index) => index);\n      let max = GlucoseUtils.mgdlToMmol(dayInfo.max) < 13.9 ? 13.9 : GlucoseUtils.mgdlToMmol(dayInfo.max);\n      if (unit != 'mg/dL') {\n        dayInfo.value = dayInfo.value.map(val => GlucoseUtils.mgdlToMmol(val));\n      }\n      this.option.tooltip = {\n        show: true,\n        trigger: 'axis',\n        confine: true,\n        axisPointer: {\n          type: 'none',\n          axis: 'x'\n        },\n        formatter(params) {\n          let h = Math.floor(Number(params[0].axisValue) / 60) < 10 ? '0' + Math.floor(Number(params[0].axisValue) / 60) : Math.floor(Number(params[0].axisValue) / 60);\n          let m = Number(params[0].axisValue) % 60 < 10 ? '0' + Number(params[0].axisValue) % 60 : Number(params[0].axisValue) % 60;\n          let moment = h + ':' + m;\n          let html = \"<div class='tooltip-box' >\" + \" <div class='tooltips-val'>\" + \" <span class='tooltips-val-num'>\" + params[0].value + \"</span>\" + unit + \"</div>\" + \" <div class='tooltips-date'>\" + dayInfo.day + ' ' + moment + \" </div>\" + \" </div>\";\n          return html;\n        },\n        extraCssText: 'box-shadow: 0 2px 10px rgba(195,245,247,1);'\n      };\n      this.option.series[0].markPoint.data = [];\n      this.option.series[0].markLine.data = this.option.series[0].markLine.data.splice(0, 2);\n      this.option.xAxis[0].data = xData;\n      this.option.yAxis[0].max = unit == 'mg/dL' ? GlucoseUtils.mmolToMgdl(Math.ceil(max / 3) * 3) : Math.ceil(max / 3) * 3;\n      this.option.series[0].data = dayInfo.value;\n      this.option.series[0].markLine.data[0].yAxis = unit == 'mg/dL' ? 70 : 3.9;\n      this.option.series[0].markLine.data[1].yAxis = unit == 'mg/dL' ? 180 : 10;\n      this.option.series[0].markArea.data[0][0].yAxis = unit == 'mg/dL' ? 70 : 3.9;\n      this.option.series[0].markArea.data[0][1].yAxis = unit == 'mg/dL' ? 180 : 10;\n    },\n    // 标记事件\n    markEvent(data) {\n      let unit = this.unit;\n      let eventData = _.cloneDeep(data);\n      let chartValue = _.cloneDeep(this.dataList.value);\n      let tableData = [];\n      if (unit != 'mg/dL') {\n        chartValue = chartValue.map(val => GlucoseUtils.mgdlToMmol(val));\n      }\n      if (eventData) {\n        eventData.forEach(item => {\n          let img = [img0, img1, img2, img3, img4, img5, img6];\n          this.option.series[0].markPoint.data.push({\n            coord: [item.xIndex, item.yPosition],\n            symbol: 'image://' + img[item.event_type],\n            symbolSize: 30\n          });\n          this.option.series[0].markLine.data.push([{\n            lineStyle: {\n              color: 'var(--color-black-60)',\n              width: 1,\n              type: 'dashed'\n            },\n            coord: [item.xIndex, chartValue[item.xIndex]]\n          }, {\n            coord: [item.xIndex, 0]\n          }]);\n          tableData.push({\n            id: item.event_id,\n            ts: formatDate(item.event_ts * 1000, 'HH:MM'),\n            event_type: item.event_type,\n            event_body: item.event_body\n          });\n          this.tableData = tableData;\n        });\n      } else {\n        this.tableData = [];\n      }\n    },\n    // 图表鼠标事件\n    chartMouse() {\n      let chart = this.$refs.chart.chart;\n      let that = this;\n      chart.on('click', params => {\n        that.eventChecked = true;\n        let row = that.tableData[params.dataIndex];\n        that.$refs.singleTable.setCurrentRow(row);\n        that.option.series[0].markPoint.data.forEach(item => item.symbolSize = 30);\n        that.option.series[0].markPoint.data[params.dataIndex].symbolSize = 50;\n      });\n    },\n    // 表格点击\n    handleCurrentChange(val) {\n      let tableData = this.tableData;\n      let index = _.findIndex(tableData, function (o) {\n        return o.id == val.id;\n      });\n      this.option.series[0].markPoint.data.forEach(item => item.symbolSize = 30);\n      this.option.series[0].markPoint.data[index].symbolSize = 50;\n    }\n  },\n  watch: {\n    dataList(n, o) {\n      this.handelOption(n);\n    },\n    eventList(n, o) {\n      this.markEvent(n);\n    }\n  }\n};","map":{"version":3,"names":["TChart","formatDate","formatTime","mapGetters","TIRUtils","GlucoseUtils","img0","img1","img2","img3","img4","img5","img6","data","eventChecked","initOptions","renderer","option","grid","left","right","top","bottom","xAxis","type","gridIndex","boundaryGap","axisTick","splitLine","show","lineStyle","color","interval","axisLine","width","axisLabel","formatter","value","index","h","Math","floor","m","moment","fontSize","margin","yAxis","min","max","series","z","itemStyle","showSymbol","_","compact","dataList","length","symbolSize","symbol","emphasis","disabled","animation","markLine","silent","label","distance","position","markArea","markPoint","tableData","time","event","info","dayInfo","props","Object","eventList","Array","components","computed","mounted","handelOption","markEvent","chartMouse","methods","cloneDeep","unit","handelValue","fluctate","avg","calculateMeanCvGmi","mean","lowTir","hightTir","getTIRResult","lowRate","veryLowRate","highRate","veryHighRate","day","mgdlToMmol","round","Number","xData","from","item","map","val","tooltip","trigger","confine","axisPointer","axis","params","axisValue","html","extraCssText","splice","mmolToMgdl","ceil","eventData","chartValue","forEach","img","push","coord","xIndex","yPosition","event_type","id","event_id","ts","event_ts","event_body","chart","$refs","that","on","row","dataIndex","singleTable","setCurrentRow","handleCurrentChange","findIndex","o","watch","n"],"sources":["src/views/report/components/dayAnalysis.vue"],"sourcesContent":["<template>\n    <div class='dayAnalysis' id='dayAnalysis' >\n        <div class='analysis-header' >\n            <div class='analysis-date' >{{dayInfo.day}}   {{dayInfo.week}}</div>\n            <div class='analysis-event' v-if='tableData.length>0'> <el-checkbox v-model=\"eventChecked\">事件记录</el-checkbox></div>\n        </div>\n        <div class='analysis-box' >\n            <div class='chart-box'>\n                <div class='analysis-info' >\n                    <div class='analysis-info-item' >\n                        <div class='analysis-info-label' >平均葡萄糖值</div>\n                        <div  :class='[dayInfo.avg>118.8?\"active\":\"\",\"analysis-info-value\"]' v-if='unit==\"mg/dL\"'>{{dayInfo.avg}} mg/dL </div>\n                        <div  :class='[dayInfo.avg>6.6?\"active\":\"\",\"analysis-info-value\"]' v-else>{{dayInfo.avg}} mmol/L </div>\n                    </div>\n                    <div class='analysis-info-item' >\n                        <div class='analysis-info-label' >最大血糖波动</div>\n                        <div  :class='[dayInfo.fluctate>79.2?\"active\":\"\",\"analysis-info-value\"]'  v-if='unit==\"mg/dL\"'>{{dayInfo.fluctate}} mg/dL</div>\n                        <div  :class='[dayInfo.fluctate>4.4?\"active\":\"\",\"analysis-info-value\"]'  v-else>{{dayInfo.fluctate}} mmol/L</div>\n                    </div>\n                    <div class='analysis-info-item' >\n                        <div class='analysis-info-label' >目标范围内占比</div>\n                        <div :class='[dayInfo.tir<70?\"active\":\"\",\"analysis-info-value\"]' >{{dayInfo.tir}}%</div>\n                    </div>\n                    <div class='analysis-info-item' >\n                        <div class='analysis-info-label' >低于目标范围占比</div>\n                        <div :class='[dayInfo.lowTir>5?\"active\":\"\",\"analysis-info-value\"]' >{{dayInfo.lowTir}}%</div>\n                    </div>\n                    <div class='analysis-info-item' >\n                        <div class='analysis-info-label' >高于目标范围占比</div>\n                        <div :class='[dayInfo.hightTir>25?\"active\":\"\",\"analysis-info-value\"]' >{{dayInfo.hightTir}}%</div>\n                    </div>\n                </div>\n                <t-chart\n                        style=\"flex-grow:1;height:450px;\"\n                        :option=\"option\"\n                        :init-options=\"initOptions\"\n                        theme=\"tduck-echarts-theme\"\n                         ref='chart'\n                />\n            </div>\n            <div class='event-box' v-show=\"eventChecked\" >\n                <el-table :data=\"tableData\" style=\"width: 100%;border:none;\" @current-change=\"handleCurrentChange\"\n                header-row-class-name='table-header' highlight-current-row ref=\"singleTable\">\n                    <el-table-column  prop=\"ts\"  label=\"时间\"></el-table-column>\n                    <el-table-column  prop=\"event\"  label=\"事件\">\n                        <template slot-scope=\"scope\"> \n                            <div class='table-event-type' >\n                                <img src=\"~@/assets/image/event-icon0.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==0'>\n                                <img src=\"~@/assets/image/event-icon1.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==1'>\n                                <img src=\"~@/assets/image/event-icon2.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==2'>\n                                <img src=\"~@/assets/image/event-icon3.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==3'>\n                                <img src=\"~@/assets/image/event-icon4.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==4'>\n                                <img src=\"~@/assets/image/event-icon5.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==5'>\n                                <img src=\"~@/assets/image/event-icon6.png\" alt=\"\" class='table-event-icon'  v-if='scope.row.event_type==6'>\n                                <span v-if='scope.row.event_type==0'>{{scope.row.event_body.eat_name}}</span>\n                                <span v-if='scope.row.event_type==1'>{{scope.row.event_body.sport_name}}</span>\n                                <span v-if='scope.row.event_type==2'>{{scope.row.event_body.medicine_name}}</span>\n                                <span v-if='scope.row.event_type==3'>{{scope.row.event_body.insulin_name}}</span>\n                                <span v-if='scope.row.event_type==4'>{{scope.row.event_body.sleep_name}}</span>\n                                <span v-if='scope.row.event_type==5'>指尖血</span>\n                                <span v-if='scope.row.event_type==6'>{{scope.row.event_body.custom_name}}</span>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column  prop=\"event\"  label=\"记录详情\">\n                        <template slot-scope=\"scope\"> \n                            <div class='table-event-type' >\n                                <span v-if='scope.row.event_type==0'>{{scope.row.event_body.remark}}</span>\n                                <span v-if='scope.row.event_type==1'>{{scope.row.event_body.total_minute}}分钟</span>\n                                <span v-if='scope.row.event_type==2'>{{scope.row.event_body.medicine_time_name}}</span>\n                                <span v-if='scope.row.event_type==3'>{{scope.row.event_body.medicine_name}}</span>\n                                <span v-if='scope.row.event_type==4'>{{scope.row.event_body.total_minute}}分钟</span>\n                                <span v-if='scope.row.event_type==5'>{{scope.row.event_body.fingertipblood_name}}</span>\n                                <span v-if='scope.row.event_type==6'>{{scope.row.event_body.remark}}</span>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column  prop=\"value\"  label=\"测量值\"></el-table-column>\n                </el-table>\n            </div>\n            <div class='event-type'>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon0.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >饮食记录</p>\n                </div>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon1.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >运动记录</p>\n                </div>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon2.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >胰岛素记录</p>\n                </div>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon3.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >用药记录</p>\n                </div>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon4.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >睡眠记录</p>\n                </div>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon5.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >指尖血记录</p>\n                </div>\n                <div class='event-type-item' >\n                    <img src=\"~@/assets/image/event-icon6.png\" alt=\"\" class='event-icon' >\n                    <p class='event-type-label' >其他事件</p>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport TChart from '@/views/components/TChart'\nimport {formatDate,formatTime} from '@/utils/formatTime'\nimport {mapGetters} from \"vuex\"\nimport { TIRUtils } from \"@/utils/algorithm/TIR\";\nimport { GlucoseUtils } from \"@/utils/algorithm/Glucose\";\nimport img0 from '@/assets/image/event-icon0.png'\nimport img1 from '@/assets/image/event-icon1.png'\nimport img2 from '@/assets/image/event-icon2.png'\nimport img3 from '@/assets/image/event-icon3.png'\nimport img4 from '@/assets/image/event-icon4.png'\nimport img5 from '@/assets/image/event-icon5.png'\nimport img6 from '@/assets/image/event-icon6.png'\n\nexport default {\n    data(){\n        return{\n            eventChecked:false, //事件记录开关\n            initOptions: {\n                renderer: 'svg'\n            },\n            option: {\n                grid:[\n                    {\n                        left:60,\n                        right:30,\n                        top:10,\n                        bottom:50\n                    }\n                ],\n                xAxis: [\n                    {\n                        type: 'category',\n                        gridIndex:0,\n                        boundaryGap:false,\n                        axisTick: false,\n                        splitLine:{\n                            show:false,\n                            lineStyle:{\n                                color:'var(--color-black-60)'\n                            },\n                            interval:59\n                        },\n                        axisLine: {\n                            show: true,\n                            lineStyle: {\n                                color: 'var(--color-black-60)',\n                                width:1,\n                            },\n                        },\n                        data:[],\n                        axisLabel: {\n                            formatter: function (value, index) {\n                                if (index  % 360 === 0) {\n                                    let h =  Math.floor(value/60)<10 ? '0'+ Math.floor(value/60) : Math.floor(value/60) \n                                    let m =  value%60 < 10 ? '0' + value%60 : value%60\n                                    let moment = h+':'+m\n                                    return moment;\n                                }\n                                if(index+1===24*60){\n                                    return '00:00'\n                                }\n                            },\n                            interval:0,\n                            color: 'var(--color-black-60)',\n                            fontSize: 20, \n                            margin:20\n                        }\n                    }\n                ],\n                yAxis: [\n                    {\n                        type: 'value',\n                        gridIndex:0,\n                        min: 0,\n                        max: 15,\n                        splitLine:{\n                            lineStyle:{\n                                color:'var(--color-black-60)'\n                            }\n                        },\n                        axisLabel: {\n                            formatter: '{value}',\n                            color: 'var(--color-black-60)',\n                            fontSize: 20,\n                            margin:14\n                        }\n                    }\n                ],\n                series: [\n                    //中位线\n                    {\n                        type: 'line',\n                        data: [],\n                        z:9,\n                        itemStyle: {\n                        color:'var(--color-primary)',\n                        },\n                        showSymbol:_.compact(this.dataList.value).length>1?false:true,\n                        symbolSize:1,\n                        symbol:'circle',\n                        emphasis:{\n                            disabled:true\n                        },\n                        lineStyle: {\n                        width: 2,\n                        },\n                        animation:false,\n                        markLine: {\n                            silent: true, // 不高亮辅助线\n                            symbol: 'none',\n                            animation:false,\n                            data: [\n                                {\n                                type: 'min',\n                                yAxis:3.9,\n                                lineStyle: {\n                                    color: 'var(--color-error)',\n                                    width: 2,\n                                    type:'solid'\n                                },\n                                label: {\n                                    color: 'var(--color-error)',\n                                    fontSize: 20,\n                                    distance: 14,\n                                    position:'start'\n                                },\n                                },\n                                {\n                                type: 'max',\n                                yAxis:10,\n                                lineStyle: {\n                                    color: 'var(--color-warning)',\n                                    width: 2,\n                                    type:'solid'\n                                },\n                                label: {\n                                    color: 'var(--color-warning)',\n                                    fontSize: 20,\n                                    distance:14,\n                                    position:'start'\n                                },\n                                }\n                            ],\n                        },\n                        markArea:{\n                            data:[\n                                [{\n                                    yAxis: 3.9\n                                },\n                                {   \n                                    yAxis: 10\n                                }]\n                            ],\n                            itemStyle:{\n                                color:'rgba(72, 160, 220, 0.05)'\n                            }\n                        },\n                        markPoint:{\n                            data:[\n                                \n                            ]\n                        }\n                    }\n                ],\n\n                \n            },\n            tableData:[{\n                time:'7:00',\n                event:'早饭',\n                info:'一个鸡蛋，一个红薯',\n                value:'最大波动幅度 5.0mmol/L'\n            },{\n                time:'9:00',\n                event:'早饭',\n                info:'一个鸡蛋，一个红薯',\n                value:'最大波动幅度 5.0mmol/L'\n            }],\n            dayInfo:'',\n        }\n    },\n    props:{\n        dataList:{\n            type:Object\n        },\n        eventList:{\n            type:Array\n        }\n    },\n    components: {\n        TChart\n    },\n    computed:{\n         ...mapGetters([\n            'unit']),\n    },\n    mounted(){\n        this.handelOption(this.dataList)\n        this.markEvent(this.eventList)\n        this.chartMouse()\n    },\n    methods:{\n        // 处理数据\n        handelOption(data){\n            let dayInfo = _.cloneDeep(data)\n            let unit = this.unit\n            let handelValue = _.compact(dayInfo.value)\n            let fluctate = _.max(dayInfo.value) -  _.min(dayInfo.value) //最大波动\n            let avg = GlucoseUtils.calculateMeanCvGmi(handelValue).mean //平均值\n            let lowTir = null,hightTir=null\n            if(TIRUtils.getTIRResult(handelValue)){\n                lowTir = TIRUtils.getTIRResult(handelValue).lowRate + TIRUtils.getTIRResult(handelValue).veryLowRate\n                hightTir = TIRUtils.getTIRResult(handelValue).highRate + TIRUtils.getTIRResult(handelValue).veryHighRate\n            }\n            dayInfo.day = formatDate(dayInfo.day,'mm月dd日')\n            dayInfo.fluctate = unit=='mg/dL'?fluctate:GlucoseUtils.mgdlToMmol(fluctate);\n            dayInfo.avg = unit=='mg/dL'? Math.round(avg):GlucoseUtils.mgdlToMmol(avg);\n            dayInfo.lowTir = _.round(Number(lowTir)*100, 1);\n            dayInfo.hightTir =  _.round(Number(hightTir)*100, 1);\n            this.dayInfo = dayInfo\n            \n            // 图表数据\n            let xData = Array.from({length:60*24},(item, index) => index)\n            let max = GlucoseUtils.mgdlToMmol(dayInfo.max)<13.9?13.9: GlucoseUtils.mgdlToMmol(dayInfo.max)\n            if(unit != 'mg/dL'){\n                dayInfo.value = dayInfo.value.map(val => GlucoseUtils.mgdlToMmol(val));\n            }\n            this.option.tooltip = {\n                    show:true,\n                    trigger:'axis',\n                    confine:true,\n                    axisPointer:{\n                        type:'none',\n                        axis:'x'\n                    },\n                    formatter(params){\n                        let h =  Math.floor(Number(params[0].axisValue)/60)<10 ? '0'+ Math.floor(Number(params[0].axisValue)/60) : Math.floor(Number(params[0].axisValue)/60) \n                        let m =  Number(params[0].axisValue)%60 < 10 ? '0' + Number(params[0].axisValue)%60 : Number(params[0].axisValue)%60\n                        let moment = h+':'+m\n                        let html =  \"<div class='tooltip-box' >\"+\n                           \" <div class='tooltips-val'>\"+\n                               \" <span class='tooltips-val-num'>\"+params[0].value+\"</span>\"+unit+\n                            \"</div>\"+\n                           \" <div class='tooltips-date'>\"+\n                               dayInfo.day +' '+ moment+\n                           \" </div>\"+\n                       \" </div>\"\n                       \n                        return html\n                    },\n                    extraCssText: 'box-shadow: 0 2px 10px rgba(195,245,247,1);'\n            }\n            this.option.series[0].markPoint.data = []\n            this.option.series[0].markLine.data = this.option.series[0].markLine.data.splice(0,2)\n            this.option.xAxis[0].data = xData\n            this.option.yAxis[0].max = unit == 'mg/dL'?GlucoseUtils.mmolToMgdl(Math.ceil(max / 3) * 3):Math.ceil(max / 3) * 3\n            this.option.series[0].data = dayInfo.value\n            this.option.series[0].markLine.data[0].yAxis = unit == 'mg/dL'?70:3.9\n            this.option.series[0].markLine.data[1].yAxis = unit == 'mg/dL'?180:10\n            this.option.series[0].markArea.data[0][0].yAxis = unit == 'mg/dL'?70:3.9\n            this.option.series[0].markArea.data[0][1].yAxis = unit == 'mg/dL'?180:10\n        },\n        // 标记事件\n        markEvent(data){\n            let unit = this.unit\n            let eventData = _.cloneDeep(data)\n            let chartValue = _.cloneDeep(this.dataList.value)\n            let tableData = []\n            if(unit != 'mg/dL'){\n                chartValue = chartValue.map(val => GlucoseUtils.mgdlToMmol(val));\n            }\n            if(eventData){\n                eventData.forEach(item=>{\n                    let img =[img0,img1,img2,img3,img4,img5,img6]\n                    this.option.series[0].markPoint.data.push({\n                        coord:[item.xIndex,item.yPosition],\n                        symbol:'image://'+img[item.event_type],\n                        symbolSize:30\n                    })\n                    this.option.series[0].markLine.data.push([{\n                        lineStyle:{\n                                color: 'var(--color-black-60)',\n                                width: 1,\n                                type:'dashed'\n                        },\n                        coord:[item.xIndex,chartValue[item.xIndex]],\n                    },{\n                        coord:[item.xIndex,0],\n                    }])\n                    tableData.push({\n                        id:item.event_id,\n                        ts:formatDate(item.event_ts*1000,'HH:MM'),\n                        event_type:item.event_type,\n                        event_body:item.event_body\n                    })\n                    this.tableData = tableData\n                })\n            }else{\n                this.tableData = []\n            }\n        },\n        // 图表鼠标事件\n        chartMouse(){\n            let chart = this.$refs.chart.chart\n            let that = this\n            chart.on('click',(params)=>{\n                that.eventChecked = true\n                let row = that.tableData[params.dataIndex]\n                that.$refs.singleTable.setCurrentRow(row);\n                that.option.series[0].markPoint.data.forEach(item=>item.symbolSize = 30)\n                that.option.series[0].markPoint.data[params.dataIndex].symbolSize = 50\n            })\n        },\n        // 表格点击\n        handleCurrentChange(val){\n            let tableData = this.tableData\n            let index = _.findIndex(tableData,function(o){return o.id==val.id})\n            this.option.series[0].markPoint.data.forEach(item=>item.symbolSize = 30)\n            this.option.series[0].markPoint.data[index].symbolSize = 50\n\n        }\n    },\n    watch:{\n        dataList(n,o){\n            this.handelOption(n)\n        },\n        eventList(n,o){\n            this.markEvent(n)\n        },\n    }\n}\n</script>\n<style >\n.dayAnalysis{\n    padding:20px 0;\n    border-bottom:1px solid rgba(0,0,0,0.1);\n}\n.analysis-header{\n    display: flex;\n    align-items: center;\n    margin-bottom:20px;\n}\n.analysis-date{\n    width:180px;\n    font-size:var(--fontSize-max);\n    color: var(--color-black-100);\n}\n/* 图表血糖信息 */\n.chart-box{\n    display: flex;\n    height:450px;\n    margin-bottom:20px;\n}\n.analysis-info{\n    width:180px;\n    height:450px;\n    background: #f7f7f7;\n    box-sizing: border-box;\n    padding:10px;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n     font-size:var(--fontSize-max);\n    color: var(--color-black-100);\n}\n.analysis-info-value.active{\n    color:var(--color-error);\n}\n.event-type{\n    display: flex;\n    align-items: center;\n    margin-top:20px;\n}\n.event-type-item{\n    display: flex;\n    align-items: center;\n    margin-right:30px;\n}\n.event-icon{\n    width:30px;\n    height:30px;\n}\n.event-type-label{\n    font-size:var(--fontSize-big);\n    color: var(--color-black-60);\n    margin-left:6px;\n}\n/* 表格 */\n.table-event-type{\n    display: flex;\n}\n.table-event-icon{\n    width:30px;\n    height:30px;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}