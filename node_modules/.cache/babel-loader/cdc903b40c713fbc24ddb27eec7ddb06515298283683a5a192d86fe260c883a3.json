{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2022 Google LLC.\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nrequire(\"core-js/modules/es.regexp.flags.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRemoteValuesText = exports.logMessageFormatter = void 0;\nconst assert_js_1 = require(\"../../../utils/assert.js\");\nconst specifiers = ['%s', '%d', '%i', '%f', '%o', '%O', '%c'];\nfunction isFormatSpecifier(str) {\n  return specifiers.some(spec => str.includes(spec));\n}\n/**\n * @param args input remote values to be format printed\n * @return parsed text of the remote values in specific format\n */\nfunction logMessageFormatter(args) {\n  let output = '';\n  const argFormat = args[0].value.toString();\n  const argValues = args.slice(1, undefined);\n  const tokens = argFormat.split(new RegExp(specifiers.map(spec => `(${spec})`).join('|'), 'g'));\n  for (const token of tokens) {\n    if (token === undefined || token === '') {\n      continue;\n    }\n    if (isFormatSpecifier(token)) {\n      const arg = argValues.shift();\n      // raise an exception when less value is provided\n      (0, assert_js_1.assert)(arg, `Less value is provided: \"${getRemoteValuesText(args, false)}\"`);\n      if (token === '%s') {\n        output += stringFromArg(arg);\n      } else if (token === '%d' || token === '%i') {\n        if (arg.type === 'bigint' || arg.type === 'number' || arg.type === 'string') {\n          output += parseInt(arg.value.toString(), 10);\n        } else {\n          output += 'NaN';\n        }\n      } else if (token === '%f') {\n        if (arg.type === 'bigint' || arg.type === 'number' || arg.type === 'string') {\n          output += parseFloat(arg.value.toString());\n        } else {\n          output += 'NaN';\n        }\n      } else {\n        // %o, %O, %c\n        output += toJson(arg);\n      }\n    } else {\n      output += token;\n    }\n  }\n  // raise an exception when more value is provided\n  if (argValues.length > 0) {\n    throw new Error(`More value is provided: \"${getRemoteValuesText(args, false)}\"`);\n  }\n  return output;\n}\nexports.logMessageFormatter = logMessageFormatter;\n/**\n * @param arg input remote value to be parsed\n * @return parsed text of the remote value\n *\n * input: {\"type\": \"number\", \"value\": 1}\n * output: 1\n *\n * input: {\"type\": \"string\", \"value\": \"abc\"}\n * output: \"abc\"\n *\n * input: {\"type\": \"object\",  \"value\": [[\"id\", {\"type\": \"number\", \"value\": 1}]]}\n * output: '{\"id\": 1}'\n *\n * input: {\"type\": \"object\", \"value\": [[\"font-size\", {\"type\": \"string\", \"value\": \"20px\"}]]}\n * output: '{\"font-size\": \"20px\"}'\n */\nfunction toJson(arg) {\n  // arg type validation\n  if (arg.type !== 'array' && arg.type !== 'bigint' && arg.type !== 'date' && arg.type !== 'number' && arg.type !== 'object' && arg.type !== 'string') {\n    return stringFromArg(arg);\n  }\n  if (arg.type === 'bigint') {\n    return `${arg.value.toString()}n`;\n  }\n  if (arg.type === 'number') {\n    return arg.value.toString();\n  }\n  if (['date', 'string'].includes(arg.type)) {\n    return JSON.stringify(arg.value);\n  }\n  if (arg.type === 'object') {\n    return `{${arg.value.map(pair => {\n      return `${JSON.stringify(pair[0])}:${toJson(pair[1])}`;\n    }).join(',')}}`;\n  }\n  if (arg.type === 'array') {\n    return `[${arg.value?.map(val => toJson(val)).join(',') ?? ''}]`;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-base-to-string\n  throw Error(`Invalid value type: ${arg}`);\n}\nfunction stringFromArg(arg) {\n  if (!Object.hasOwn(arg, 'value')) {\n    return arg.type;\n  }\n  switch (arg.type) {\n    case 'string':\n    case 'number':\n    case 'boolean':\n    case 'bigint':\n      return String(arg.value);\n    case 'regexp':\n      return `/${arg.value.pattern}/${arg.value.flags ?? ''}`;\n    case 'date':\n      return new Date(arg.value).toString();\n    case 'object':\n      return `Object(${arg.value?.length ?? ''})`;\n    case 'array':\n      return `Array(${arg.value?.length ?? ''})`;\n    case 'map':\n      return `Map(${arg.value?.length})`;\n    case 'set':\n      return `Set(${arg.value?.length})`;\n    default:\n      return arg.type;\n  }\n}\nfunction getRemoteValuesText(args, formatText) {\n  const arg = args[0];\n  if (!arg) {\n    return '';\n  }\n  // if args[0] is a format specifier, format the args as output\n  if (arg.type === 'string' && isFormatSpecifier(arg.value.toString()) && formatText) {\n    return logMessageFormatter(args);\n  }\n  // if args[0] is not a format specifier, just join the args with \\u0020 (unicode 'SPACE')\n  return args.map(arg => {\n    return stringFromArg(arg);\n  }).join('\\u0020');\n}\nexports.getRemoteValuesText = getRemoteValuesText;","map":{"version":3,"names":["require","assert_js_1","specifiers","isFormatSpecifier","str","some","spec","includes","logMessageFormatter","args","output","argFormat","value","toString","argValues","slice","undefined","tokens","split","RegExp","map","join","token","arg","shift","assert","getRemoteValuesText","stringFromArg","type","parseInt","parseFloat","toJson","length","Error","exports","JSON","stringify","pair","val","Object","hasOwn","String","pattern","flags","Date","formatText"],"sources":["../../../../../src/bidiMapper/modules/log/logHelper.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}