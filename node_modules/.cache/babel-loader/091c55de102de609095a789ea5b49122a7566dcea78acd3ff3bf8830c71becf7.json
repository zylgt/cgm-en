{"ast":null,"code":"\"use strict\";\n\n/* eslint-disable @typescript-eslint/no-require-imports */\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.loadTs = exports.loadTsSync = exports.loadYaml = exports.loadJson = exports.loadJs = exports.loadJsSync = void 0;\nconst fs_1 = require(\"fs\");\nconst promises_1 = require(\"fs/promises\");\nconst path_1 = __importDefault(require(\"path\"));\nconst url_1 = require(\"url\");\nlet importFresh;\nconst loadJsSync = function loadJsSync(filepath) {\n  if (importFresh === undefined) {\n    importFresh = require('import-fresh');\n  }\n  return importFresh(filepath);\n};\nexports.loadJsSync = loadJsSync;\nconst loadJs = async function loadJs(filepath) {\n  try {\n    const {\n      href\n    } = (0, url_1.pathToFileURL)(filepath);\n    return (await import(href)).default;\n  } catch (error) {\n    try {\n      return (0, exports.loadJsSync)(filepath, '');\n    } catch (requireError) {\n      if (requireError.code === 'ERR_REQUIRE_ESM' || requireError instanceof SyntaxError && requireError.toString().includes('Cannot use import statement outside a module')) {\n        throw error;\n      }\n      throw requireError;\n    }\n  }\n};\nexports.loadJs = loadJs;\nlet parseJson;\nconst loadJson = function loadJson(filepath, content) {\n  if (parseJson === undefined) {\n    parseJson = require('parse-json');\n  }\n  try {\n    return parseJson(content);\n  } catch (error) {\n    error.message = `JSON Error in ${filepath}:\\n${error.message}`;\n    throw error;\n  }\n};\nexports.loadJson = loadJson;\nlet yaml;\nconst loadYaml = function loadYaml(filepath, content) {\n  if (yaml === undefined) {\n    yaml = require('js-yaml');\n  }\n  try {\n    return yaml.load(content);\n  } catch (error) {\n    error.message = `YAML Error in ${filepath}:\\n${error.message}`;\n    throw error;\n  }\n};\nexports.loadYaml = loadYaml;\nlet typescript;\nconst loadTsSync = function loadTsSync(filepath, content) {\n  /* istanbul ignore next -- @preserve */\n  if (typescript === undefined) {\n    typescript = require('typescript');\n  }\n  const compiledFilepath = `${filepath.slice(0, -2)}cjs`;\n  try {\n    const config = resolveTsConfig(path_1.default.dirname(filepath)) ?? {};\n    config.compilerOptions = {\n      ...config.compilerOptions,\n      module: typescript.ModuleKind.NodeNext,\n      moduleResolution: typescript.ModuleResolutionKind.NodeNext,\n      target: typescript.ScriptTarget.ES2022,\n      noEmit: false\n    };\n    content = typescript.transpileModule(content, config).outputText;\n    (0, fs_1.writeFileSync)(compiledFilepath, content);\n    return (0, exports.loadJsSync)(compiledFilepath, content).default;\n  } catch (error) {\n    error.message = `TypeScript Error in ${filepath}:\\n${error.message}`;\n    throw error;\n  } finally {\n    if ((0, fs_1.existsSync)(compiledFilepath)) {\n      (0, fs_1.rmSync)(compiledFilepath);\n    }\n  }\n};\nexports.loadTsSync = loadTsSync;\nconst loadTs = async function loadTs(filepath, content) {\n  if (typescript === undefined) {\n    typescript = (await import('typescript')).default;\n  }\n  const compiledFilepath = `${filepath.slice(0, -2)}mjs`;\n  let transpiledContent;\n  try {\n    try {\n      const config = resolveTsConfig(path_1.default.dirname(filepath)) ?? {};\n      config.compilerOptions = {\n        ...config.compilerOptions,\n        module: typescript.ModuleKind.ES2022,\n        moduleResolution: typescript.ModuleResolutionKind.Bundler,\n        target: typescript.ScriptTarget.ES2022,\n        noEmit: false\n      };\n      transpiledContent = typescript.transpileModule(content, config).outputText;\n      await (0, promises_1.writeFile)(compiledFilepath, transpiledContent);\n    } catch (error) {\n      error.message = `TypeScript Error in ${filepath}:\\n${error.message}`;\n      throw error;\n    }\n    // eslint-disable-next-line @typescript-eslint/return-await\n    return await (0, exports.loadJs)(compiledFilepath, transpiledContent);\n  } finally {\n    if ((0, fs_1.existsSync)(compiledFilepath)) {\n      await (0, promises_1.rm)(compiledFilepath);\n    }\n  }\n};\nexports.loadTs = loadTs;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction resolveTsConfig(directory) {\n  const filePath = typescript.findConfigFile(directory, fileName => {\n    return typescript.sys.fileExists(fileName);\n  });\n  if (filePath !== undefined) {\n    const {\n      config,\n      error\n    } = typescript.readConfigFile(filePath, path => typescript.sys.readFile(path));\n    if (error) {\n      throw new Error(`Error in ${filePath}: ${error.messageText.toString()}`);\n    }\n    return config;\n  }\n  return;\n}","map":{"version":3,"names":["fs_1","require","promises_1","path_1","__importDefault","url_1","importFresh","loadJsSync","filepath","undefined","exports","loadJs","href","pathToFileURL","default","error","requireError","code","SyntaxError","toString","includes","parseJson","loadJson","content","message","yaml","loadYaml","load","typescript","loadTsSync","compiledFilepath","slice","config","resolveTsConfig","dirname","compilerOptions","module","ModuleKind","NodeNext","moduleResolution","ModuleResolutionKind","target","ScriptTarget","ES2022","noEmit","transpileModule","outputText","writeFileSync","existsSync","rmSync","loadTs","transpiledContent","Bundler","writeFile","rm","directory","filePath","findConfigFile","fileName","sys","fileExists","readConfigFile","path","readFile","Error","messageText"],"sources":["../src/loaders.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}