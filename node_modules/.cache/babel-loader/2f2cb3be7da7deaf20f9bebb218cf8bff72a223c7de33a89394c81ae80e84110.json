{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2024 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar _classPrivateMethodInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateMethodInitSpec.js\").default;\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateGetter = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateGetter.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nvar _assertClassBrand = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/assertClassBrand.js\").default;\nrequire(\"core-js/modules/es.array.push.js\");\nvar __runInitializers = this && this.__runInitializers || function (thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n    value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\nvar __esDecorate = this && this.__esDecorate || function (ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) {\n    if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\");\n    return f;\n  }\n  var kind = contextIn.kind,\n    key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _,\n    done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n    var context = {};\n    for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n    for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n    context.addInitializer = function (f) {\n      if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\");\n      extraInitializers.push(accept(f || null));\n    };\n    var result = (0, decorators[i])(kind === \"accessor\" ? {\n      get: descriptor.get,\n      set: descriptor.set\n    } : descriptor[key], context);\n    if (kind === \"accessor\") {\n      if (result === void 0) continue;\n      if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n      if (_ = accept(result.get)) descriptor.get = _;\n      if (_ = accept(result.set)) descriptor.set = _;\n      if (_ = accept(result.init)) initializers.unshift(_);\n    } else if (_ = accept(result)) {\n      if (kind === \"field\") initializers.unshift(_);else descriptor[key] = _;\n    }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Navigation = void 0;\nconst EventEmitter_js_1 = require(\"../../common/EventEmitter.js\");\nconst decorators_js_1 = require(\"../../util/decorators.js\");\nconst disposable_js_1 = require(\"../../util/disposable.js\");\n/**\n * @internal\n */\nlet Navigation = ((_ref, _Navigation, _request, _navigation, _browsingContext, _disposables, _id, _Navigation_brand) => {\n  var _a;\n  let _classSuper = EventEmitter_js_1.EventEmitter;\n  let _instanceExtraInitializers = [];\n  let _dispose_decorators;\n  return _request = /*#__PURE__*/new WeakMap(), _navigation = /*#__PURE__*/new WeakMap(), _browsingContext = /*#__PURE__*/new WeakMap(), _disposables = /*#__PURE__*/new WeakMap(), _id = /*#__PURE__*/new WeakMap(), _Navigation_brand = /*#__PURE__*/new WeakSet(), _ref = (_dispose_decorators = [decorators_js_1.inertIfDisposed], disposable_js_1.disposeSymbol), (_Navigation = class Navigation extends _classSuper {\n    static from(context) {\n      const navigation = new Navigation(context);\n      _assertClassBrand(_Navigation_brand, navigation, _initialize).call(navigation);\n      return navigation;\n    }\n    constructor(context) {\n      super();\n      _classPrivateMethodInitSpec(this, _Navigation_brand);\n      _classPrivateFieldInitSpec(this, _request, (__runInitializers(this, _instanceExtraInitializers), void 0));\n      _classPrivateFieldInitSpec(this, _navigation, void 0);\n      _classPrivateFieldInitSpec(this, _browsingContext, void 0);\n      _classPrivateFieldInitSpec(this, _disposables, new disposable_js_1.DisposableStack());\n      _classPrivateFieldInitSpec(this, _id, void 0);\n      _classPrivateFieldSet(_browsingContext, this, context);\n    }\n    get disposed() {\n      return _classPrivateFieldGet(_disposables, this).disposed;\n    }\n    get request() {\n      return _classPrivateFieldGet(_request, this);\n    }\n    get navigation() {\n      return _classPrivateFieldGet(_navigation, this);\n    }\n    dispose() {\n      this[disposable_js_1.disposeSymbol]();\n    }\n    [_ref]() {\n      _classPrivateFieldGet(_disposables, this).dispose();\n      super[disposable_js_1.disposeSymbol]();\n    }\n  }, (() => {\n    const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(_classSuper[Symbol.metadata] ?? null) : void 0;\n    __esDecorate(_Navigation, null, _dispose_decorators, {\n      kind: \"method\",\n      name: \"dispose\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"dispose\" in obj,\n        get: obj => obj.dispose\n      },\n      metadata: _metadata\n    }, null, _instanceExtraInitializers);\n    if (_metadata) Object.defineProperty(_Navigation, Symbol.metadata, {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _metadata\n    });\n  })(), _Navigation);\n  function _initialize() {\n    const browsingContextEmitter = _classPrivateFieldGet(_disposables, this).use(new EventEmitter_js_1.EventEmitter(_classPrivateFieldGet(_browsingContext, this)));\n    browsingContextEmitter.once('closed', () => {\n      this.emit('failed', {\n        url: _classPrivateFieldGet(_browsingContext, this).url,\n        timestamp: new Date()\n      });\n      this.dispose();\n    });\n    browsingContextEmitter.on('request', ({\n      request\n    }) => {\n      if (request.navigation === undefined ||\n      // If a request with a navigation ID comes in, then the navigation ID is\n      // for this navigation.\n      !_assertClassBrand(_Navigation_brand, this, _matches).call(this, request.navigation)) {\n        return;\n      }\n      _classPrivateFieldSet(_request, this, request);\n      this.emit('request', request);\n      const requestEmitter = _classPrivateFieldGet(_disposables, this).use(new EventEmitter_js_1.EventEmitter(_classPrivateFieldGet(_request, this)));\n      requestEmitter.on('redirect', request => {\n        _classPrivateFieldSet(_request, this, request);\n      });\n    });\n    const sessionEmitter = _classPrivateFieldGet(_disposables, this).use(new EventEmitter_js_1.EventEmitter(_classPrivateGetter(_Navigation_brand, this, _get_session)));\n    sessionEmitter.on('browsingContext.navigationStarted', info => {\n      if (info.context !== _classPrivateFieldGet(_browsingContext, this).id || _classPrivateFieldGet(_navigation, this) !== undefined) {\n        return;\n      }\n      _classPrivateFieldSet(_navigation, this, _Navigation.from(_classPrivateFieldGet(_browsingContext, this)));\n    });\n    for (const eventName of ['browsingContext.domContentLoaded', 'browsingContext.load']) {\n      sessionEmitter.on(eventName, info => {\n        if (info.context !== _classPrivateFieldGet(_browsingContext, this).id || info.navigation === null || !_assertClassBrand(_Navigation_brand, this, _matches).call(this, info.navigation)) {\n          return;\n        }\n        this.dispose();\n      });\n    }\n    for (const [eventName, event] of [['browsingContext.fragmentNavigated', 'fragment'], ['browsingContext.navigationFailed', 'failed'], ['browsingContext.navigationAborted', 'aborted']]) {\n      sessionEmitter.on(eventName, info => {\n        if (info.context !== _classPrivateFieldGet(_browsingContext, this).id ||\n        // Note we don't check if `navigation` is null since `null` means the\n        // fragment navigated.\n        !_assertClassBrand(_Navigation_brand, this, _matches).call(this, info.navigation)) {\n          return;\n        }\n        this.emit(event, {\n          url: info.url,\n          timestamp: new Date(info.timestamp)\n        });\n        this.dispose();\n      });\n    }\n  }\n  function _matches(navigation) {\n    if (_classPrivateFieldGet(_navigation, this) !== undefined && !_classPrivateFieldGet(_navigation, this).disposed) {\n      return false;\n    }\n    if (_classPrivateFieldGet(_id, this) === undefined) {\n      _classPrivateFieldSet(_id, this, navigation);\n      return true;\n    }\n    return _classPrivateFieldGet(_id, this) === navigation;\n  }\n  function _get_session(_this) {\n    return _classPrivateFieldGet(_browsingContext, _this).userContext.browser.session;\n  }\n})();\nexports.Navigation = Navigation;","map":{"version":3,"names":["_classPrivateMethodInitSpec","require","default","_classPrivateFieldInitSpec","_classPrivateGetter","_classPrivateFieldGet","_classPrivateFieldSet","_assertClassBrand","EventEmitter_js_1","decorators_js_1","disposable_js_1","Navigation","_ref","_Navigation","_request","_navigation","_browsingContext","_disposables","_id","_Navigation_brand","EventEmitter","_dispose_decorators","inertIfDisposed","disposeSymbol","_classSuper","from","context","navigation","_initialize","call","constructor","__runInitializers","_instanceExtraInitializers","DisposableStack","disposed","request","dispose","__esDecorate","kind","name","static","private","access","has","obj","get","metadata","_metadata","browsingContextEmitter","use","once","emit","url","timestamp","Date","on","undefined","_matches","requestEmitter","sessionEmitter","_get_session","info","id","eventName","event","_this","userContext","browser","session","exports"],"sources":["../../../../../src/bidi/core/Navigation.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}