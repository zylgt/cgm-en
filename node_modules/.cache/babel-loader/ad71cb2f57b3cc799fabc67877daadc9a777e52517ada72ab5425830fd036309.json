{"ast":null,"code":"\"use strict\";\n\n/**\n * @license\n * Copyright 2020 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar _classPrivateMethodInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateMethodInitSpec.js\").default;\nvar _defineProperty = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar _classPrivateFieldInitSpec = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldGet2.js\").default;\nvar _classPrivateGetter = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateGetter.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/hexuemin/Desktop/jiuan/CGM/CGMWeb/node_modules/@babel/runtime/helpers/classPrivateFieldSet2.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PuppeteerNode = void 0;\nconst browsers_1 = require(\"@puppeteer/browsers\");\nconst Puppeteer_js_1 = require(\"../common/Puppeteer.js\");\nconst revisions_js_1 = require(\"../revisions.js\");\nconst ChromeLauncher_js_1 = require(\"./ChromeLauncher.js\");\nconst FirefoxLauncher_js_1 = require(\"./FirefoxLauncher.js\");\n/**\n * Extends the main {@link Puppeteer} class with Node specific behaviour for\n * fetching and downloading browsers.\n *\n * If you're using Puppeteer in a Node environment, this is the class you'll get\n * when you run `require('puppeteer')` (or the equivalent ES `import`).\n *\n * @remarks\n * The most common method to use is {@link PuppeteerNode.launch | launch}, which\n * is used to launch and connect to a new browser instance.\n *\n * See {@link Puppeteer | the main Puppeteer class} for methods common to all\n * environments, such as {@link Puppeteer.connect}.\n *\n * @example\n * The following is a typical example of using Puppeteer to drive automation:\n *\n * ```ts\n * import puppeteer from 'puppeteer';\n *\n * (async () => {\n *   const browser = await puppeteer.launch();\n *   const page = await browser.newPage();\n *   await page.goto('https://www.google.com');\n *   // other actions...\n *   await browser.close();\n * })();\n * ```\n *\n * Once you have created a `page` you have access to a large API to interact\n * with the page, navigate, or find certain elements in that page.\n * The {@link Page | `page` documentation} lists all the available methods.\n *\n * @public\n */\nvar _launcher = /*#__PURE__*/new WeakMap();\nvar _lastLaunchedProduct = /*#__PURE__*/new WeakMap();\nvar _PuppeteerNode_brand = /*#__PURE__*/new WeakSet();\nclass PuppeteerNode extends Puppeteer_js_1.Puppeteer {\n  /**\n   * @internal\n   */\n  constructor(settings) {\n    const {\n      configuration,\n      ...commonSettings\n    } = settings;\n    super(commonSettings);\n    /**\n     * @internal\n     */\n    _classPrivateMethodInitSpec(this, _PuppeteerNode_brand);\n    _classPrivateFieldInitSpec(this, _launcher, void 0);\n    _classPrivateFieldInitSpec(this, _lastLaunchedProduct, void 0);\n    /**\n     * @internal\n     */\n    _defineProperty(this, \"defaultBrowserRevision\", void 0);\n    /**\n     * @internal\n     */\n    _defineProperty(this, \"configuration\", {});\n    if (configuration) {\n      this.configuration = configuration;\n    }\n    switch (this.configuration.defaultProduct) {\n      case 'firefox':\n        this.defaultBrowserRevision = revisions_js_1.PUPPETEER_REVISIONS.firefox;\n        break;\n      default:\n        this.configuration.defaultProduct = 'chrome';\n        this.defaultBrowserRevision = revisions_js_1.PUPPETEER_REVISIONS.chrome;\n        break;\n    }\n    this.connect = this.connect.bind(this);\n    this.launch = this.launch.bind(this);\n    this.executablePath = this.executablePath.bind(this);\n    this.defaultArgs = this.defaultArgs.bind(this);\n    this.trimCache = this.trimCache.bind(this);\n  }\n  /**\n   * This method attaches Puppeteer to an existing browser instance.\n   *\n   * @param options - Set of configurable options to set on the browser.\n   * @returns Promise which resolves to browser instance.\n   */\n  connect(options) {\n    return super.connect(options);\n  }\n  /**\n   * Launches a browser instance with given arguments and options when\n   * specified.\n   *\n   * When using with `puppeteer-core`,\n   * {@link LaunchOptions.executablePath | options.executablePath} or\n   * {@link LaunchOptions.channel | options.channel} must be provided.\n   *\n   * @example\n   * You can use {@link LaunchOptions.ignoreDefaultArgs | options.ignoreDefaultArgs}\n   * to filter out `--mute-audio` from default arguments:\n   *\n   * ```ts\n   * const browser = await puppeteer.launch({\n   *   ignoreDefaultArgs: ['--mute-audio'],\n   * });\n   * ```\n   *\n   * @remarks\n   * Puppeteer can also be used to control the Chrome browser, but it works best\n   * with the version of Chrome for Testing downloaded by default.\n   * There is no guarantee it will work with any other version. If Google Chrome\n   * (rather than Chrome for Testing) is preferred, a\n   * {@link https://www.google.com/chrome/browser/canary.html | Chrome Canary}\n   * or\n   * {@link https://www.chromium.org/getting-involved/dev-channel | Dev Channel}\n   * build is suggested. See\n   * {@link https://www.howtogeek.com/202825/what%E2%80%99s-the-difference-between-chromium-and-chrome/ | this article}\n   * for a description of the differences between Chromium and Chrome.\n   * {@link https://chromium.googlesource.com/chromium/src/+/lkgr/docs/chromium_browser_vs_google_chrome.md | This article}\n   * describes some differences for Linux users. See\n   * {@link https://developer.chrome.com/blog/chrome-for-testing/ | this doc} for the description\n   * of Chrome for Testing.\n   *\n   * @param options - Options to configure launching behavior.\n   */\n  launch(options = {}) {\n    const {\n      product = this.defaultProduct\n    } = options;\n    _classPrivateFieldSet(_lastLaunchedProduct, this, product);\n    return _classPrivateGetter(_PuppeteerNode_brand, this, _get_launcher).launch(options);\n  }\n  /**\n   * The default executable path.\n   */\n  executablePath(channel) {\n    return _classPrivateGetter(_PuppeteerNode_brand, this, _get_launcher).executablePath(channel);\n  }\n  /**\n   * @internal\n   */\n  get browserRevision() {\n    return _classPrivateFieldGet(_launcher, this)?.getActualBrowserRevision() ?? this.configuration.browserRevision ?? this.defaultBrowserRevision;\n  }\n  /**\n   * The default download path for puppeteer. For puppeteer-core, this\n   * code should never be called as it is never defined.\n   *\n   * @internal\n   */\n  get defaultDownloadPath() {\n    return this.configuration.cacheDirectory;\n  }\n  /**\n   * The name of the browser that was last launched.\n   */\n  get lastLaunchedProduct() {\n    return _classPrivateFieldGet(_lastLaunchedProduct, this) ?? this.defaultProduct;\n  }\n  /**\n   * The name of the browser that will be launched by default. For\n   * `puppeteer`, this is influenced by your configuration. Otherwise, it's\n   * `chrome`.\n   */\n  get defaultProduct() {\n    return this.configuration.defaultProduct ?? 'chrome';\n  }\n  /**\n   * @deprecated Do not use as this field as it does not take into account\n   * multiple browsers of different types. Use\n   * {@link PuppeteerNode.defaultProduct | defaultProduct} or\n   * {@link PuppeteerNode.lastLaunchedProduct | lastLaunchedProduct}.\n   *\n   * @returns The name of the browser that is under automation.\n   */\n  get product() {\n    return _classPrivateGetter(_PuppeteerNode_brand, this, _get_launcher).product;\n  }\n  /**\n   * @param options - Set of configurable options to set on the browser.\n   *\n   * @returns The default flags that Chromium will be launched with.\n   */\n  defaultArgs(options = {}) {\n    return _classPrivateGetter(_PuppeteerNode_brand, this, _get_launcher).defaultArgs(options);\n  }\n  /**\n   * Removes all non-current Firefox and Chrome binaries in the cache directory\n   * identified by the provided Puppeteer configuration. The current browser\n   * version is determined by resolving PUPPETEER_REVISIONS from Puppeteer\n   * unless `configuration.browserRevision` is provided.\n   *\n   * @remarks\n   *\n   * Note that the method does not check if any other Puppeteer versions\n   * installed on the host that use the same cache directory require the\n   * non-current binaries.\n   *\n   * @public\n   */\n  async trimCache() {\n    const platform = (0, browsers_1.detectBrowserPlatform)();\n    if (!platform) {\n      throw new Error('The current platform is not supported.');\n    }\n    const cacheDir = this.configuration.cacheDirectory;\n    const installedBrowsers = await (0, browsers_1.getInstalledBrowsers)({\n      cacheDir\n    });\n    const product = this.configuration.defaultProduct;\n    const puppeteerBrowsers = [{\n      product: 'chrome',\n      browser: browsers_1.Browser.CHROME,\n      currentBuildId: ''\n    }, {\n      product: 'firefox',\n      browser: browsers_1.Browser.FIREFOX,\n      currentBuildId: ''\n    }];\n    // Resolve current buildIds.\n    for (const item of puppeteerBrowsers) {\n      item.currentBuildId = await (0, browsers_1.resolveBuildId)(item.browser, platform, (product === item.product ? this.configuration.browserRevision : null) || revisions_js_1.PUPPETEER_REVISIONS[item.product]);\n    }\n    const currentBrowserBuilds = new Set(puppeteerBrowsers.map(browser => {\n      return `${browser.browser}_${browser.currentBuildId}`;\n    }));\n    const currentBrowsers = new Set(puppeteerBrowsers.map(browser => {\n      return browser.browser;\n    }));\n    for (const installedBrowser of installedBrowsers) {\n      // Don't uninstall browsers that are not managed by Puppeteer yet.\n      if (!currentBrowsers.has(installedBrowser.browser)) {\n        continue;\n      }\n      // Keep the browser build used by the current Puppeteer installation.\n      if (currentBrowserBuilds.has(`${installedBrowser.browser}_${installedBrowser.buildId}`)) {\n        continue;\n      }\n      await (0, browsers_1.uninstall)({\n        browser: installedBrowser.browser,\n        platform,\n        cacheDir,\n        buildId: installedBrowser.buildId\n      });\n    }\n  }\n}\nfunction _get_launcher(_this) {\n  if (_classPrivateFieldGet(_launcher, _this) && _classPrivateFieldGet(_launcher, _this).product === _this.lastLaunchedProduct) {\n    return _classPrivateFieldGet(_launcher, _this);\n  }\n  switch (_this.lastLaunchedProduct) {\n    case 'chrome':\n      _this.defaultBrowserRevision = revisions_js_1.PUPPETEER_REVISIONS.chrome;\n      _classPrivateFieldSet(_launcher, _this, new ChromeLauncher_js_1.ChromeLauncher(_this));\n      break;\n    case 'firefox':\n      _this.defaultBrowserRevision = revisions_js_1.PUPPETEER_REVISIONS.firefox;\n      _classPrivateFieldSet(_launcher, _this, new FirefoxLauncher_js_1.FirefoxLauncher(_this));\n      break;\n    default:\n      throw new Error(`Unknown product: ${_classPrivateFieldGet(_lastLaunchedProduct, _this)}`);\n  }\n  return _classPrivateFieldGet(_launcher, _this);\n}\nexports.PuppeteerNode = PuppeteerNode;","map":{"version":3,"names":["_classPrivateMethodInitSpec","require","default","_defineProperty","_classPrivateFieldInitSpec","_classPrivateFieldGet","_classPrivateGetter","_classPrivateFieldSet","browsers_1","Puppeteer_js_1","revisions_js_1","ChromeLauncher_js_1","FirefoxLauncher_js_1","_launcher","WeakMap","_lastLaunchedProduct","_PuppeteerNode_brand","WeakSet","PuppeteerNode","Puppeteer","constructor","settings","configuration","commonSettings","defaultProduct","defaultBrowserRevision","PUPPETEER_REVISIONS","firefox","chrome","connect","bind","launch","executablePath","defaultArgs","trimCache","options","product","_get_launcher","channel","browserRevision","getActualBrowserRevision","defaultDownloadPath","cacheDirectory","lastLaunchedProduct","platform","detectBrowserPlatform","Error","cacheDir","installedBrowsers","getInstalledBrowsers","puppeteerBrowsers","browser","Browser","CHROME","currentBuildId","FIREFOX","item","resolveBuildId","currentBrowserBuilds","Set","map","currentBrowsers","installedBrowser","has","buildId","uninstall","_this","ChromeLauncher","FirefoxLauncher","exports"],"sources":["../../../../src/node/PuppeteerNode.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}