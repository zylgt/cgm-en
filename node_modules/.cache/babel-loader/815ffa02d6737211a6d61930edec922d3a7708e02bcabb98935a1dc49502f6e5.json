{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { openProcedure } from \"@/utils/monitoringApp\";\nimport Abnormal from \"./abnormal\";\nimport Socket from '@/utils/webSocket';\nimport { mapGetters } from \"vuex\";\nexport default {\n  data() {\n    return {\n      chooseIndex: 0 //选择要连接的设备\n    };\n  },\n  computed: {\n    ...mapGetters(['upStep', 'deviceList', 'errorCode', 'upProgess', 'upLimit', 'readerConnect']),\n    progessNum() {\n      if (this.$store.getters.upLimit == 0) {\n        return 0;\n      } else {\n        let a = this.$store.getters.upProgess / this.$store.getters.upLimit;\n        console.log('当前上传进度======>' + this.$store.getters.upProgess, this.$store.getters.upLimit, a.toFixed(3));\n        if (this.$store.getters.upProgess == this.$store.getters.upLimit) {\n          this.$router.push('/');\n        }\n        return a.toFixed(3);\n      }\n    },\n    pct() {\n      if (this.$store.getters.upLimit == 0) {\n        return 0;\n      } else {\n        let a = this.$store.getters.upProgess / this.$store.getters.upLimit * 100;\n        let num = a.toFixed(1);\n        console.log('当前上传进度======>' + this.$store.getters.upProgess, this.$store.getters.upLimit, a, num);\n        if (this.$store.getters.upProgess == this.$store.getters.upLimit) {\n          this.$router.push('/');\n        }\n        return num;\n      }\n    }\n  },\n  components: {\n    Abnormal\n  },\n  created() {},\n  mounted() {},\n  methods: {\n    firing() {\n      let self = this;\n      let appUri = 'CGM3Uploader://'; // 应用程序的地址(注册表应用名称)\n      // let appUri = 'Clashx://'; // 应用程序的地址(注册表应用名称)\n      let timeoutDuration = 1000;\n      let openAppFailure = () => {\n        //未检测到驱动，需要下载\n        self.$store.dispatch('setErrorCode', 1);\n      };\n      let openAppSuccess = () => {\n        // 已安装驱动\n        self.$store.dispatch('setErrorCode', 0);\n        self.$store.dispatch('setUpStep', 2);\n        setTimeout(function () {\n          //等待用户点击弹窗判断用户是否要打开驱动\n          self.$websocket.reset();\n          self.$websocket.initwebSocket();\n          self.$store.dispatch('setErrorCode', 0);\n        }, 3000);\n      };\n      openProcedure(appUri, openAppFailure, openAppSuccess, timeoutDuration);\n    },\n    // 下载\n    downLoad() {\n      console.log('下载驱动');\n      this.$store.dispatch('setUpStep', 1);\n      this.$store.dispatch('setErrorCode', 0);\n      // window.location.href='https://dldir1.qq.com/weixin/mac/WeChatMac.dmg'\n    },\n    // 选择要连接的设备\n    chooseProcedure(index) {\n      this.chooseIndex = index;\n    },\n    // 重新连接设备\n    repeatReader() {\n      this.$store.dispatch('setErrorCode', 0);\n    },\n    // 连接reader设备\n    connectReader() {\n      this.$store.dispatch('setReaderConnect', 1);\n      this.$store.dispatch('setErrorCode', 0);\n      this.$websocket.connectReader(this.deviceList[this.chooseIndex]);\n    }\n  }\n};","map":{"version":3,"names":["openProcedure","Abnormal","Socket","mapGetters","data","chooseIndex","computed","progessNum","$store","getters","upLimit","a","upProgess","console","log","toFixed","$router","push","pct","num","components","created","mounted","methods","firing","self","appUri","timeoutDuration","openAppFailure","dispatch","openAppSuccess","setTimeout","$websocket","reset","initwebSocket","downLoad","chooseProcedure","index","repeatReader","connectReader","deviceList"],"sources":["src/views/Procedure/upLoad.vue"],"sourcesContent":["<template>\n    <div class='upLoad' >\n        <div class='run-procedure'  v-if='errorCode==0'>\n            <div class='step-box step1' v-if='upStep==1'>\n                <div class='title' >\n                    <p class='title-border' ></p>\n                    运行驱动程序\n                </div>\n                <div class='procedure_img' >\n                    <div class='procedure_img_item' >\n                        <div class='procedure_img_box' >\n                            <img src=\"~@/assets/image/procedure-img1.png\" alt=\"\" class='procedure_img_img' >\n                            <div class='procedure_img_step' >1</div>\n                        </div>\n                        <p class='procedure_img_text' >第一步：点击“下载驱动”俺就下载驱动程序，下载完成后，双击打开驱动程序。</p>\n                    </div>\n                    <div class='procedure_img_item' >\n                         <div class='procedure_img_box' >\n                            <img src=\"~@/assets/image/procedure-img2.png\" alt=\"\" class='procedure_img_img' >\n                            <div class='procedure_img_step' >2</div>\n                        </div>\n                        <p class='procedure_img_text' >第二步：根据指引安装驱动程序。</p>\n                    </div>\n                    <div class='procedure_img_item' >\n                         <div class='procedure_img_box' >\n                            <img src=\"~@/assets/image/procedure-img3.png\" alt=\"\" class='procedure_img_img' >\n                            <div class='procedure_img_step' >3</div>\n                        </div>\n                        <p class='procedure_img_text' >第三步：当您完成驱动程序的安装后，点击“启动驱动”按钮运行驱动程序，并允许驱动程序运行。</p>\n                        <p class='procedure_img_tips' >*若您已安装驱动，请直接点击启动驱动</p>\n                    </div>\n                </div>\n                <div class='btn-box' >\n                    <el-button type=\"primary\"  @click='downLoad'> 下载驱动</el-button>\n                    <el-button type=\"primary\"  @click='firing'>启动驱动</el-button>\n                </div>\n            </div>\n            <div class='step-box step2' v-if='upStep==2' >\n                    <i class=\"el-icon-loading loading-icon \"></i>\n                    <div class='unistall-text' >正在启动中...</div>\n                    <div class='unistall-text-tips' >正在启动驱动程序，请稍后...</div>\n            </div>\n            <div class='step-box' v-if='upStep==3'>\n                <div class='step-box step1' v-if='deviceList.length==0' >\n                    <div class='title' >\n                        <p class='title-border' ></p>\n                        连接读取器\n                    </div>\n                    <div class='procedure_img step3_procedure_img' >\n                        <div class='procedure_img_item' >\n                            <div class='procedure_img_box' >\n                                <img src=\"~@/assets/image/procedure-img4.png\" alt=\"\" class='procedure_img_img' >\n                                <div class='procedure_img_step' >1</div>\n                            </div>\n                            <p class='procedure_img_text' >第一步：用数据线连接您的读取器与电脑。</p>\n                        </div>\n                        <div class='procedure_img_item' >\n                            <div class='procedure_img_box' >\n                                <img src=\"~@/assets/image/procedure-img1.png\" alt=\"\" class='procedure_img_img' >\n                                <div class='procedure_img_step' >2</div>\n                            </div>\n                            <p class='procedure_img_text' >第二步：确认已将您的读取器连接至电脑后，点击右下方开始传输按钮。</p>\n                        </div>\n                    </div>\n                    <div class='btn-box flex-end' >\n                        <el-button type=\"primary\"  @click='connectReader'> 开始连接</el-button>\n                    </div>\n                </div>\n                <div class='step-box step1' v-if='deviceList.length>1' >\n                     <div class='title' >\n                        <p class='title-border' ></p>\n                        多台设备连接\n                        <div class='title-tips' >检测到当前有多台设备连接电脑，请选择您想要同步的设备。请依据读取器后的编码选择您想同步的机器。</div>\n                    </div>\n                    <div class='procedure_img step3_procedure_img' >\n                        <img src=\"~@/assets/image/procedure-img5.png\" alt=\"\" class='more-procedure' >\n                        <div class='procedure-list' >\n                            <div :class='[index==chooseIndex?\"active\":\"\", \"procedure-list-item\" ]' v-for='(item,index) in deviceList' :key='index' @click='chooseProcedure(index)' >设备{{index+1}}:{{item.readerMac}}</div>\n                        </div>\n                    </div>\n                    <div class='btn-box flex-end' >\n                        <el-button type=\"primary\"  @click='connectReader'> 开始连接</el-button>\n                    </div>\n                </div>\n                <div class='step-box step2' v-if='readerConnect==1' >\n                    <i class=\"el-icon-loading loading-icon \"></i>\n                    <div class='unistall-text step3-unistall-text' >正在连接设备，请稍等</div>\n                    <div class='unistall-text-tips step3-unistall-text-tips' > <img src=\"~@/assets/image/waring-icon.png\" alt=\"\" class='waring-icon' >   正在连接设备，请勿拔下数据线。</div>\n                </div>\n            </div>\n            <div class='step-box step2' v-if='upStep==4'>\n                <div class='step4-loading-box' >\n                    <img src=\"~@/assets/image/loading.png\" alt=\"\" class='step4-loading' >\n                </div>\n                <div class='step-progess'>\n                    <div class='progess'>\n                        <div class='progess-install' :style=\"{width:pct/100*380+'px'}\"  ></div>\n                    </div>\n                    <div class='progess-num'>{{pct}}%</div>\n                </div>\n                <div class='unistall-text step3-unistall-text' >正在同步数据，请稍等</div>\n                <div class='unistall-text-tips step3-unistall-text-tips' > <img src=\"~@/assets/image/waring-icon.png\" alt=\"\" class='waring-icon' >   正在进行数据传输，在传输完成前请勿拔下数据线，以免丢失数据。</div>\n                <div class='reader-data-tip' >*检测到读取器与电脑时间不一致，将自动为您校准读取器的时间。</div>\n                <div class='reader-data-tip' >*检测到读取器与电脑目标范围不一致，将自动为您同步到读取器。</div>\n            </div>\n            <div class='step-progess' >\n                <div :class='[upStep>=1?\"active\":\"\",\"progess-item\"]' ></div>\n                <div :class='[upStep>=2?\"active\":\"\",\"progess-item\"]' ></div>\n                <div :class='[upStep>=3?\"active\":\"\",\"progess-item\"]' ></div>\n                <div :class='[upStep>=4?\"active\":\"\",\"progess-item\"]' ></div>\n            </div>\n        </div>\n        <Abnormal v-if='errorCode!=0' :type='errorCode'  @downLoad='downLoad' @firing='firing'  @connectReader='repeatReader'/>\n    </div>\n</template>\n<script>\nimport { openProcedure } from \"@/utils/monitoringApp\";\nimport Abnormal from \"./abnormal\"\nimport Socket from '@/utils/webSocket'\nimport {mapGetters} from \"vuex\"\nexport default {\n    data(){\n        return{\n            chooseIndex:0,//选择要连接的设备\n\n        }\n    },\n    computed:{\n        ...mapGetters([\n            'upStep',\n            'deviceList',\n            'errorCode',\n            'upProgess',\n            'upLimit',\n            'readerConnect']),\n        progessNum(){\n            if(this.$store.getters.upLimit==0){\n                return 0\n            }else{\n                let a = this.$store.getters.upProgess/this.$store.getters.upLimit\n                console.log('当前上传进度======>'+this.$store.getters.upProgess,this.$store.getters.upLimit,a.toFixed(3))\n                if(this.$store.getters.upProgess == this.$store.getters.upLimit){\n                    this.$router.push('/')\n                }\n                return a.toFixed(3)\n            }\n            \n        },\n        pct(){\n            if(this.$store.getters.upLimit==0){\n                return 0\n            }else{\n                let a = (this.$store.getters.upProgess/this.$store.getters.upLimit)*100\n                let num = a.toFixed(1)\n                console.log('当前上传进度======>'+this.$store.getters.upProgess,this.$store.getters.upLimit,a,num)\n                if(this.$store.getters.upProgess == this.$store.getters.upLimit){\n                    this.$router.push('/')\n                }\n                return num\n            }\n        }\n    },\n    components:{\n        Abnormal\n    },\n    created(){}, \n    mounted(){},\n    methods:{\n        firing(){\n            let self = this\n            let appUri = 'CGM3Uploader://'; // 应用程序的地址(注册表应用名称)\n            // let appUri = 'Clashx://'; // 应用程序的地址(注册表应用名称)\n            let timeoutDuration = 1000;\n            let openAppFailure = () => { //未检测到驱动，需要下载\n                self.$store.dispatch('setErrorCode',1) \n            };\n            let openAppSuccess = () => {\n                // 已安装驱动\n                self.$store.dispatch('setErrorCode',0) \n                self.$store.dispatch('setUpStep',2)\n                setTimeout(function(){ //等待用户点击弹窗判断用户是否要打开驱动\n                    self.$websocket.reset();\n                    self.$websocket.initwebSocket();\n                    self.$store.dispatch('setErrorCode',0) \n                },3000)\n\n            };\n            openProcedure(appUri, openAppFailure, openAppSuccess, timeoutDuration);\n        },\n        // 下载\n        downLoad(){\n            console.log('下载驱动')\n            this.$store.dispatch('setUpStep',1)\n            this.$store.dispatch('setErrorCode',0) \n            // window.location.href='https://dldir1.qq.com/weixin/mac/WeChatMac.dmg'\n        },\n        // 选择要连接的设备\n        chooseProcedure(index){\n            this.chooseIndex = index\n        },\n        // 重新连接设备\n        repeatReader(){\n            this.$store.dispatch('setErrorCode',0) \n        },\n        // 连接reader设备\n        connectReader(){\n            this.$store.dispatch('setReaderConnect',1)\n            this.$store.dispatch('setErrorCode',0) \n            this.$websocket.connectReader(this.deviceList[this.chooseIndex])\n        },\n    }\n}\n</script>\n<style scoped>\n    .upLoad{\n        width:100%;\n        height:100%;\n        padding:30px;\n        background:#fff;\n         border-radius:10px;\n        box-shadow: 0px 2px 20px 0px #0000000D;\n    }\n    .run-procedure{\n         height:100%;\n    }\n    .step-progess{\n        width:100%;\n        height:80px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n    .progess-item{\n        width:60px;\n        height:5px;\n        border-radius:1px;\n        background:#f0f0f0;\n        margin:0 4px;\n    }\n    .progess-item.active{\n        background:var(--color-primary);\n    }\n    .step-box{\n        width:100%;\n        height: 90%;\n    }\n/* 步骤一 */\n    .step1{\n        position: relative;\n        width:100%;\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n    }\n    .title{\n        font-size:20px;\n        color:#000;\n        font-weight: 440;\n        margin-bottom:20px;\n        position: relative;\n        padding-left:6px;\n        height:30px;\n        line-height: 30px;\n    }\n    .title-border{\n        width:2px;\n        height:20px;\n        border-radius: 1px;\n        background:var(--color-primary);\n        position: absolute;\n        left:0;\n        top:5px;\n    }\n    .procedure_img{\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n    .procedure_img_item{\n        width:30%;\n        max-height:460px;\n        min-height: 360px;\n        margin:0 10px;\n    }\n    .procedure_img_box{\n        background:#d9d9d9;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        position: relative;\n        margin-bottom:20px;\n    }\n    .procedure_img_step{\n        width:40px;\n        height:40px;\n        background:var(--color-primary);\n        text-align: center;\n        line-height: 40px;\n        justify-content: center;\n        color:#fff;\n        font-size:24px;\n        font-weight: 380;\n        position: absolute;\n        left:0;\n        top:0;\n    }\n    .procedure_img_img{\n        display: block;\n        width:100%;\n    } \n    .procedure_img_text{\n        font-size:16px;\n        color:#666;\n    }\n    .procedure_img_tips{\n        font-size:16px;\n        color:var(--color-primary);\n        margin-top:14px;\n    }\n    .btn-box{\n        display: flex;\n        align-items: center;\n        justify-content:flex-end;\n        \n    }\n    .btn-box.flex-end{\n        justify-content: flex-end;\n    }\n/* 步骤2 */\n     .step2{\n       display: flex;\n       align-items: center;\n       justify-content: center; \n       flex-direction: column;\n        height:90%;\n        width:100%;\n\n    }\n    .loading-icon{\n        font-size:60px;\n        color:var(--color-primary);\n    }\n/* 步骤三 */\n    .step3_procedure_img{\n        justify-content: center;\n    }\n    .title-tips{\n        font-size:16px;\n        font-weight: 400;\n        color:#666;\n    }\n    .procedure-list{\n        margin-left:100px;\n    }\n    .procedure-list-item{\n        width:500px;\n        height:60px;\n        border-radius:10px;\n        border:1px solid #e5e5e5;\n        padding-left:20px;\n        line-height: 60px;\n        margin-bottom:16px;\n        font-size:20px;\n        color:#666;\n        font-weight: 380;\n    }\n    .procedure-list-item.active{\n        color:var(--color-primary);\n        border:1px solid var(--color-primary);\n        background: rgba(50, 186, 192, 0.1);\n    }\n    .step3-unistall-text-tips{\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-bottom:20px;\n    }\n    .waring-icon{\n        margin-right:6px;\n    }\n    .step3-unistall-text{\n         color:var(--color-primary);\n    }\n/* 步骤四 */\n    .reader-data-tip{\n        font-size:16px;\n        color:var(--color-warning);\n        text-align: center;\n    }\n    .step4-loading-box{\n        margin:0 auto;\n        width:80px;\n        height: 80px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: var(--color-primary);\n        border-radius:50%;\n    }\n    .step4-loading{\n        \n        display: block;\n        -webkit-animation: rotate 1s linear;\n        -moz-animation: rotate 1s linear;\n        animation: rotate 1s linear;\n        -webkit-animation-iteration-count: infinite;\n        -moz-animation-iteration-count: infinite;\n        animation-iteration-count: infinite;\n    }\n    @keyframes rotate {\n        0% {\n        transform: rotate(0deg);\n        }\n    \n        50% {\n            transform: rotate(180deg);\n        }\n    \n        100% {\n            transform: rotate(360deg);\n        }\n    }\n    .step-progess{\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n    .progess{\n        width:380px;\n        height:12px;\n        border-radius:22px;\n        background: #eaeaea;\n        margin-right:20px;\n        position: relative;\n    }\n    .progess-install{\n        position: absolute;\n        left:0;\n        top:0;\n        width:0px;\n        height:12px;\n        border-radius:22px;\n        background:var(--color-primary);\n        transition: all 0.5s linear;\n    }\n    .progess-num{\n        font-size:20px;\n        color:var(--color-primary);\n        font-weight: 440;\n    }\n/* 未安装 */\n    .uninstall-procedure{\n        height:100%;\n        position: relative;\n    }\n     .unstall-tips{\n        display:flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        height:100%;\n    }\n    .waring-icon{\n        font-size:60px;\n        color:red;\n    }\n    .unistall-text{\n        margin-top:30px;\n        font-size:20px;\n        text-align: center;\n        font-weight: 440;\n    }\n    .unistall-text-tips{\n        font-size:16px;\n        color:#666;\n        font-weight: 400;\n        margin-top:20px;\n    }\n    .unistall-btn{\n        display: flex;\n        justify-content: flex-end;\n        position: absolute;\n        right:0;\n        bottom:0;\n    }\n   \n  \n</style>"],"mappings":";AAoHA,SAAAA,aAAA;AACA,OAAAC,QAAA;AACA,OAAAC,MAAA;AACA,SAAAC,UAAA;AACA;EACAC,KAAA;IACA;MACAC,WAAA;IAEA;EACA;EACAC,QAAA;IACA,GAAAH,UAAA,EACA,UACA,cACA,aACA,aACA,WACA;IACAI,WAAA;MACA,SAAAC,MAAA,CAAAC,OAAA,CAAAC,OAAA;QACA;MACA;QACA,IAAAC,CAAA,QAAAH,MAAA,CAAAC,OAAA,CAAAG,SAAA,QAAAJ,MAAA,CAAAC,OAAA,CAAAC,OAAA;QACAG,OAAA,CAAAC,GAAA,wBAAAN,MAAA,CAAAC,OAAA,CAAAG,SAAA,OAAAJ,MAAA,CAAAC,OAAA,CAAAC,OAAA,EAAAC,CAAA,CAAAI,OAAA;QACA,SAAAP,MAAA,CAAAC,OAAA,CAAAG,SAAA,SAAAJ,MAAA,CAAAC,OAAA,CAAAC,OAAA;UACA,KAAAM,OAAA,CAAAC,IAAA;QACA;QACA,OAAAN,CAAA,CAAAI,OAAA;MACA;IAEA;IACAG,IAAA;MACA,SAAAV,MAAA,CAAAC,OAAA,CAAAC,OAAA;QACA;MACA;QACA,IAAAC,CAAA,QAAAH,MAAA,CAAAC,OAAA,CAAAG,SAAA,QAAAJ,MAAA,CAAAC,OAAA,CAAAC,OAAA;QACA,IAAAS,GAAA,GAAAR,CAAA,CAAAI,OAAA;QACAF,OAAA,CAAAC,GAAA,wBAAAN,MAAA,CAAAC,OAAA,CAAAG,SAAA,OAAAJ,MAAA,CAAAC,OAAA,CAAAC,OAAA,EAAAC,CAAA,EAAAQ,GAAA;QACA,SAAAX,MAAA,CAAAC,OAAA,CAAAG,SAAA,SAAAJ,MAAA,CAAAC,OAAA,CAAAC,OAAA;UACA,KAAAM,OAAA,CAAAC,IAAA;QACA;QACA,OAAAE,GAAA;MACA;IACA;EACA;EACAC,UAAA;IACAnB;EACA;EACAoB,QAAA;EACAC,QAAA;EACAC,OAAA;IACAC,OAAA;MACA,IAAAC,IAAA;MACA,IAAAC,MAAA;MACA;MACA,IAAAC,eAAA;MACA,IAAAC,cAAA,GAAAA,CAAA;QAAA;QACAH,IAAA,CAAAjB,MAAA,CAAAqB,QAAA;MACA;MACA,IAAAC,cAAA,GAAAA,CAAA;QACA;QACAL,IAAA,CAAAjB,MAAA,CAAAqB,QAAA;QACAJ,IAAA,CAAAjB,MAAA,CAAAqB,QAAA;QACAE,UAAA;UAAA;UACAN,IAAA,CAAAO,UAAA,CAAAC,KAAA;UACAR,IAAA,CAAAO,UAAA,CAAAE,aAAA;UACAT,IAAA,CAAAjB,MAAA,CAAAqB,QAAA;QACA;MAEA;MACA7B,aAAA,CAAA0B,MAAA,EAAAE,cAAA,EAAAE,cAAA,EAAAH,eAAA;IACA;IACA;IACAQ,SAAA;MACAtB,OAAA,CAAAC,GAAA;MACA,KAAAN,MAAA,CAAAqB,QAAA;MACA,KAAArB,MAAA,CAAAqB,QAAA;MACA;IACA;IACA;IACAO,gBAAAC,KAAA;MACA,KAAAhC,WAAA,GAAAgC,KAAA;IACA;IACA;IACAC,aAAA;MACA,KAAA9B,MAAA,CAAAqB,QAAA;IACA;IACA;IACAU,cAAA;MACA,KAAA/B,MAAA,CAAAqB,QAAA;MACA,KAAArB,MAAA,CAAAqB,QAAA;MACA,KAAAG,UAAA,CAAAO,aAAA,MAAAC,UAAA,MAAAnC,WAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}